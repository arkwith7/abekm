# 10.5 Testing & Change Control (필수 운영 규칙)

> 본 문서는 멀티에이전트 확장/리팩터링 시 반드시 지켜야 하는 검증 게이트(unit/functional/integration), 재보완 루프, 문서 베이스라인 재정의 규칙을 정의합니다.
> 상세 실행 계획(향후 로드맵)은 [01.docs/21.1.agentic_ai_roadmap.md](21.1.agentic_ai_roadmap.md)를 단일 소스로 사용합니다.

---

## 1. 테스트 게이트(필수, 컨테이너 내부)

코드 변경은 아래 순서를 반드시 따릅니다.

1) **단위 테스트(Unit)**
- 목표: 변경한 로직을 가장 좁게 검증
- 최소: 변경사항을 재현/검증하는 unit test 1개 이상 추가 또는 갱신
- 실행: `shell-script/test-backend-unit.sh`
  - 실제 테스트 위치(기본): `backend/tests/unit/`

2) **기능 테스트(Functional)**
- 목표: API wiring / Supervisor-Worker 연결 / 최소 성공 경로 검증
- 실행: `shell-script/test-backend-functional.sh`
  - 실제 테스트 위치(기본): `backend/tests/functional/`

3) **통합 테스트(Integration)**
- 목표: 실DB/Redis/외부 의존성을 포함한 최소 E2E 경로 검증
- 실행: `shell-script/test-backend-integration.sh`
  - 실제 테스트 위치(기본): `backend/tests/integration/`

---

## 2. 재보완(보정) 루프(필수)

- 원인 분리: 변경으로 인한 실패 vs 기존 불안정/환경 문제
- 최소 수정: 회귀를 막는 최소 변경으로 해결(범위 확장 금지)
- 재발 방지: 실패 케이스를 테스트로 고정
- 게이트 재통과: unit → functional → integration 순서로 다시 통과

---

## 3. 임시 하드코딩 관리(필수)

원인 파악 과정에서 임시 하드코딩이 필요할 수 있으나, 운영 코드에 남는 것을 금지합니다.

허용(권장):
- 테스트 코드에서만 하드코딩(fixture/monkeypatch)
- 프로덕션 코드에 들어가야 한다면
  - 명시적 디버그 플래그/설정으로만 활성화(기본 OFF)

금지:
- 기본값이 하드코딩을 활성화
- 특정 사용자/문서/컨테이너 ID, API 키/토큰/엔드포인트를 코드에 직접 삽입
- 라우팅/모델 선택/권한 체크를 우회

복원(restore) 절차:
1) 임시 하드코딩 제거 또는 기본 OFF 플래그 뒤로 이동
2) 재발 방지 테스트 추가
3) 하드코딩 잔존 검출 시나리오 통과

---

## 4. 하드코딩 잔존 여부 검출(테스트 시나리오 포함)

- Unit 시나리오
  - 설정 기반 동작 보장(라우팅/모델/프로바이더가 코드 상수로 고정되지 않음)
  - 금지 마커 스캔(권장): 디버그 마커가 프로덕션 모듈에 남아있으면 실패

- Functional 시나리오
  - E2E 경로에서 강제 라우팅/강제 provider가 작동하지 않음
  - 폴백 정책이 문서/코드대로 동작(하드코딩 성공 우회 금지)

---

## 5. 문서 업데이트 = 베이스라인 재정의(필수)

Phase/주요 변경이 완료될 때마다 문서가 “현재 기준”을 대표하도록 업데이트합니다.

필수 업데이트 대상(영향 범위에 따라):
- 공용 프레임워크: [01.docs/10.agentic_architecture.md](10.agentic_architecture.md) 및 10.1~10.4
- 도메인 설계: [01.docs/11.enterprise_intelligence_architecture.md](11.enterprise_intelligence_architecture.md) 및 11.1~11.3
- 향후 로드맵/마이그레이션 기준: [01.docs/21.1.agentic_ai_roadmap.md](21.1.agentic_ai_roadmap.md)

최소 기준:
- Change Log 갱신
- 디렉토리/진입점/권장 import 경로 최신화
- Phase 상태/완료 기준 최신화
