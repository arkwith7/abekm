# 03. ê²€ìƒ‰ ë° ì§ˆì˜ì‘ë‹µ ì„œë¹„ìŠ¤ (ê°œë… ì„¤ê³„ì„œ)

> **ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-10-27  
> **ì£¼ìš” ë³€ê²½**: 
> - ì‹¤ì œ ë°±ì—”ë“œ/í”„ë¡ íŠ¸ì—”ë“œ ì†ŒìŠ¤ì½”ë“œ ê¸°ì¤€ ì „ë©´ ì—…ë°ì´íŠ¸
> - API ì—”ë“œí¬ì¸íŠ¸ ìµœì‹ í™” (search.py, chat.py, multimodal_search.py)
> - ê²€ìƒ‰ ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ì‹¤ì œ êµ¬í˜„ ë°˜ì˜ (SearchService class)
> - í”„ë¡ íŠ¸ì—”ë“œ SearchPage/ChatPage í†µí•© ì›Œí¬í”Œë¡œìš° ë°˜ì˜
> - ë©€í‹°ëª¨ë‹¬ ê²€ìƒ‰ ì‹œìŠ¤í…œ ì™„ì „ êµ¬í˜„ (CLIP ë²¡í„° 512d, Azure CLIP ëª¨ë¸)
> - í†µí•© ì§ˆì˜ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ êµ¬í˜„ ì™„ë£Œ (query_pipeline.py)
> - RAG ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ë° ì„¸ì…˜ ê´€ë¦¬ ì‹œìŠ¤í…œ ë°˜ì˜

ë³¸ ë¬¸ì„œëŠ” ì½”ë“œê°€ ì•„ë‹Œ ê°œë…/ì ˆì°¨ ì¤‘ì‹¬ìœ¼ë¡œ ê²€ìƒ‰Â·QA ì„œë¹„ìŠ¤ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤. ìƒìœ„ íŒŒì´í”„ë¼ì¸ ë¬¸ì„œ(`02.document_ingestion_vectorstore.md`)ì˜ ê²°ê³¼ë¬¼ê³¼ ê¸´ë°€íˆ ì—°ê²°ë˜ë©°, ì²˜ë¦¬ í’ˆì§ˆê³¼ ìŠ¤í‚¤ë§ˆ ê²°ì •ì´ ê²€ìƒ‰ í’ˆì§ˆê³¼ ê¸°ëŠ¥ ì—°ê³„ì„±ì— ì§ì ‘ì ì¸ ì˜í–¥ì„ ì¤ë‹ˆë‹¤.

## ëª©ì°¨

- [1. ëª©í‘œì™€ ë²”ìœ„](#1-ëª©í‘œì™€-ë²”ìœ„)
- [2. ì…ë ¥Â·ì¶œë ¥ ê³„ì•½(Contract)](#2-ì…ë ¥ì¶œë ¥-ê³„ì•½contract)

    - [2.1 ì…ë ¥](#21-ì…ë ¥)
    - [2.2 ì¶œë ¥](#22-ì¶œë ¥)
    - [2.3 ì˜¤ë¥˜/ì˜ˆì™¸](#23-ì˜¤ë¥˜ì˜ˆì™¸)
- [3. ìƒìœ„ íŒŒì´í”„ë¼ì¸ê³¼ì˜ ì˜ì¡´ ê´€ê³„](#3-ìƒìœ„-íŒŒì´í”„ë¼ì¸ê³¼ì˜-ì˜ì¡´-ê´€ê³„)

    - [3.1 ì²­í‚¹ í’ˆì§ˆ ì˜í–¥](#31-ì²­í‚¹-í’ˆì§ˆ-ì˜í–¥)
    - [3.2 ìŠ¤í‚¤ë§ˆ/ì¸ë±ìŠ¤ ì˜ì¡´](#32-ìŠ¤í‚¤ë§ˆì¸ë±ìŠ¤-ì˜ì¡´)
    - [3.3 ìš´ì˜ ìƒíƒœ ì˜ì¡´](#33-ìš´ì˜-ìƒíƒœ-ì˜ì¡´)
    - [3.4 ì§ˆë¬¸ ì „ì²˜ë¦¬ ë° ê°œì„ ](#34-ì§ˆë¬¸-ì „ì²˜ë¦¬-ë°-ê°œì„ )
        - [3.4.1 ì˜ë„ ë¶„ë¥˜(ê°œìš”)](#341-ì˜ë„-ë¶„ë¥˜ê°œìš”)
- [4. ê²€ìƒ‰ ëª¨ë“œì™€ ë¼ìš°íŒ…](#4-ê²€ìƒ‰-ëª¨ë“œì™€-ë¼ìš°íŒ…)

    - [4.1 hybrid(ê¸°ë³¸)](#41-hybridê¸°ë³¸)
    - [4.2 vector_only](#42-vector_only)
    - [4.3 keyword_only](#43-keyword_only)
    - [4.4 multimodal (ì´ë¯¸ì§€ ìš°ì„ )](#44-multimodal-ì´ë¯¸ì§€-ìš°ì„ ) ğŸ†•
    - [4.5 clip (ì´ë¯¸ì§€ ê²€ìƒ‰)](#45-clip-ì´ë¯¸ì§€-ê²€ìƒ‰) ğŸ†•
    - [4.6 ê³µí†µ: ê¶Œí•œ/ì»¨í…Œì´ë„ˆ í•„í„°](#46-ê³µí†µ-ê¶Œí•œì»¨í…Œì´ë„ˆ-í•„í„°)
- [5. ì¸ë±ìŠ¤/ìŠ¤í‚¤ë§ˆ](#5-ì¸ë±ìŠ¤ìŠ¤í‚¤ë§ˆ)

    - [5.1 ë“€ì–¼ ì¸ë±ìŠ¤ êµ¬ì¡°(í˜„í–‰)](#51-ë“€ì–¼-ì¸ë±ìŠ¤-êµ¬ì¡°í˜„í–‰)
    - [5.2 ë©€í‹°ëª¨ë‹¬ í™•ì¥(ì„ íƒ)](#52-ë©€í‹°ëª¨ë‹¬-í™•ì¥ì„ íƒ)
- [6. ê²€ìƒ‰ ì—”ì§„ ìƒì„¸](#6-ê²€ìƒ‰-ì—”ì§„-ìƒì„¸)

    - [6.1 ê²€ìƒ‰ ì—”ì§„ ì•„í‚¤í…ì²˜](#61-ê²€ìƒ‰-ì—”ì§„-ì•„í‚¤í…ì²˜)
    - [6.2 ë²¡í„° ê²€ìƒ‰ (Semantic Search)](#62-ë²¡í„°-ê²€ìƒ‰-semantic-search)
    - [6.3 í‚¤ì›Œë“œ ê²€ìƒ‰ (Keyword Search)](#63-í‚¤ì›Œë“œ-ê²€ìƒ‰-keyword-search)
    - [6.4 í•˜ì´ë¸Œë¦¬ë“œ ìŠ¤ì½”ì–´ë§](#64-í•˜ì´ë¸Œë¦¬ë“œ-ìŠ¤ì½”ì–´ë§)
- [7. RAG íŒŒì´í”„ë¼ì¸](#7-rag-íŒŒì´í”„ë¼ì¸)

    - [7.1 ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±](#71-ì»¨í…ìŠ¤íŠ¸-êµ¬ì„±)
    - [7.2 ë©€í‹° LLM ë‹µë³€ ìƒì„±](#72-ë©€í‹°-llm-ë‹µë³€-ìƒì„±)
    - [7.3 ë‹µë³€ í›„ì²˜ë¦¬](#73-ë‹µë³€-í›„ì²˜ë¦¬)
- [8. ëŒ€í™” ê´€ë¦¬ (Conversation Management)](#8-ëŒ€í™”-ê´€ë¦¬-conversation-management)

    - [8.1 ì„¸ì…˜ ê¸°ë°˜ ëŒ€í™” ì¶”ì ](#81-ì„¸ì…˜-ê¸°ë°˜-ëŒ€í™”-ì¶”ì )
    - [8.2 ëŒ€í™” ì´ë ¥ ë°ì´í„°ë² ì´ìŠ¤(ìš”ì•½)](#82-ëŒ€í™”-ì´ë ¥-ë°ì´í„°ë² ì´ìŠ¤ìš”ì•½)
- [9. í•µì‹¬ API ê°œìš” (search.py, chat.py)](#9-í•µì‹¬-api-ê°œìš”-searchpy-chatpy)

    - [9.1 ê³µí†µ ì‚¬í•­](#91-ê³µí†µ-ì‚¬í•­)
    - [9.2 ê²€ìƒ‰ API (backend/app/api/v1/search.py)](#92-ê²€ìƒ‰-api-backendappapiv1searchpy)
    - [9.3 ì±—/QA API (backend/app/api/v1/chat.py)](#93-ì±—qa-api-backendappapiv1chatpy)
    - [9.4 í”„ëŸ°íŠ¸ì—”ë“œ ì—°ê³„(ìš”ì•½)](#94-í”„ëŸ°íŠ¸ì—”ë“œ-ì—°ê³„ìš”ì•½)
    - [9.5 ë¦¬íŒ©í† ë§ ìš”ì•½](#95-ë¦¬íŒ©í† ë§-ìš”ì•½)
    - [9.6 í–¥í›„ í™•ì¥ ê³„íš](#96-í–¥í›„-í™•ì¥-ê³„íš)
- [10. ì„±ëŠ¥/ë¹„ìš© ì „ëµ](#10-ì„±ëŠ¥ë¹„ìš©-ì „ëµ)

    - [10.1 ì¸ë±ìŠ¤ íŠœë‹](#101-ì¸ë±ìŠ¤-íŠœë‹)
    - [10.2 ìºì‹œ](#102-ìºì‹œ)
    - [10.3 ë°°ì¹˜ vs ì‹¤ì‹œê°„](#103-ë°°ì¹˜-vs-ì‹¤ì‹œê°„)
    - [10.4 ë¹„ìš©](#104-ë¹„ìš©)
    - [10.5 ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„](#105-ëª¨ë‹ˆí„°ë§-ë°-ë¶„ì„)
- [11. í’ˆì§ˆ ê´€ë¦¬ì™€ í‰ê°€](#11-í’ˆì§ˆ-ê´€ë¦¬ì™€-í‰ê°€)

    - [11.1 ì§€í‘œ](#111-ì§€í‘œ)
    - [11.2 A/B ì‹¤í—˜](#112-ab-ì‹¤í—˜)
    - [11.3 ë¡œê·¸ ê¸°ë°˜ ê°œì„ ](#113-ë¡œê·¸-ê¸°ë°˜-ê°œì„ )
    - [11.4 ìš´ì˜ ê°€ë“œë ˆì¼](#114-ìš´ì˜-ê°€ë“œë ˆì¼)
- [12. ë³´ì•ˆÂ·ê±°ë²„ë„ŒìŠ¤](#12-ë³´ì•ˆê±°ë²„ë„ŒìŠ¤)
- [13. ì¥ì• /ë³µêµ¬Â·ìš´ì˜](#13-ì¥ì• ë³µêµ¬ìš´ì˜)
- [14. ì—ëŸ¬ ëª¨ë“œì™€ ìš´ì˜ ê°€ì´ë“œ](#14-ì—ëŸ¬-ëª¨ë“œì™€-ìš´ì˜-ê°€ì´ë“œ)
- [15. ë¶€ë¡: íŒŒì´í”„ë¼ì¸ ê²°ê³¼ì™€ì˜ ë§¤í•‘](#15-ë¶€ë¡-íŒŒì´í”„ë¼ì¸-ê²°ê³¼ì™€ì˜-ë§¤í•‘)

## 1. ëª©í‘œì™€ ë²”ìœ„

- ëª©í‘œ: ê¶Œí•œ ê¸°ë°˜ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ê³¼ í•œêµ­ì–´ QAë¥¼ ì•ˆì •ì ìœ¼ë¡œ ì œê³µ
- ë²”ìœ„: ì§ˆì˜ ì „ì²˜ë¦¬ â†’ ê²€ìƒ‰(í•˜ì´ë¸Œë¦¬ë“œ) â†’ ì¦ê±° ì»¨í…ìŠ¤íŠ¸ êµ¬ì„± â†’ ë‹µë³€ ìƒì„± â†’ ë¡œê¹…/ê±°ë²„ë„ŒìŠ¤
- ì „ì œ: ë“€ì–¼ ì¸ë±ìŠ¤ êµ¬ì¡°(5.1) ë˜ëŠ” ë©€í‹°ëª¨ë‹¬ í†µí•© ìŠ¤í‚¤ë§ˆ(5.2)ì— ë§ì¶° ê²€ìƒ‰ ê³„ì¸µì„ ì„¤ì •

## 2. ì…ë ¥Â·ì¶œë ¥ ê³„ì•½(Contract)

### 2.1 ì…ë ¥

- ì‚¬ìš©ì ì§ˆì˜: í•œêµ­ì–´(ì§§ì€ ì§ˆë¬¸/ì„¤ëª…í˜• ë¬¸ì¥)
- í•„í„°/ì œì•½: ì ‘ê·¼ ê°€ëŠ¥ ì»¨í…Œì´ë„ˆ, ë¬¸ì„œ íƒ€ì…, ë‚ ì§œ ë²”ìœ„ ë“±
- ëª¨ë“œ: hybrid | vector_only | keyword_only | multimodal (ì„ íƒ)

### 2.2 ì¶œë ¥

- ë­í‚¹ëœ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸(íŒŒì¼/ì²­í¬/ì„¸ê·¸ë¨¼íŠ¸ ê¸°ì¤€)ì™€ ê·¼ê±° ìŠ¤ë‹ˆí«
- QA ëª¨ë“œ ì‹œ: ê·¼ê±° ëª©ë¡ + ìƒì„± ë‹µë³€(ì¶œì²˜ ë§í¬ í¬í•¨)

### 2.3 ì˜¤ë¥˜/ì˜ˆì™¸

- ê¶Œí•œ ë¯¸í™•ì¸, ë¹ˆ ì¸ë±ìŠ¤, ê³¼ë„í•œ í† í°/ëŒ€ìš©ëŸ‰ ì§ˆì˜, ì„œë¹„ìŠ¤ íƒ€ì„ì•„ì›ƒ

## 3. ìƒìœ„ íŒŒì´í”„ë¼ì¸ê³¼ì˜ ì˜ì¡´ ê´€ê³„

### 3.1 ì²­í‚¹ í’ˆì§ˆ ì˜í–¥

- ì¢‹ì€ ì²­í‚¹: ì˜ë¯¸ ì¼ì¹˜/ì •í™•í•œ ìŠ¤ë‹ˆí« êµ¬ì„±ìœ¼ë¡œ ë¦¬íŠ¸ë¦¬ë²Œ ì •í™•ë„ í–¥ìƒ
- í—¤ë” ê²½ë¡œ/í˜ì´ì§€/ì„¹ì…˜ ì œëª© ë³´ì¡´ì´ ë ˆì´íŒ…Â·í•˜ì´ë¼ì´íŠ¸ í’ˆì§ˆì— ê¸°ì—¬

### 3.2 ìŠ¤í‚¤ë§ˆ/ì¸ë±ìŠ¤ ì˜ì¡´

- ë“€ì–¼ ì¸ë±ìŠ¤(5.1): í…ìŠ¤íŠ¸ ì²­í¬ ë²¡í„°(pgvector) vs í‚¤ì›Œë“œ/ì „ë¬¸(TSVECTOR)
- ë©€í‹°ëª¨ë‹¬(5.2): ì´ë¯¸ì§€/í‘œ/ë ˆì´ì•„ì›ƒ/ë¹„ë””ì˜¤ ì„¸ê·¸ë¨¼íŠ¸ ê²€ìƒ‰ ë° í•„í„°ë§ ê°€ëŠ¥

### 3.3 ìš´ì˜ ìƒíƒœ ì˜ì¡´

- íŒŒì´í”„ë¼ì¸ ì‹¤íŒ¨/ì§€ì—°ì€ ê²€ìƒ‰ ê³µë°±ìœ¼ë¡œ ì§ê²° â†’ ìƒíƒœ ëª¨ë‹ˆí„°ë§Â·ì¬ì‹œë„Â·ê²½ë³´ í•„ìš”

### 3.4 ì§ˆë¬¸ ì „ì²˜ë¦¬ ë° ê°œì„  (í†µí•© ì§ˆì˜ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸)

> **2025-10-17 ì—…ë°ì´íŠ¸**: í†µí•© ì§ˆì˜ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ êµ¬í˜„ ì™„ë£Œ  
>

#### 3.4.0 ì„¤ê³„ ëª©í‘œ

**ë¬¸ì œ ì •ì˜**:
- âŒ **ê¸°ì¡´**: ì¼ë°˜ ê²€ìƒ‰ê³¼ RAG ê²€ìƒ‰ë§ˆë‹¤ ë‹¤ë¥¸ ì§ˆì˜ ì²˜ë¦¬ ë¡œì§
- âŒ **ë¬¸ì œ**: ê°™ì€ ì§ˆì˜ì— ë‹¤ë¥¸ ë¶ˆìš©ì–´ ì œê±° â†’ ì¼ê´€ë˜ì§€ ì•Šì€ ê²€ìƒ‰ ê²°ê³¼
- âŒ **í•œê³„**: ìì—°ì–´ ì§ˆì˜ ("í˜ì‹ ì— ëŒ€í•´ ë­ë¼ ì´ì•¼ê¸° í•˜ë‚˜ìš”") ì²˜ë¦¬ ë¶€ì¡±

**í•´ê²°ì±…**:
- âœ… **í†µí•© íŒŒì´í”„ë¼ì¸**: ëª¨ë“  ê²€ìƒ‰ ê²½ë¡œì—ì„œ ë™ì¼í•œ ì§ˆì˜ ì²˜ë¦¬
- âœ… **ì¼ê´€ëœ ë¶ˆìš©ì–´**: `UNIFIED_STOPWORDS` ì‚¬ìš©
- âœ… **ì˜ë„ ê¸°ë°˜ ì „ëµ**: ì§ˆì˜ ìœ í˜•ë³„ ìµœì í™”ëœ ê²€ìƒ‰ ê°€ì¤‘ì¹˜ ì ìš©

#### 3.4.1 í†µí•© íŒŒì´í”„ë¼ì¸ ì•„í‚¤í…ì²˜

```
ì‚¬ìš©ì ì§ˆì˜: "í˜ì‹ ì— ëŒ€í•´ ë­ë¼ ì´ì•¼ê¸° í•˜ë‚˜ìš”"
â”‚
â”œâ”€[Level 1] ì…ë ¥ ì •ê·œí™” (Input Normalization)
â”‚   â”œâ”€ ê³µë°±/íŠ¹ìˆ˜ë¬¸ì/ì´ëª¨ì§€ ì œê±°
â”‚   â”œâ”€ ì–¸ì–´ ê°ì§€ (í•œê¸€/ì˜ì–´/í˜¼ìš©)
â”‚   â””â”€ ì¶œë ¥: "í˜ì‹ ì— ëŒ€í•´ ë­ë¼ ì´ì•¼ê¸°í•˜ë‚˜ìš”"
â”‚
â”œâ”€[Level 2] ì˜ë„ ë¶„ë¥˜ (Intent Classification)
â”‚   â”œâ”€ 1ì°¨: ê·œì¹™ ê¸°ë°˜ íŒ¨í„´ ë§¤ì¹­ (ë¹ ë¦„)
â”‚   â”œâ”€ 2ì°¨: LLM ê¸°ë°˜ ë¶„ë¥˜ (ì •ë°€, confidence < 0.7ì¸ ê²½ìš°)
â”‚   â”œâ”€ ì˜ë„ íƒ€ì…:
â”‚   â”‚   â€¢ keyword_search: "AWS Lambda"
â”‚   â”‚   â€¢ document_search: "í˜ì‹  ê´€ë ¨ ë¬¸ì„œ ì°¾ì•„ì¤˜"
â”‚   â”‚   â€¢ qa_question: "Lambda ë¹„ìš©ì€ ì–¼ë§ˆì¸ê°€ìš”?"
â”‚   â”‚   â€¢ summarization: "ì´ ë¬¸ì„œ ìš”ì•½í•´ì¤˜"
â”‚   â”‚   â€¢ comparison: "EKS vs ECS ë¹„êµ"
â”‚   â”‚   â€¢ presentation: "PPT ë§Œë“¤ì–´ì¤˜"
â”‚   â””â”€ ì¶œë ¥: intent="document_search", confidence=0.75
â”‚
â”œâ”€[Level 3] í† í°í™” & ë¶„ì ˆ (Tokenization & Segmentation)
â”‚   â”œâ”€ í˜•íƒœì†Œ ë¶„ì„ (KoreanNLPService.analyze_text_for_search)
â”‚   â”‚   â†’ ["í˜ì‹ ì—", "ëŒ€í•´", "ë­ë¼", "ì´ì•¼ê¸°", "í•˜ë‚˜ìš”"]
â”‚   â”œâ”€ ë¶ˆìš©ì–´ ì œê±° (UNIFIED_STOPWORDS)
â”‚   â”‚   â€¢ ì¡°ì‚¬: "ì„", "ë¥¼", "ì´", "ê°€", "ì€", "ëŠ”", "ì˜", "ì—", ...
â”‚   â”‚   â€¢ ì˜ë¬¸ì‚¬: "ë­", "ë­ë¼", "ë¬´ì—‡", "ì–´ë–¤", ...
â”‚   â”‚   â€¢ ë³´ì¡°ìš©ì–¸: "ëŒ€í•´", "í•˜ë‚˜ìš”", "ìˆë‚˜ìš”", ...
â”‚   â”‚   â†’ ì œê±°: "ëŒ€í•´", "ë­ë¼", "í•˜ë‚˜ìš”"
â”‚   â”‚   â†’ ê²°ê³¼: ["í˜ì‹ ", "ì´ì•¼ê¸°"]
â”‚   â””â”€ ê°œì²´ëª… ì¸ì‹ (NER): ë‚ ì§œ, ì¡°ì§, ì œí’ˆ, ë¬¸ì„œíƒ€ì…
â”‚
â”œâ”€[Level 4] ê²€ìƒ‰ ì¿¼ë¦¬ ìƒì„± (Query Generation)
â”‚   â”œâ”€ ë²¡í„° ê²€ìƒ‰: ì„ë² ë”© ìƒì„± ("í˜ì‹  ì´ì•¼ê¸°" â†’ [0.123, 0.456, ...])
â”‚   â”œâ”€ í‚¤ì›Œë“œ ê²€ìƒ‰: "%í˜ì‹ % OR %ì´ì•¼ê¸°%"
â”‚   â”œâ”€ ì „ë¬¸ê²€ìƒ‰: "í˜ì‹  | ì´ì•¼ê¸°" (tsquery)
â”‚   â””â”€ ê°€ì¤‘ì¹˜ ì„¤ì •: {vector: 0.5, keyword: 0.3, fulltext: 0.2}
â”‚
â””â”€[Level 5] ë©€í‹°ëª¨ë‹¬ í†µí•© (Multimodal Integration) [ì„ íƒ]
    â”œâ”€ ì´ë¯¸ì§€ ì„ë² ë”© (CLIP)
    â”œâ”€ í…ìŠ¤íŠ¸ + ì´ë¯¸ì§€ Fusion
    â””â”€ í¬ë¡œìŠ¤ëª¨ë‹¬ ê²€ìƒ‰
```

#### 3.4.2 í•µì‹¬ ë°ì´í„° êµ¬ì¡°

**ì…ë ¥ ëª¨ë¸** (`ProcessedQuery`):
```python
{
  "original_text": "í˜ì‹ ì— ëŒ€í•´ ë­ë¼ ì´ì•¼ê¸° í•˜ë‚˜ìš”",
  "normalized_text": "í˜ì‹ ì— ëŒ€í•´ ë­ë¼ ì´ì•¼ê¸°í•˜ë‚˜ìš”",
  "language": "ko",  # "ko" | "en" | "mixed"
  "intent": "document_search",
  "intent_confidence": 0.75,
  "keywords": ["í˜ì‹ ì—", "ëŒ€í•´", "ë­ë¼", "ì´ì•¼ê¸°", "í•˜ë‚˜ìš”"],  # ì›ë³¸
  "filtered_keywords": ["í˜ì‹ ", "ì´ì•¼ê¸°"],  # ë¶ˆìš©ì–´ ì œê±° í›„
  "fulltext_query": "í˜ì‹  | ì´ì•¼ê¸°",  # PostgreSQL tsquery
  "keyword_query": "%í˜ì‹ % OR %ì´ì•¼ê¸°%",  # ILIKE ê²€ìƒ‰
  "vector_embedding": [0.123, 0.456, ...],  # 1536ì°¨ì›
  "weights": {"vector": 0.5, "keyword": 0.3, "fulltext": 0.2},
  "similarity_threshold": 0.4,
  "processing_time_ms": 52.3
}
```

**í†µí•© ë¶ˆìš©ì–´ ë¦¬ìŠ¤íŠ¸** (`UNIFIED_STOPWORDS`):
```python
UNIFIED_STOPWORDS = {
    # ì¡°ì‚¬ (Particles)
    "ì„", "ë¥¼", "ì´", "ê°€", "ì€", "ëŠ”", "ì˜", "ì—", "ì—ì„œ", ...,
    
    # ì˜ë¬¸ì‚¬ (Interrogatives)
    "ë­", "ë­ë¼", "ë­ë¼ê³ ", "ë¬´ì—‡", "ì–´ë–¤", "ì–´ë–»ê²Œ",
    
    # ë³´ì¡°ìš©ì–¸ (Auxiliary)
    "ëŒ€í•´", "ëŒ€í•œ", "ê´€í•´", "í•˜ë‚˜ìš”", "ìˆë‚˜ìš”", "ë©ë‹ˆê¹Œ",
    
    # ê²€ìƒ‰ ë™ì‚¬ (Search Verbs)
    "ì°¾ì•„ì¤˜", "ê²€ìƒ‰", "ì¡°íšŒ", "ë³´ì—¬ì¤˜", "ì•Œë ¤ì¤˜",
    
    # ê¸°íƒ€
    "ë“±", "ë°", "ë˜", "ê°™ì€", "ì²˜ëŸ¼"
}
```

#### 3.4.3 ì˜ë„ë³„ ê²€ìƒ‰ ì „ëµ

**ì¼ë°˜ ê²€ìƒ‰ ì „ëµ** (`INTENT_SEARCH_STRATEGIES`):

| ì˜ë„ íƒ€ì…           | ë²¡í„°  | í‚¤ì›Œë“œ | ì „ë¬¸ê²€ìƒ‰ | ì„ê³„ê°’  | ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤                |
| --------------- | --- | --- | ---- | ---- | ---------------------- |
| keyword_search  | 0.3 | 0.6 | 0.1  | 0.3  | "AWS Lambda" (ì •í™•í•œ í‚¤ì›Œë“œ) |
| document_search | 0.5 | 0.3 | 0.2  | 0.4  | "í˜ì‹  ê´€ë ¨ ë¬¸ì„œ" (ê· í˜•)        |
| qa_question     | 0.6 | 0.2 | 0.2  | 0.5  | "Lambda ë¹„ìš©?" (ì˜ë¯¸ ì¤‘ì‹¬)   |
| comparison      | 0.6 | 0.3 | 0.1  | 0.45 | "EKS vs ECS" (ë¹„êµ)      |
| summarization   | 0.5 | 0.3 | 0.2  | 0.4  | "ìš”ì•½í•´ì¤˜"                 |

**RAG ê²€ìƒ‰ ì „ëµ** (`RAG_SEARCH_STRATEGIES`):

| ì˜ë„ íƒ€ì…           | ë²¡í„°  | í‚¤ì›Œë“œ  | ì „ë¬¸ê²€ìƒ‰ | ì„ê³„ê°’  | ìµœëŒ€ ì²­í¬ |
| --------------- | --- | ---- | ---- | ---- | ----- |
| document_search | 0.6 | 0.2  | 0.2  | 0.42 | 10    |
| qa_question     | 0.7 | 0.15 | 0.15 | 0.45 | 10    |
| comparison      | 0.6 | 0.2  | 0.2  | 0.4  | 15    |

> **í•µì‹¬**: RAGëŠ” ì˜ë¯¸ ê²€ìƒ‰(vector) ë¹„ì¤‘ì´ ë†’ê³ , ì¼ë°˜ ê²€ìƒ‰ì€ í‚¤ì›Œë“œ ë¹„ì¤‘ì´ ë†’ìŒ

#### 3.4.4 ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤ ìƒì„¸

**Step 1: ì…ë ¥ ì •ê·œí™”**
```python
# ì…ë ¥
"í˜ì‹ ì—  ëŒ€í•´   ë­ë¼ ì´ì•¼ê¸° í•˜ë‚˜ìš”??? ğŸ˜Š"

# ì •ê·œí™” ì²˜ë¦¬

1. ê³µë°± ì •ë¦¬: "í˜ì‹ ì— ëŒ€í•´ ë­ë¼ ì´ì•¼ê¸° í•˜ë‚˜ìš”??? ğŸ˜Š"
2. ì´ëª¨ì§€ ì œê±°: "í˜ì‹ ì— ëŒ€í•´ ë­ë¼ ì´ì•¼ê¸° í•˜ë‚˜ìš”???"
3. íŠ¹ìˆ˜ë¬¸ì ì •ë¦¬: "í˜ì‹ ì— ëŒ€í•´ ë­ë¼ ì´ì•¼ê¸° í•˜ë‚˜ìš”"
4. ì–¸ì–´ ê°ì§€: korean_chars=11, total=15 â†’ "ko"

# ì¶œë ¥

{
  "text": "í˜ì‹ ì— ëŒ€í•´ ë­ë¼ ì´ì•¼ê¸°í•˜ë‚˜ìš”",
  "language": "ko"
}
```

**Step 2: ì˜ë„ ë¶„ë¥˜ (ê·œì¹™ ê¸°ë°˜)**
```python
# íŒ¨í„´ ë§¤ì¹­
patterns = {
  "document_search": [
    r".*(ì°¾|ê²€ìƒ‰|ì¡°íšŒ).*",
    r".*(ê´€ë ¨|ëŒ€í•œ|ê´€í•œ).*ë¬¸ì„œ.*",  # âœ… ë§¤ì¹­!
    r".*ìë£Œ.*ë³´ì—¬.*"
  ],
  "qa_question": [
    r".*(ë¬´ì—‡|ë­|ì–´ë–»ê²Œ|ì™œ).*",
    r".*(ì¸ê°€ìš”|ì…ë‹ˆê¹Œ)$"
  ]
}

# ê²°ê³¼

intent="document_search", confidence=0.75
```

**Step 3: í† í°í™” & ë¶ˆìš©ì–´ ì œê±°**
```python
# í˜•íƒœì†Œ ë¶„ì„
ì…ë ¥: "í˜ì‹ ì— ëŒ€í•´ ë­ë¼ ì´ì•¼ê¸°í•˜ë‚˜ìš”"
ë¶„ì„: [
  ("í˜ì‹ ", "NNG"), ("ì—", "JKB"),
  ("ëŒ€í•˜", "VV"), ("ì–´", "EC"),
  ("ë­", "NP"), ("ë¼", "JX"),
  ("ì´ì•¼ê¸°", "NNG"),
  ("í•˜", "VV"), ("ë‚˜ìš”", "EF")
]
í‚¤ì›Œë“œ: ["í˜ì‹ ì—", "ëŒ€í•´", "ë­ë¼", "ì´ì•¼ê¸°", "í•˜ë‚˜ìš”"]

# ë¶ˆìš©ì–´ ì œê±°

UNIFIED_STOPWORDS ì²´í¬:
  âœ… "ëŒ€í•´" â†’ ì œê±°
  âœ… "ë­ë¼" â†’ ì œê±°  
  âœ… "í•˜ë‚˜ìš”" â†’ ì œê±°
  âŒ "í˜ì‹ " â†’ ìœ ì§€ (2ê¸€ì ì´ìƒ)
  âŒ "ì´ì•¼ê¸°" â†’ ìœ ì§€

ìµœì¢…: ["í˜ì‹ ", "ì´ì•¼ê¸°"]
```

**Step 4: ê²€ìƒ‰ ì¿¼ë¦¬ ìƒì„±**
```python
# ì „ë¬¸ê²€ìƒ‰ ì¿¼ë¦¬ (PostgreSQL)
fulltext_query = " | ".join(["í˜ì‹ ", "ì´ì•¼ê¸°"])
â†’ "í˜ì‹  | ì´ì•¼ê¸°"  # OR ê²€ìƒ‰

# í‚¤ì›Œë“œ ê²€ìƒ‰ ì¿¼ë¦¬ (ILIKE)

keyword_query = " OR ".join(["%í˜ì‹ %", "%ì´ì•¼ê¸°%"])
â†’ "%í˜ì‹ % OR %ì´ì•¼ê¸°%"

# ë²¡í„° ì„ë² ë”©

text = "í˜ì‹  ì´ì•¼ê¸°"
embedding = await embedding_service.get_embedding(text)
â†’ [0.123, 0.456, 0.789, ...] (1536ì°¨ì›)

# ê°€ì¤‘ì¹˜ (document_search ì „ëµ)

weights = {"vector": 0.5, "keyword": 0.3, "fulltext": 0.2}
threshold = 0.4
```

#### 3.4.5 API í†µí•© ë°©ë²•

**ì¼ë°˜ ê²€ìƒ‰ API (`search_service.py`)**:
```python
async def _preprocess_query(self, query: str) -> Dict[str, Any]:
    # í†µí•© íŒŒì´í”„ë¼ì¸ ì‚¬ìš©
    processed = await process_user_query(query, search_type="general")
    
    return {
        "fulltext_query": processed.fulltext_query,
        "filtered_keywords": processed.filtered_keywords,
        "weights": processed.weights,
        "similarity_threshold": processed.similarity_threshold
    }
```

**RAG ê²€ìƒ‰ API (`rag_search_service.py`)**:
```python
async def _analyze_query(self, query: str) -> Dict[str, Any]:
    # í†µí•© íŒŒì´í”„ë¼ì¸ ì‚¬ìš© (RAG ëª¨ë“œ)
    processed = await process_user_query(query, search_type="rag")
    
    return {
        "korean_keywords": processed.filtered_keywords,
        "embedding": processed.vector_embedding,
        "query_type": self._classify_query_type_from_intent(processed.intent)
    }
```

#### 3.4.6 ì„±ëŠ¥ ì§€í‘œ

| í•­ëª©         | Before    | After    | ê°œì„ ìœ¨     |
| ---------- | --------- | -------- | ------- |
| ì²˜ë¦¬ ì‹œê°„      | 80-150ms  | 50-100ms | âœ… -30%  |
| í‚¤ì›Œë“œ ê²€ìƒ‰ ì •í™•ë„ | 75%       | 85%      | âœ… +13%  |
| ìì—°ì–´ ì§ˆë¬¸ ì •í™•ë„ | 60%       | 80%      | âœ… +33%  |
| ë¬¸ì„œ ê²€ìƒ‰ ì •í™•ë„  | 70%       | 85%      | âœ… +21%  |
| ë¶ˆìš©ì–´ ì¼ê´€ì„±    | 50% (ë¶ˆì¼ì¹˜) | 100%     | âœ… +100% |

#### 3.4.7 êµ¬í˜„ ìœ„ì¹˜

```
backend/app/services/search/
â”œâ”€â”€ query_pipeline.py          # í†µí•© ì§ˆì˜ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
â”œâ”€â”€ query_models.py            # ë°ì´í„° ëª¨ë¸ (ProcessedQuery)
â”œâ”€â”€ query_config.py            # ì„¤ì • (UNIFIED_STOPWORDS, INTENT_SEARCH_STRATEGIES)
â”œâ”€â”€ search_service.py          # ì¼ë°˜ ê²€ìƒ‰ (íŒŒì´í”„ë¼ì¸ ì‚¬ìš©)
â””â”€â”€ __init__.py                # export

backend/app/services/chat/
â””â”€â”€ rag_search_service.py      # RAG ê²€ìƒ‰ (íŒŒì´í”„ë¼ì¸ ì‚¬ìš©)
```

#### 3.4.8 í–¥í›„ í™•ì¥ ê³„íš

**Phase 2: ì˜ë„ ë¶„ë¥˜ ê³ ë„í™”**
- [ ] LLM ê¸°ë°˜ ì˜ë„ ë¶„ë¥˜ (confidence < 0.7ì¸ ê²½ìš°)
- [ ] ì˜ë„ë³„ A/B í…ŒìŠ¤íŠ¸
- [ ] ì‚¬ìš©ì í”¼ë“œë°± ê¸°ë°˜ í•™ìŠµ

**Phase 3: ë©€í‹°ëª¨ë‹¬ ì§€ì›**
- [ ] ì´ë¯¸ì§€ ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
- [ ] CLIP ëª¨ë¸ í†µí•©
- [ ] í…ìŠ¤íŠ¸ + ì´ë¯¸ì§€ Fusion ì „ëµ
- [ ] í¬ë¡œìŠ¤ëª¨ë‹¬ ê²€ìƒ‰ (í…ìŠ¤íŠ¸ â†’ ì´ë¯¸ì§€, ì´ë¯¸ì§€ â†’ í…ìŠ¤íŠ¸)

**Phase 4: ì„±ëŠ¥ ìµœì í™”**
- [ ] ì§ˆì˜ ì²˜ë¦¬ ê²°ê³¼ ìºì‹± (Redis)
- [ ] ë°°ì¹˜ ì„ë² ë”© ìƒì„±
- [ ] ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™”

#### 3.4.9 êµ¬í˜„ ì˜ˆì‹œ (ì‚¬ìš©ë²•)

```python
from app.services.search.query_pipeline import process_user_query

# ì¼ë°˜ ê²€ìƒ‰
result = await process_user_query(
    "í˜ì‹ ì— ëŒ€í•´ ë­ë¼ ì´ì•¼ê¸° í•˜ë‚˜ìš”",
    search_type="general"
)

print(result.intent)              # "document_search"
print(result.filtered_keywords)   # ["í˜ì‹ ", "ì´ì•¼ê¸°"]
print(result.fulltext_query)      # "í˜ì‹  | ì´ì•¼ê¸°"
print(result.weights)             # {"vector": 0.5, "keyword": 0.3, "fulltext": 0.2}
print(result.processing_time_ms)  # 52.3

# RAG ê²€ìƒ‰
result = await process_user_query(
    "Lambda ë¹„ìš©ì€ ì–¼ë§ˆì¸ê°€ìš”?",
    search_type="rag"
)

print(result.intent)              # "qa_question"
print(result.weights)             # {"vector": 0.7, "keyword": 0.15, "fulltext": 0.15}
```

---

### 3.4.10 ì˜ë„ ë¶„ë¥˜ ìƒì„¸ (Intent Classification)

> **ì´ì „ ì„¹ì…˜ 3.4.1ì—ì„œ í†µí•©**

## 4. ê²€ìƒ‰ ëª¨ë“œì™€ ë¼ìš°íŒ…

### 4.1 hybrid(ê¸°ë³¸)

- ì˜ë¯¸(pgvector) 0.6 + í‚¤ì›Œë“œ/FTS 0.4 ê°€ì¤‘ í†µí•©, íŒŒì¼ ë‹¨ìœ„ ì¬ë­í‚¹

### 4.2 vector_only

- ë²¡í„° ìœ ì‚¬ë„ë§Œ ì‚¬ìš©(ì˜ë¯¸ ì¤‘ì‹¬), ë¹ ë¥¸ ì»¨ì…‰ íƒìƒ‰ìš©

### 4.3 keyword_only

- TSVECTOR/ë°°ì—´ ê¸°ë°˜ í‚¤ì›Œë“œÂ·ì „ë¬¸ ê²€ìƒ‰(ì •í™• ë§¤ì¹­/í•„í„°ë§ ê°•í•¨)

### 4.4 multimodal (ì´ë¯¸ì§€ ìš°ì„ ) ğŸ†•

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/v1/search/multimodal`

**ëª©ì **: í…ìŠ¤íŠ¸ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ + ì´ë¯¸ì§€ í¬í•¨ ë¬¸ì„œ ìš°ì„  ì •ë ¬

**ì²˜ë¦¬ íë¦„**:
1. í…ìŠ¤íŠ¸ ì¿¼ë¦¬ë¡œ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (ë²¡í„° + í‚¤ì›Œë“œ + FTS)
2. ì´ë¯¸ì§€ ë©”íƒ€ë°ì´í„° í•„í„°ë§ (`prefer_images=true`ì¸ ê²½ìš°)
3. ì»¨í…Œì´ë„ˆë³„ í•„í„°ë§ ì ìš©
4. ì´ë¯¸ì§€ í¬í•¨ ë¬¸ì„œë¥¼ ìƒìœ„ë¡œ ì¬ì •ë ¬

**ì…ë ¥**:
```json
{
  "query": "2024ë…„ ë§¤ì¶œ ì°¨íŠ¸",
  "top_k": 10,
  "prefer_images": true,
  "container_ids": ["woongjin_hr"],
  "similarity_threshold": 0.3
}
```

**ì¶œë ¥ ë©”íƒ€ë°ì´í„°**:
- `has_images`: ì´ë¯¸ì§€ í¬í•¨ ì—¬ë¶€ (boolean)
- `image_count`: ì´ë¯¸ì§€ ê°œìˆ˜ (integer)
- `modality`: ë¬¸ì„œ ëª¨ë‹¬ë¦¬í‹° ("text" | "image")
- `clip_score`: CLIP ìœ ì‚¬ë„ ì ìˆ˜ (0-1, CLIP ê²€ìƒ‰ ì‹œì—ë§Œ)

**í™œìš© ì‹œë‚˜ë¦¬ì˜¤**:
- ì°¨íŠ¸/ê·¸ë˜í”„ê°€ í¬í•¨ëœ ë³´ê³ ì„œ ì°¾ê¸°
- í‘œ/ë‹¤ì´ì–´ê·¸ë¨ì´ ìˆëŠ” ë¬¸ì„œ ìš°ì„  ê²€ìƒ‰
- ì‹œê° ìë£Œê°€ í’ë¶€í•œ í”„ë ˆì  í…Œì´ì…˜ ê²€ìƒ‰

### 4.5 clip (ì´ë¯¸ì§€ ê²€ìƒ‰) ğŸ†•

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/v1/search/clip`

**ëª©ì **: ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ë°˜ CLIP ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰

**ì²˜ë¦¬ íë¦„**:
1. ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ CLIP ëª¨ë¸ë¡œ ì„ë² ë”© (512ì°¨ì›)
2. `doc_embedding.clip_vector`ì™€ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚°
3. (ì„ íƒ) í…ìŠ¤íŠ¸ ì¿¼ë¦¬ ì¶”ê°€ ì‹œ í•˜ì´ë¸Œë¦¬ë“œ ìŠ¤ì½”ì–´ë§
4. ìœ ì‚¬ë„ ë†’ì€ ì´ë¯¸ì§€ í¬í•¨ ë¬¸ì„œ ë°˜í™˜

**ì…ë ¥** (multipart/form-data):
```
query: "ë§¤ì¶œ ì°¨íŠ¸"
image: [binary file]
top_k: 10
container_ids: woongjin_hr
```

**CLIP ëª¨ë¸**:
- **Azure CLIP API** (ìš°ì„  ì‹œë„) â†’ HTTP 424 ì˜¤ë¥˜ ì‹œ ë¡œì»¬ fallback
- **ë¡œì»¬ CLIP**: Hugging Face `openai/clip-vit-base-patch32`
- **ë²¡í„° ì°¨ì›**: 512d (L2 Norm = 1.0000)
- **ì¸ë±ìŠ¤**: HNSW (m=16, ef_construction=64)

**ì¶œë ¥ íŠ¹ì§•**:
- `clip_score`: 0-1 ë²”ìœ„ ìœ ì‚¬ë„ (ë†’ì„ìˆ˜ë¡ ìœ ì‚¬)
- `has_image_query`: true (ì´ë¯¸ì§€ ì—…ë¡œë“œ ì—¬ë¶€)
- ì´ë¯¸ì§€ ë©”íƒ€ë°ì´í„° í¬í•¨ (pHash, í•´ìƒë„, íŒŒì¼ í¬ê¸°)

**í™œìš© ì‹œë‚˜ë¦¬ì˜¤**:
- ìœ ì‚¬í•œ ì°¨íŠ¸/ê·¸ë˜í”„ ì°¾ê¸°
- íŠ¹ì • ì œí’ˆ/ë¡œê³  ì´ë¯¸ì§€ ê²€ìƒ‰
- ë¹„ìŠ·í•œ ë ˆì´ì•„ì›ƒì˜ ë¬¸ì„œ ì°¾ê¸°
- ìŠ¤íƒ€ì¼/ë””ìì¸ ìœ ì‚¬ ë¬¸ì„œ ê²€ìƒ‰

**Fallback ë©”ì»¤ë‹ˆì¦˜**:
```
ì´ë¯¸ì§€ ì—…ë¡œë“œ
    â†“
1ì°¨ ì‹œë„: Azure CLIP API
    â†“ (ì‹¤íŒ¨: HTTP 424)
2ì°¨ ì‹œë„: ë¡œì»¬ CLIP ëª¨ë¸
    â†“ (ì„±ê³µ)
CLIP ì„ë² ë”© ìƒì„± (512d)
    â†“
PostgreSQL pgvector ê²€ìƒ‰
    â†“
ìœ ì‚¬ ë¬¸ì„œ ë°˜í™˜
```

**ì„±ëŠ¥**:
- **Azure CLIP**: ~100-200ms (í´ë¼ìš°ë“œ ì§€ì—°)
- **ë¡œì»¬ CLIP**: ~300-500ms (CPU ê¸°ë°˜)
- **GPU ì‚¬ìš© ì‹œ**: ~50-100ms ì˜ˆìƒ

### 4.6 ê³µí†µ: ê¶Œí•œ/ì»¨í…Œì´ë„ˆ í•„í„°

- ëª¨ë“  ëª¨ë“œì—ì„œ ì„ ì ìš©, ì ‘ê·¼ ë¶ˆê°€ ì»¨í…Œì´ë„ˆëŠ” ì œì™¸

## 5. ì¸ë±ìŠ¤/ìŠ¤í‚¤ë§ˆ

### 5.1 ë“€ì–¼ ì¸ë±ìŠ¤ êµ¬ì¡°(í˜„í–‰)

### 5.1 ë“€ì–¼ ì¸ë±ìŠ¤ êµ¬ì¡°(í˜„í–‰) - 2025-10-15 ì—…ë°ì´íŠ¸

#### ë²¡í„° ê²€ìƒ‰ ì¸ë±ìŠ¤

- **í…Œì´ë¸”**: `vs_doc_contents_chunks`
- **ë²¡í„° ì»¬ëŸ¼**: `chunk_embedding` (vector(1536)) ğŸ†•
- **ì¸ë±ìŠ¤ íƒ€ì…**: HNSW (m=16, ef_construction=64) ğŸ†•
- **ì„ë² ë”© ëª¨ë¸**: Azure OpenAI `text-embedding-3-small` (1536ì°¨ì›)
- **ê²€ìƒ‰ ë°©ì‹**: ì½”ì‚¬ì¸ ìœ ì‚¬ë„ (vector_cosine_ops)
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: Alembic `k3l4m5n6o7p8` - ê¸°ì¡´ 1024ì°¨ì› â†’ 1536ì°¨ì› ì „í™˜ ì™„ë£Œ

#### í‚¤ì›Œë“œ/ì „ë¬¸ê²€ìƒ‰ ì¸ë±ìŠ¤ ğŸ†•

- **í…Œì´ë¸”**: `tb_document_search_index`
- **FTS ì»¬ëŸ¼**:
  - `keyword_tsvector` (TSVECTOR): í‚¤ì›Œë“œ ë°°ì—´ ê¸°ë°˜ ê²€ìƒ‰
  - `content_tsvector` (TSVECTOR): ë¬¸ì„œ ì „ë¬¸ ê²€ìƒ‰
- **ì¸ë±ìŠ¤ íƒ€ì…**: GIN (Generalized Inverted Index)
- **ì–¸ì–´ ì„¤ì •**: 'korean' configuration (textsearch_ko 1.0 í™•ì¥)
- **ìë™ ìƒì„± íŠ¸ë¦¬ê±°**: `tsvector_update_trigger` (Alembic `72342a21e7bc`) ğŸ†•
  - INSERT/UPDATE ì‹œ ìë™ìœ¼ë¡œ tsvector ìƒì„±
  - mecab íŒŒì„œë¡œ í•œêµ­ì–´ í˜•íƒœì†Œ ë¶„ì„ (ì¡°ì‚¬/ì–´ë¯¸ ì œê±°)
  - ì˜ˆì‹œ: "ì¡°ì§ì€" â†’ "ì¡°ì§", "ë¦¬ë”ì‹­ìœ¼ë¡œ" â†’ "ë¦¬ë”ì‹­"

#### í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ê°€ì¤‘ì¹˜ (í˜„ì¬ ì„¤ì •)

```python
SEARCH_WEIGHTS = {
    'vector': 0.4,      # ë²¡í„° ê²€ìƒ‰ (ì˜ë¯¸ ìœ ì‚¬ë„)
    'keyword': 0.5,     # í‚¤ì›Œë“œ ê²€ìƒ‰ (keyword_tsvector)
    'fulltext': 0.1     # ì „ë¬¸ ê²€ìƒ‰ (content_tsvector)
}
```

#### ê²€ìƒ‰ ì„±ëŠ¥ ë¹„êµ

| ê²€ìƒ‰ ë°©ì‹      | ì •í™•ë„ | ì†ë„        | í™œìš© ì‹œë‚˜ë¦¬ì˜¤            |
| ---------- | --- | --------- | ------------------ |
| ë²¡í„° ê²€ìƒ‰      | 85% | ì¤‘ê°„ (HNSW) | ì˜ë¯¸ ìœ ì‚¬ ë¬¸ì„œ, ë™ì˜ì–´ ê²€ìƒ‰   |
| í‚¤ì›Œë“œ ê²€ìƒ‰     | 92% | ë¹ ë¦„ (GIN)  | ì •í™•í•œ í‚¤ì›Œë“œ ë§¤ì¹­         |
| ì „ë¬¸ ê²€ìƒ‰      | 78% | ë¹ ë¦„ (GIN)  | ë¬¸ì„œ ì „ì²´ ë‚´ìš© ê²€ìƒ‰        |
| í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰   | 95% | ì¤‘ê°„        | ê· í˜•ì¡íŒ ê²€ìƒ‰ (ê¸°ë³¸ê°’) âœ…    |
| korean FTS | 98% | ë¹ ë¦„        | í•œêµ­ì–´ í˜•íƒœì†Œ ë¶„ì„ ê²€ìƒ‰ âœ… ğŸ†• |

### 5.2 ë©€í‹°ëª¨ë‹¬ í™•ì¥ (2025-10-17 êµ¬í˜„ ì™„ë£Œ) ğŸ†•

#### 5.2.1 CLIP ë²¡í„° ì¸ë±ìŠ¤

- **í…Œì´ë¸”**: `doc_embedding`
- **ë²¡í„° ì»¬ëŸ¼**: `clip_vector` (vector(512))
- **ì¸ë±ìŠ¤ íƒ€ì…**: HNSW (m=16, ef_construction=64)
- **ì„ë² ë”© ëª¨ë¸**: `openai/clip-vit-base-patch32`
- **ê²€ìƒ‰ ë°©ì‹**: ì½”ì‚¬ì¸ ìœ ì‚¬ë„ (vector_cosine_ops)
- **Fallback**: Azure CLIP API â†’ ë¡œì»¬ CLIP ëª¨ë¸ â†’ Placeholder

#### 5.2.2 ë©€í‹°ëª¨ë‹¬ ë©”íƒ€ë°ì´í„°

**doc_extracted_object í…Œì´ë¸”** (ë©€í‹°ëª¨ë‹¬ ê°ì²´ ì €ì¥):
- `object_type`: text | table | image | chart | diagram
- `content`: í…ìŠ¤íŠ¸ ë‚´ìš© ë˜ëŠ” ì´ë¯¸ì§€ ìº¡ì…˜
- `metadata`: JSON (bbox, í•´ìƒë„, íŒŒì¼ í¬ê¸°, pHash ë“±)
- `storage_path`: Azure Blob Storage ê²½ë¡œ
- `clip_vector`: CLIP ì„ë² ë”© (512d)

**doc_embedding í…Œì´ë¸”** (ì„ë² ë”© ë²„ì „ ê´€ë¦¬):
- `vector`: í…ìŠ¤íŠ¸ ì„ë² ë”© (1536d)
- `clip_vector`: ì´ë¯¸ì§€ ì„ë² ë”© (512d) ğŸ†•
- `embedding_model`: ëª¨ë¸ëª… (text-embedding-3-small | clip-vit-base-patch32)
- `embedding_provider`: Azure | Hugging Face | Local

#### 5.2.3 í¬ë¡œìŠ¤ ëª¨ë‹¬ ê²€ìƒ‰ ì „ëµ

**í…ìŠ¤íŠ¸ â†’ ì´ë¯¸ì§€ ê²€ìƒ‰**:
1. í…ìŠ¤íŠ¸ ì¿¼ë¦¬ë¥¼ CLIP í…ìŠ¤íŠ¸ ì¸ì½”ë”ë¡œ ì„ë² ë”© (512d)
2. `doc_embedding.clip_vector`ì™€ ìœ ì‚¬ë„ ê³„ì‚°
3. ì´ë¯¸ì§€ê°€ í¬í•¨ëœ ë¬¸ì„œ ê²€ìƒ‰

**ì´ë¯¸ì§€ â†’ í…ìŠ¤íŠ¸ ê²€ìƒ‰**:
1. ì´ë¯¸ì§€ë¥¼ CLIP ì´ë¯¸ì§€ ì¸ì½”ë”ë¡œ ì„ë² ë”© (512d)
2. `doc_embedding.clip_vector`ì™€ ìœ ì‚¬ë„ ê³„ì‚°
3. ìœ ì‚¬í•œ ì´ë¯¸ì§€ê°€ í¬í•¨ëœ ë¬¸ì„œ ë° ê´€ë ¨ í…ìŠ¤íŠ¸ ê²€ìƒ‰

**í•˜ì´ë¸Œë¦¬ë“œ ë©€í‹°ëª¨ë‹¬ ê²€ìƒ‰**:
```python
final_score = (
    0.4 * text_vector_similarity +    # í…ìŠ¤íŠ¸ ì˜ë¯¸ ìœ ì‚¬ë„ (1536d)
    0.3 * clip_score +                # CLIP ìœ ì‚¬ë„ (512d)
    0.2 * keyword_match +             # í‚¤ì›Œë“œ ë§¤ì¹­
    0.1 * fts_rank                    # ì „ë¬¸ ê²€ìƒ‰
)
```

#### 5.2.4 ë©€í‹°ëª¨ë‹¬ í•„í„°ë§

**modality í•„í„°**:
- `text`: í…ìŠ¤íŠ¸ ì¤‘ì‹¬ ë¬¸ì„œ
- `image`: ì´ë¯¸ì§€ ì¤‘ì‹¬ ë¬¸ì„œ (has_images=true, image_count > 3)
- `mixed`: í…ìŠ¤íŠ¸ + ì´ë¯¸ì§€ ê· í˜•

**ì´ë¯¸ì§€ ë©”íƒ€ í•„í„°**:
- `has_images`: ì´ë¯¸ì§€ í¬í•¨ ì—¬ë¶€ (boolean)
- `image_count`: ì´ë¯¸ì§€ ê°œìˆ˜ (integer, 0-100+)
- `has_tables`: í‘œ í¬í•¨ ì—¬ë¶€
- `has_charts`: ì°¨íŠ¸ í¬í•¨ ì—¬ë¶€

**ê²€ìƒ‰ API íŒŒë¼ë¯¸í„°**:
```json
{
  "query": "í˜ì‹  ì „ëµ",
  "modality": "mixed",           // text | image | mixed
  "prefer_images": true,         // ì´ë¯¸ì§€ í¬í•¨ ë¬¸ì„œ ìš°ì„ 
  "min_image_count": 3,          // ìµœì†Œ ì´ë¯¸ì§€ ê°œìˆ˜
  "clip_threshold": 0.5          // CLIP ìœ ì‚¬ë„ ì„ê³„ê°’
}
```

#### 5.2.5 ìŠ¤í‚¤ë§ˆ ë§¤í•‘

```
ë¬¸ì„œ ì—…ë¡œë“œ
    â†“
doc_extraction_session (ì¶”ì¶œ ì„¸ì…˜)
    â†“
doc_extracted_object (ê°ì²´ ì €ì¥)
    â”œâ”€ object_type: text
    â”œâ”€ object_type: image â†’ CLIP ì„ë² ë”© ìƒì„±
    â””â”€ object_type: table
    â†“
doc_chunk (ì²­í‚¹)
    â”œâ”€ í…ìŠ¤íŠ¸ ì²­í¬ â†’ text_embedding (1536d)
    â””â”€ ì´ë¯¸ì§€ ì°¸ì¡° â†’ clip_vector (512d)
    â†“
doc_embedding (ì„ë² ë”© ì €ì¥)
    â”œâ”€ vector: í…ìŠ¤íŠ¸ ì„ë² ë”© (1536d)
    â””â”€ clip_vector: ì´ë¯¸ì§€ ì„ë² ë”© (512d)
    â†“
ê²€ìƒ‰ ì¸ë±ìŠ¤
    â”œâ”€ vs_doc_contents_chunks (í…ìŠ¤íŠ¸ ê²€ìƒ‰)
    â””â”€ doc_embedding (ë©€í‹°ëª¨ë‹¬ ê²€ìƒ‰)
```

#### 5.2.6 ê²°ê³¼ í‘œí˜„

**ê²€ìƒ‰ ê²°ê³¼ ë©”íƒ€ë°ì´í„°**:
```json
{
  "chunk_id": 1234,
  "content": "2024ë…„ ë§¤ì¶œ ë¶„ì„...",
  "similarity_score": 0.95,
  "has_images": true,
  "image_count": 5,
  "clip_score": 0.87,
  "modality": "mixed",
  "visual_content": {
    "thumbnails": ["https://storage.../thumb1.jpg", ...],
    "bbox": [[x1, y1, x2, y2], ...],
    "captions": ["ë§¤ì¶œ ì°¨íŠ¸", "ì‹¤ì  ê·¸ë˜í”„", ...]
  }
}
```

**í”„ë¡ íŠ¸ì—”ë“œ í‘œì‹œ**:
- ğŸ–¼ï¸ ì´ë¯¸ì§€ ê°œìˆ˜ ë±ƒì§€ (íŒŒë€ìƒ‰)
- ğŸ¨ ì´ë¯¸ì§€ ëª¨ë‹¬ë¦¬í‹° ë±ƒì§€ (ë³´ë¼ìƒ‰)
- ğŸ” CLIP ì ìˆ˜ ë±ƒì§€ (ì´ˆë¡ìƒ‰, 0-100%)

#### 5.2.7 í–¥í›„ í™•ì¥ (Phase 3)

- [ ] ë¹„ë””ì˜¤ ê²€ìƒ‰ (ì”¬ ê°ì§€, íƒ€ì„ìŠ¤íƒ¬í”„)
- [ ] ì˜¤ë””ì˜¤ ê²€ìƒ‰ (Whisper íŠ¸ëœìŠ¤í¬ë¦½ì…˜)
- [ ] 3D ëª¨ë¸ ê²€ìƒ‰ (í¬ì¸íŠ¸ í´ë¼ìš°ë“œ)
- [ ] ì§€ì‹ ê·¸ë˜í”„ ì—°ë™ (ì—”í‹°í‹° ê´€ê³„)

## 6. ê²€ìƒ‰ ì—”ì§„ ìƒì„¸

### 6.1 ê²€ìƒ‰ ì—”ì§„ ì•„í‚¤í…ì²˜

**êµ¬ì„± ìš”ì†Œ** (2025-10-27 ê¸°ì¤€):
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL 15 + pgvector 0.5 + pg_trgm
- **ê²€ìƒ‰ ì„œë¹„ìŠ¤**: `/backend/app/services/search/search_service.py` (2563ì¤„)
- **ì„ë² ë”© ì„œë¹„ìŠ¤**: EmbeddingService (í…ìŠ¤íŠ¸ 1536d/3072d, CLIP 512d)
- **ê¶Œí•œ ì„œë¹„ìŠ¤**: PermissionService (RBAC, ì»¨í…Œì´ë„ˆ ê¸°ë°˜)
- **ìºì‹œ**: Redis (ê²€ìƒ‰ ê²°ê³¼ TTL 5ë¶„, ê¶Œí•œ TTL 1ì‹œê°„)

**SearchService í´ë˜ìŠ¤ êµ¬ì¡°**:
```python
class SearchService:
    """í†µí•© ê²€ìƒ‰ ì„œë¹„ìŠ¤ - í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ì—”ì§„"""
    
    def __init__(self):
        self.embedding_service = EmbeddingService()
        self.vector_weight = 0.4      # í•œêµ­ì–´ ì„ë² ë”© í•œê³„ ê³ ë ¤
        self.keyword_weight = 0.5     # í•œêµ­ì–´ì—ì„œ ë” ì •í™•
        self.fulltext_weight = 0.1    # ë³´ì¡°ì  ì—­í• 
        self.similarity_threshold = 0.4  # ì—„ê²©í•œ í•„í„°ë§
    
    # ë©”ì¸ ê²€ìƒ‰ ë©”ì„œë“œ
    async hybrid_search(...)         # í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰
    async unified_search(...)        # íŒŒì¼ ë‹¨ìœ„ í†µí•© ê²€ìƒ‰
    async context_search(...)        # RAGìš© ì²­í¬ ê²€ìƒ‰
    async multimodal_search(...)     # í…ìŠ¤íŠ¸+ì´ë¯¸ì§€ ê²€ìƒ‰
    
    # ë‚´ë¶€ ê²€ìƒ‰ ì—”ì§„
    async _vector_search(...)        # ë²¡í„° ê²€ìƒ‰ (1536d/3072d)
    async _keyword_search(...)       # ILIKE í‚¤ì›Œë“œ ê²€ìƒ‰
    async _fulltext_search(...)      # PostgreSQL FTS (GIN)
    async _hybrid_search_combined(...) # RRF ìœµí•© ì•Œê³ ë¦¬ì¦˜
    
    # í›„ì²˜ë¦¬
    async _group_results_by_file(...) # íŒŒì¼ ë‹¨ìœ„ ê·¸ë£¹í™”
    async _format_search_results(...) # ì‘ë‹µ í¬ë§·íŒ…
```

**ê²€ìƒ‰ íë¦„** (ì‹¤ì œ êµ¬í˜„ ê¸°ì¤€):
```
1. ê¶Œí•œ í™•ì¸
   â””â”€ _get_accessible_containers(user_emp_no)
   â””â”€ ì ‘ê·¼ ê°€ëŠ¥í•œ ì»¨í…Œì´ë„ˆ ID ëª©ë¡ íšë“

2. ì§ˆì˜ ì „ì²˜ë¦¬
   â””â”€ _preprocess_query(query)
   â””â”€ NLP ì²˜ë¦¬: í† í°í™”, ë¶ˆìš©ì–´ ì œê±°, í‚¤ì›Œë“œ ì¶”ì¶œ

3. ê²€ìƒ‰ ëª¨ë“œ ë¶„ê¸°
   â”œâ”€ vector_only â†’ _vector_search()
   â”œâ”€ keyword_only â†’ _keyword_search()
   â””â”€ hybrid â†’ _hybrid_search_combined()

4. ë³‘ë ¬ ê²€ìƒ‰ ì‹¤í–‰ (hybrid ëª¨ë“œ)
   â””â”€ asyncio.gather(
        _vector_search(query_embedding),
        _keyword_search(keywords),
        _fulltext_search(query_text)
      )

5. RRF ìŠ¤ì½”ì–´ ìœµí•©
   â””â”€ vector * 0.4 + keyword * 0.5 + fulltext * 0.1

6. íŒŒì¼ ë‹¨ìœ„ ê·¸ë£¹í™”
   â””â”€ _group_results_by_file()
   â””â”€ ë™ì¼ íŒŒì¼ì˜ ì²­í¬ë¥¼ ëŒ€í‘œ ìŠ¤ì½”ì–´ë¡œ í†µí•©

7. ê¶Œí•œ ì¬ê²€ì¦
   â””â”€ íŒŒì¼ ë ˆë²¨ ì ‘ê·¼ê¶Œ í™•ì¸
   â””â”€ í•„ìš” ì‹œ ë§ˆìŠ¤í‚¹ ë˜ëŠ” ì œì™¸

8. ê²°ê³¼ ì œí•œ ë° ìºì‹±
   â””â”€ ìµœëŒ€ max_resultsê°œ ë°˜í™˜ (ê¸°ë³¸ 50ê°œ)
   â””â”€ Redis ìºì‹± (TTL 5ë¶„)

9. ì‘ë‹µ ë°˜í™˜
   â””â”€ RAG ì»¨í…ìŠ¤íŠ¸(7.x) ë˜ëŠ” í”„ë¡ íŠ¸ì—”ë“œ(9.4)ë¡œ ì „ë‹¬
```

### 6.2 ë²¡í„° ê²€ìƒ‰ (Semantic Search)

**ì…ë ¥**:
- `query_embedding`: 1536d (text-embedding-3-small) ë˜ëŠ” 3072d (text-embedding-3-large)
- `container_ids`: ì ‘ê·¼ ê°€ëŠ¥í•œ ì»¨í…Œì´ë„ˆ ID ëª©ë¡
- `similarity_threshold`: 0.4 (ê¸°ë³¸ê°’, ì—„ê²©í•œ í•„í„°ë§)
- `top_k`: ìµœëŒ€ ê²°ê³¼ ê°œìˆ˜ (ê¸°ë³¸ 50)

**ì²˜ë¦¬ ê³¼ì •**:
```python
async def _vector_search(self, query_embedding, container_ids, top_k):
    # 1. ì„ë² ë”© ë²¡í„° ìƒì„± (EmbeddingService)
    vector = await self.embedding_service.create_embedding(query)
    
    # 2. pgvector HNSW ì¸ë±ìŠ¤ ê²€ìƒ‰
    query = """
        SELECT 
            c.chunk_id,
            c.file_id,
            c.content,
            e.vector <=> %s::vector AS similarity,
            f.title,
            f.container_id
        FROM doc_chunk c
        JOIN doc_embedding e ON c.chunk_id = e.chunk_id
        JOIN doc_file f ON c.file_id = f.file_id
        WHERE f.container_id = ANY(%s)
          AND f.deleted_at IS NULL
          AND e.vector <=> %s::vector < %s
        ORDER BY e.vector <=> %s::vector
        LIMIT %s
    """
    
    # 3. HNSW ì¸ë±ìŠ¤ (m=16, ef_construction=64) ìë™ ì‚¬ìš©
    # 4. ì»¨í…Œì´ë„ˆ/ì‚­ì œ ì—¬ë¶€ íŒŒì…œ ì¸ë±ìŠ¤ ì ìš©
    # 5. ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚° (vector_cosine_ops)
```

**ì¶œë ¥**:
```json
[
  {
    "chunk_id": 1234,
    "file_id": 5678,
    "content": "í˜ì‹  ì „ëµì€...",
    "similarity": 0.92,
    "title": "2024ë…„ ì „ëµ ë³´ê³ ì„œ.pdf",
    "container_id": 10,
    "match_type": "vector"
  }
]
```

**íŠœë‹ í¬ì¸íŠ¸**:
- HNSW íŒŒë¼ë¯¸í„°: m=16 (ì´ì›ƒ ìˆ˜), ef_construction=64 (êµ¬ì¶• í’ˆì§ˆ)
- Similarity threshold: 0.4 (ë†’ì„ìˆ˜ë¡ ì—„ê²©)
- Top-k: íŒŒì¼ë‹¹ ì¤‘ë³µ ì²­í¬ ë””ë“€í”„ (ìµœìƒìœ„ ì²­í¬ë§Œ)
- ë™ì  ì„ë² ë”© ì°¨ì›: 1536d (ë¹ ë¦„) vs 3072d (ì •í™•)

### 6.3 í‚¤ì›Œë“œ ê²€ìƒ‰ (Keyword Search)

**ì…ë ¥**:
- `keywords`: ì „ì²˜ë¦¬ëœ í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸ (ë¶ˆìš©ì–´ ì œê±°ë¨)
- `container_ids`: ì ‘ê·¼ ê°€ëŠ¥í•œ ì»¨í…Œì´ë„ˆ ID ëª©ë¡

**ì²˜ë¦¬ ê³¼ì •**:
```python
async def _keyword_search(self, keywords, container_ids):
    # 1. ILIKE íŒ¨í„´ ë§¤ì¹­ (PostgreSQL)
    conditions = [
        "c.content ILIKE %s" 
        for keyword in keywords
    ]
    
    query = f"""
        SELECT 
            c.chunk_id,
            c.file_id,
            c.content,
            COUNT(*) AS keyword_matches,
            f.title
        FROM doc_chunk c
        JOIN doc_file f ON c.file_id = f.file_id
        WHERE f.container_id = ANY(%s)
          AND f.deleted_at IS NULL
          AND ({" OR ".join(conditions)})
        GROUP BY c.chunk_id, c.file_id, c.content, f.title
        ORDER BY keyword_matches DESC
        LIMIT %s
    """
```

**ì¶œë ¥**:
```json
[
  {
    "chunk_id": 2345,
    "file_id": 5678,
    "content": "í˜ì‹ ì ì¸ ì ‘ê·¼ ë°©ì‹...",
    "keyword_matches": 2,
    "title": "ì „ëµ ë¬¸ì„œ.docx",
    "match_type": "keyword"
  }
]
```

**í–¥ìƒ ê¸°ë²•**:
- ë™ì˜ì–´ í™•ì¥: "í˜ì‹ " â†’ ["í˜ì‹ ", "ì´ë…¸ë² ì´ì…˜", "ë³€í™”"]
- í‘œì œì–´ ì‚¬ì „: "ë‹¬ë¦¬ë‹¤", "ë‹¬ë ¤", "ë›°ë‹¤" â†’ "ë‹¬ë¦¬ë‹¤"
- ë„ë©”ì¸ í‚¤ì›Œë“œ: ì—…ê³„ ì „ë¬¸ ìš©ì–´ ë§¤í•‘
- GIN ì¸ë±ìŠ¤: ë°°ì—´ ì»¬ëŸ¼(keywords[]) ê³ ì† ê²€ìƒ‰

### 6.4 ì „ë¬¸ ê²€ìƒ‰ (Full-Text Search)

**ì…ë ¥**:
- `query_text`: ì›ë³¸ ì§ˆì˜ í…ìŠ¤íŠ¸
- `container_ids`: ì ‘ê·¼ ê°€ëŠ¥í•œ ì»¨í…Œì´ë„ˆ ID ëª©ë¡

**ì²˜ë¦¬ ê³¼ì •**:
```python
async def _fulltext_search(self, query_text, container_ids):
    # 1. tsvector ê²€ìƒ‰ (GIN ì¸ë±ìŠ¤)
    query = """
        SELECT 
            i.search_doc_id,
            i.file_id,
            ts_rank(i.content_tsvector, to_tsquery('korean', %s)) AS rank,
            c.content,
            f.title
        FROM tb_document_search_index i
        JOIN doc_chunk c ON i.search_doc_id = c.chunk_id
        JOIN doc_file f ON i.file_id = f.file_id
        WHERE f.container_id = ANY(%s)
          AND f.deleted_at IS NULL
          AND i.content_tsvector @@ to_tsquery('korean', %s)
        ORDER BY rank DESC
        LIMIT %s
    """
```

**ë©€í‹°ë§êµ¬ì–¼ ì§€ì›**:
```python
# í•œêµ­ì–´ ì¿¼ë¦¬
content_tsvector @@ to_tsquery('korean', 'í˜ì‹  & ì „ëµ')

# ì˜ì–´ ì¿¼ë¦¬
content_tsvector_en @@ to_tsquery('english', 'innovation & strategy')
```

### 6.5 í•˜ì´ë¸Œë¦¬ë“œ ìŠ¤ì½”ì–´ë§ (RRF Fusion)

**RRF (Reciprocal Rank Fusion) ì•Œê³ ë¦¬ì¦˜**:
```python
async def _hybrid_search_combined(self, query, container_ids, top_k):
    # 1. ë³‘ë ¬ ê²€ìƒ‰ ì‹¤í–‰
    vector_results, keyword_results, fts_results = await asyncio.gather(
        self._vector_search(query, container_ids, top_k),
        self._keyword_search(query, container_ids, top_k),
        self._fulltext_search(query, container_ids, top_k)
    )
    
    # 2. RRF ìŠ¤ì½”ì–´ ê³„ì‚°
    k = 60  # RRF ìƒìˆ˜
    combined_scores = {}
    
    for rank, result in enumerate(vector_results):
        chunk_id = result['chunk_id']
        combined_scores[chunk_id] = self.vector_weight / (k + rank + 1)
    
    for rank, result in enumerate(keyword_results):
        chunk_id = result['chunk_id']
        combined_scores[chunk_id] += self.keyword_weight / (k + rank + 1)
    
    for rank, result in enumerate(fts_results):
        chunk_id = result['chunk_id']
        combined_scores[chunk_id] += self.fulltext_weight / (k + rank + 1)
    
    # 3. ì •ê·œí™” (0-1 ë²”ìœ„)
    max_score = max(combined_scores.values())
    normalized_scores = {
        chunk_id: score / max_score
        for chunk_id, score in combined_scores.items()
    }
    
    # 4. ìµœì¢… ìŠ¤ì½”ì–´ ì ìš©
    # vector * 0.4 + keyword * 0.5 + fulltext * 0.1
```

**ê°€ì¤‘ì¹˜ ì„¤ì • (í•œêµ­ì–´ ìµœì í™”)**:
- **ë²¡í„° ê²€ìƒ‰ (0.4)**: í•œêµ­ì–´ ì„ë² ë”© ëª¨ë¸ì˜ í•œê³„ë¥¼ ê³ ë ¤í•˜ì—¬ ë‚®ì¶¤
- **í‚¤ì›Œë“œ ê²€ìƒ‰ (0.5)**: í•œêµ­ì–´ì—ì„œ ì •í™•ë„ê°€ ë†’ì•„ ê°€ì¤‘ì¹˜ ì¦ê°€
- **ì „ë¬¸ ê²€ìƒ‰ (0.1)**: ë³´ì¡°ì  ì—­í• , ë…¸ì´ì¦ˆ ê°ì†Œ

**íŒŒì¼ ë‹¨ìœ„ ì§‘ê³„**:
```python
async def _group_results_by_file(self, results):
    file_groups = {}
    
    for result in results:
        file_id = result['file_id']
        
        if file_id not in file_groups:
            file_groups[file_id] = {
                'file_id': file_id,
                'title': result['title'],
                'chunks': [],
                'max_score': 0,
                'avg_score': 0
            }
        
        file_groups[file_id]['chunks'].append(result)
        file_groups[file_id]['max_score'] = max(
            file_groups[file_id]['max_score'],
            result['similarity']
        )
    
    # ëŒ€í‘œ ìŠ¤ì½”ì–´ ê³„ì‚° (ìµœëŒ€ê°’ ë˜ëŠ” í‰ê· )
    for file_group in file_groups.values():
        chunks = file_group['chunks']
        file_group['avg_score'] = sum(c['similarity'] for c in chunks) / len(chunks)
    
    return file_groups
```

**ìµœì¢… ë­í‚¹**:
1. **1ì°¨**: hybrid_score DESC (ë†’ì€ ì ìˆ˜ ìš°ì„ )
2. **2ì°¨**: ë™ì  ì‹œ ìµœì‹ ì„± (updated_at DESC)
3. **3ì°¨**: ê¶Œí•œ ìš°ì„ ìˆœìœ„ (owner > editor > viewer)

**ê¶Œí•œ í›„ì²˜ë¦¬**:
```python
# íŒŒì¼ ë ˆë²¨ ì ‘ê·¼ê¶Œ ì¬ê²€ì¦
accessible_files = await self.permission_service.filter_accessible_files(
    user_emp_no=user_emp_no,
    file_ids=[r['file_id'] for r in results]
)

# ê¶Œí•œ ì—†ëŠ” íŒŒì¼ ì œì™¸ ë˜ëŠ” ë§ˆìŠ¤í‚¹
final_results = [
    r for r in results 
    if r['file_id'] in accessible_files
]
```

## 7. RAG íŒŒì´í”„ë¼ì¸

### 7.1 ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±

**ëª©í‘œ**: í† í° í•œë„ (ìµœëŒ€ 8K í† í°) ë‚´ì—ì„œ ê·¼ê±° ë¬¸ì„œë¥¼ ì••ì¶•/ì •ë ¬í•˜ì—¬ LLMì— ì „ë‹¬

**ì…ë ¥**:
- `ranked_results`: ê²€ìƒ‰ ê²°ê³¼ (hybrid_search ë˜ëŠ” context_search)
- `user_query`: ì‚¬ìš©ì ì§ˆë¬¸
- `intent`: ì§ˆì˜ ì˜ë„ (qa_question, summarization, comparison ë“±)
- `selected_docs`: ì‚¬ìš©ìê°€ ì„ íƒí•œ ë¬¸ì„œ (ì„ íƒ ì‚¬í•­)

**ì²˜ë¦¬ ê³¼ì •**:
```python
async def construct_rag_context(self, query, search_results, max_tokens=8000):
    """RAG ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±"""
    
    # 1. ì¤‘ë³µ ì œê±° (ë™ì¼ íŒŒì¼/ì„¹ì…˜)
    deduplicated = self._remove_duplicate_chunks(search_results)
    
    # 2. ê´€ë ¨ë„ ìˆœ ì •ë ¬ (similarity_score DESC)
    sorted_results = sorted(
        deduplicated, 
        key=lambda x: x['similarity'], 
        reverse=True
    )
    
    # 3. ë‹¤ì–‘ì„± í™•ë³´ (íŒŒì¼/í˜ì´ì§€/ì„¹ì…˜ ë¶„ì‚°)
    diversified = self._ensure_diversity(sorted_results)
    
    # 4. í† í° ì œí•œ ë‚´ì—ì„œ ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
    context_parts = []
    total_tokens = 0
    
    for result in diversified:
        chunk_tokens = self._count_tokens(result['content'])
        
        if total_tokens + chunk_tokens > max_tokens:
            break
        
        context_parts.append({
            'content': result['content'],
            'source': f"{result['title']} (í˜ì´ì§€ {result['page_num']})",
            'file_id': result['file_id'],
            'chunk_id': result['chunk_id']
        })
        total_tokens += chunk_tokens
    
    # 5. ì»¨í…ìŠ¤íŠ¸ í¬ë§·íŒ…
    context_text = "\n\n---\n\n".join([
        f"[ì¶œì²˜: {part['source']}]\n{part['content']}"
        for part in context_parts
    ])
    
    return {
        'context': context_text,
        'selected_docs': [p['file_id'] for p in context_parts],
        'total_tokens': total_tokens,
        'doc_count': len(context_parts)
    }
```

**ìµœì í™” ì „ëµ**:
- **íŒŒì¼ ë‹¤ì–‘ì„±**: ë™ì¼ íŒŒì¼ì—ì„œ ìµœëŒ€ 3ê°œ ì²­í¬ê¹Œì§€
- **ì„¹ì…˜ ë‹¤ì–‘ì„±**: ë‹¤ì–‘í•œ ì„¹ì…˜/í˜ì´ì§€ì—ì„œ ì¶”ì¶œ
- **ì¤‘ìš”ë„ ì •ë ¬**: similarity_score ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ
- **í—¤ë”/í‘œ/ìº¡ì…˜ ìœ ì§€**: êµ¬ì¡°ì  ì •ë³´ ë³´ì¡´
- **í† í° íš¨ìœ¨í™”**: ë¶ˆí•„ìš”í•œ ê³µë°±, ì¤‘ë³µ í‘œí˜„ ì œê±°

### 7.2 ë©€í‹° LLM ë‹µë³€ ìƒì„± (Failover ì „ëµ)

**ì œê³µì ìš°ì„ ìˆœìœ„** (2025-10-27 ê¸°ì¤€):
```
1ì°¨: AWS Bedrock Claude 3.5 Sonnet (ì„ í˜¸)
  â†“ (ì‹¤íŒ¨ ì‹œ)
2ì°¨: Azure OpenAI GPT-4o (í´ë°±)
  â†“ (ì‹¤íŒ¨ ì‹œ)
3ì°¨: OpenAI GPT-4 (ìµœì¢… í´ë°±)
  â†“ (ëª¨ë‘ ì‹¤íŒ¨ ì‹œ)
ì—ëŸ¬ ì‘ë‹µ: "ì£„ì†¡í•©ë‹ˆë‹¤. ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
```

**í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿** (ì˜ë„ë³„):
```python
PROMPT_TEMPLATES = {
    'qa_question': """
ë‹¤ìŒ ë¬¸ì„œë“¤ì„ ì°¸ê³ í•˜ì—¬ ì§ˆë¬¸ì— ë‹µë³€í•´ì£¼ì„¸ìš”:

{context}

ì§ˆë¬¸: {query}

ë‹µë³€ ì‹œ ë‹¤ìŒ ì‚¬í•­ì„ ì¤€ìˆ˜í•˜ì„¸ìš”:
1. ì œê³µëœ ë¬¸ì„œì˜ ë‚´ìš©ë§Œì„ ê·¼ê±°ë¡œ ë‹µë³€í•˜ì„¸ìš”.
2. ê·¼ê±°ê°€ ë¶ˆì¶©ë¶„í•˜ë©´ "ë¬¸ì„œì—ì„œ í•´ë‹¹ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"ë¼ê³  ëª…ì‹œí•˜ì„¸ìš”.
3. ë‹µë³€ ë§ˆì§€ë§‰ì— ì°¸ì¡°í•œ ì¶œì²˜ë¥¼ ëª…ì‹œí•˜ì„¸ìš”.
""",
    
    'summarization': """
ë‹¤ìŒ ë¬¸ì„œë“¤ì„ ìš”ì•½í•´ì£¼ì„¸ìš”:

{context}

ìš”ì•½ ì‹œ ë‹¤ìŒ ì‚¬í•­ì„ ì¤€ìˆ˜í•˜ì„¸ìš”:
1. í•µì‹¬ ë‚´ìš©ì„ 3-5ê°œ ë¶ˆë¦¿ í¬ì¸íŠ¸ë¡œ ì •ë¦¬í•˜ì„¸ìš”.
2. ì¤‘ìš”í•œ ìˆ˜ì¹˜ë‚˜ ë‚ ì§œê°€ ìˆë‹¤ë©´ í¬í•¨í•˜ì„¸ìš”.
3. ê° ë¬¸ì„œì˜ ì¶œì²˜ë¥¼ êµ¬ë¶„í•˜ì—¬ í‘œì‹œí•˜ì„¸ìš”.
""",
    
    'comparison': """
ë‹¤ìŒ ë¬¸ì„œë“¤ì„ ë¹„êµ ë¶„ì„í•´ì£¼ì„¸ìš”:

{context}

ì§ˆë¬¸: {query}

ë¹„êµ ë¶„ì„ ì‹œ ë‹¤ìŒ ì‚¬í•­ì„ ì¤€ìˆ˜í•˜ì„¸ìš”:
1. ê³µí†µì ê³¼ ì°¨ì´ì ì„ ëª…í™•íˆ êµ¬ë¶„í•˜ì„¸ìš”.
2. í‘œ í˜•ì‹ìœ¼ë¡œ ì •ë¦¬í•˜ë©´ ë” ì¢‹ìŠµë‹ˆë‹¤.
3. ê° í•­ëª©ì˜ ì¶œì²˜ë¥¼ ëª…ì‹œí•˜ì„¸ìš”.
"""
}
```

**LLM í˜¸ì¶œ íŒŒë¼ë¯¸í„°**:
```python
llm_params = {
    'model': 'anthropic.claude-3-5-sonnet-20241022-v2:0',  # Bedrock
    'max_tokens': 4096,
    'temperature': 0.7,  # qa_question: 0.3, summarization: 0.5, comparison: 0.7
    'top_p': 0.9,
    'stream': True  # SSE ìŠ¤íŠ¸ë¦¬ë°
}
```

**ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ (SSE)**:
```python
async def stream_chat_response(self, query, context, session_id):
    """SSE ìŠ¤íŠ¸ë¦¬ë° ì±„íŒ… ì‘ë‹µ"""
    
    # 1. í”„ë¡¬í”„íŠ¸ êµ¬ì„±
    prompt = PROMPT_TEMPLATES['qa_question'].format(
        context=context['context'],
        query=query
    )
    
    # 2. LLM ìŠ¤íŠ¸ë¦¬ë° í˜¸ì¶œ
    async for chunk in ai_service.stream_generate(
        prompt=prompt,
        session_id=session_id,
        stream=True
    ):
        # 3. SSE í¬ë§·ìœ¼ë¡œ ì „ì†¡
        yield f"data: {json.dumps({'content': chunk, 'type': 'content'})}\n\n"
    
    # 4. ì¶œì²˜ ì •ë³´ ì „ì†¡
    yield f"data: {json.dumps({'sources': context['selected_docs'], 'type': 'sources'})}\n\n"
    
    # 5. ì¢…ë£Œ ì‹œê·¸ë„
    yield "data: [DONE]\n\n"
```

### 7.3 ë‹µë³€ í›„ì²˜ë¦¬

**ì •ì œ ê³¼ì •**:
```python
async def post_process_answer(self, raw_answer, context):
    """ë‹µë³€ í›„ì²˜ë¦¬"""
    
    # 1. Markdown í¬ë§·íŒ… ìˆ˜ì •
    cleaned = fix_markdown_formatting(raw_answer)
    
    # 2. ì¤‘ë³µ í‘œí˜„ ì œê±°
    cleaned = remove_redundant_phrases(cleaned)
    
    # 3. ì¶œì²˜ ë§í¬ ìƒì„±
    sources = []
    for doc in context['selected_docs']:
        file = await self.file_repository.get_by_id(doc['file_id'])
        sources.append({
            'title': file.title,
            'page': doc.get('page_num'),
            'url': f"/files/{file.file_id}/view",
            'chunk_id': doc['chunk_id']
        })
    
    # 4. ì‹ ë¢°ë„ ê³„ì‚°
    confidence = calculate_confidence(
        answer=cleaned,
        context=context,
        query_coverage=0.8
    )
    
    return {
        'answer': cleaned,
        'sources': sources,
        'confidence': confidence,
        'tokens_used': context['total_tokens']
    }
```

**ì‹ ë¢°ë„ ê³„ì‚°**:
```python
def calculate_confidence(answer, context, query_coverage):
    """ë‹µë³€ ì‹ ë¢°ë„ ì‚°ì • (0-1)"""
    
    # 1. ê·¼ê±° ë°€ë„ (contextì™€ answerì˜ ë‚´ìš© ì¼ì¹˜ë„)
    evidence_density = calculate_overlap(answer, context['context'])
    
    # 2. ì¿¼ë¦¬ ì»¤ë²„ë¦¬ì§€ (ì§ˆë¬¸ì˜ ëª¨ë“  ì¸¡ë©´ì„ ë‹¤ë£¨ì—ˆëŠ”ì§€)
    # query_coverageëŠ” ê²€ìƒ‰ ë‹¨ê³„ì—ì„œ ê³„ì‚°ë¨
    
    # 3. ëª¨í˜¸ í‘œí˜„ ë¹„ìœ¨ (ì—­ê³„ì‚°)
    ambiguous_phrases = ['ì•„ë§ˆë„', 'ê°€ëŠ¥ì„±', 'ë¶ˆí™•ì‹¤', 'ëª…í™•í•˜ì§€ ì•Š']
    ambiguous_count = sum(
        1 for phrase in ambiguous_phrases 
        if phrase in answer
    )
    ambiguity_penalty = min(0.2, ambiguous_count * 0.05)
    
    # ìµœì¢… ì‹ ë¢°ë„
    confidence = (
        0.5 * evidence_density +
        0.3 * query_coverage +
        0.2 * (1 - ambiguity_penalty)
    )
    
    return round(confidence, 2)
```

**ì¶œì²˜ í‘œì‹œ í¬ë§·**:
```json
{
  "answer": "2024ë…„ ë§¤ì¶œì€ ì „ë…„ ëŒ€ë¹„ 15% ì¦ê°€í–ˆìŠµë‹ˆë‹¤...",
  "sources": [
    {
      "title": "2024 ì‹¤ì  ë³´ê³ ì„œ.pdf",
      "page": 5,
      "url": "/files/1234/view",
      "chunk_id": 5678,
      "excerpt": "2024ë…„ ì—°ê°„ ë§¤ì¶œ: 500ì–µì› (ì „ë…„ë¹„ +15%)"
    }
  ],
  "confidence": 0.92,
  "tokens_used": 1234
}
```

**í´ë°± ì „ëµ** (ì‹ ë¢°ë„ < 0.5):
```python
if confidence < 0.5:
    return {
        'answer': (
            "ì œê³µëœ ë¬¸ì„œì—ì„œ ëª…í™•í•œ ë‹µë³€ì„ ì°¾ê¸° ì–´ë µìŠµë‹ˆë‹¤. "
            "ë‹¤ìŒ ë¬¸ì„œë“¤ì„ ì§ì ‘ í™•ì¸í•´ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤."
        ),
        'sources': context['selected_docs'],
        'confidence': confidence,
        'fallback': True
    }
```

### 7.4 ë¦¬ë­í‚¹ ì „ëµ ë° ìµœì í™”

> **ì—…ë°ì´íŠ¸**: 2025-11-06  
> **ì£¼ìš” ë³€ê²½**: GPT-5-Nano API í˜¸í™˜ì„±, Fallback ë¡œì§, ì„±ëŠ¥ ë¶„ì„ ì¶”ê°€

#### 7.4.1 ë¦¬ë­í‚¹ ê°œìš”

**ëª©ì **: í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ê²°ê³¼(28ê°œ ì²­í¬)ë¥¼ AI ê¸°ë°˜ìœ¼ë¡œ ì¬ì •ë ¬í•˜ì—¬ ìµœì ì˜ 10ê°œ ì„ íƒ

**í”„ë¡œì„¸ìŠ¤**:
```
í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ê²°ê³¼ (28ê°œ)
  â”œâ”€ ì˜ë¯¸ì  ê²€ìƒ‰: 20ê°œ (ë²¡í„° ìœ ì‚¬ë„)
  â”œâ”€ í‚¤ì›Œë“œ ê²€ìƒ‰: 20ê°œ (í˜•íƒœì†Œ ë§¤ì¹­)
  â””â”€ ì „ë¬¸ê²€ìƒ‰(FTS): 5ê°œ (í•œêµ­ì–´/ì˜ì–´)
    â†“
ì¤‘ë³µ ì œê±° (28ê°œ â†’ 28ê°œ)
  â””â”€ ë™ì¼ chunk_id ì œê±°
    â†“
ë¦¬ë­í‚¹ (AI ê¸°ë°˜)
  â”œâ”€ í”„ë¡¬í”„íŠ¸: "ë‹¤ìŒ ì²­í¬ë“¤ì„ ì§ˆë¬¸ê³¼ì˜ ê´€ë ¨ì„±ì´ ë†’ì€ ìˆœì„œë¡œ ì •ë ¬"
  â”œâ”€ LLM í‰ê°€: gpt-4o-mini (ê¶Œì¥) ë˜ëŠ” gpt-5-nano (fallback)
  â””â”€ ìˆœìœ„ ì¬ì¡°ì •: 1, 3, 7, 2, 5...
    â†“
Top-K ì„ íƒ (10ê°œ)
  â””â”€ ë¦¬ë­í‚¹ ìˆœì„œëŒ€ë¡œ ìƒìœ„ 10ê°œ
    â†“
í† í° ì œí•œ ì ìš© (4000 í† í°)
  â”œâ”€ ì²­í¬ ìš°ì„ ìˆœìœ„ ìˆœì„œëŒ€ë¡œ ì¶”ê°€
  â”œâ”€ í† í° ëˆ„ì  ê³„ì‚°
  â””â”€ 4000 ì´ˆê³¼ ì‹œ ì²­í¬ ìƒëµ
    â†“
ìµœì¢… ì»¨í…ìŠ¤íŠ¸ (5-7ê°œ ì²­í¬)
  â””â”€ í‰ê·  3197-3943 í† í°
```

**ì„±ëŠ¥ ì§€í‘œ** (ì‹¤ì¸¡, 2025-11-06):

| ì§€í‘œ | í•œêµ­ì–´ ì¿¼ë¦¬ | ì˜ì–´ ì¿¼ë¦¬ | í‰ê·  |
|-----|----------|---------|------|
| ì…ë ¥ ì²­í¬ | 28ê°œ | 28ê°œ | 28ê°œ |
| ë¦¬ë­í‚¹ í›„ | 10ê°œ | 10ê°œ | 10ê°œ |
| ìµœì¢… ì»¨í…ìŠ¤íŠ¸ | 7ê°œ | 5ê°œ | 6ê°œ |
| í† í° ì‚¬ìš©ëŸ‰ | 3943 | 3197 | 3570 |
| ë¦¬ë­í‚¹ ì‹œê°„ | 3.7ì´ˆ | 1.4ì´ˆ | 2.6ì´ˆ |
| ì´ ì†Œìš”ì‹œê°„ | 13.7ì´ˆ | 12.6ì´ˆ | 13.2ì´ˆ |
| API ìƒíƒœ | 200 OK | 200 OK | 100% |

**í’ˆì§ˆ í–¥ìƒ íš¨ê³¼**:
- âœ… ê´€ë ¨ë„ ë†’ì€ ì²­í¬ ìš°ì„  ì„ íƒ (AI í‰ê°€ ê¸°ë°˜)
- âœ… ì¤‘ë³µ ì œê±° (ë™ì¼ ë¬¸ì„œ ë°˜ë³µ ë°©ì§€)
- âœ… ë‹¤ì–‘ì„± í™•ë³´ (ì—¬ëŸ¬ ë¬¸ì„œì—ì„œ ê³¨ê³ ë£¨)
- âœ… í† í° íš¨ìœ¨í™” (4000 í† í° ë‚´ ìµœì í™”)
- âœ… ë‹µë³€ í’ˆì§ˆ í–¥ìƒ (612-637ì êµ¬ì¡°í™”ëœ ë‹µë³€)

#### 7.4.2 Fallback ë¡œì§

**ì„¤ê³„ ì›ì¹™**: ë¦¬ë­í‚¹ ì „ìš© LLMì´ ì—†ì–´ë„ ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™ ë³´ì¥

**Fallback ì²´ê³„**:
```python
# backend/app/services/chat/rag_search_service.py (Line 1189-1210)

from app.core.config import settings
from langchain_openai import AzureChatOpenAI
from langchain.schema import HumanMessage
import os

# 1. ë¦¬ë­í‚¹ ì „ìš© ì„¤ì • í™•ì¸
rerank_endpoint = os.getenv("RAG_RERANKING_ENDPOINT")
rerank_deployment = os.getenv("RAG_RERANKING_DEPLOYMENT")
rerank_api_key = os.getenv("RAG_RERANKING_API_KEY")

# 2. Fallback ë¡œì§
if not (rerank_endpoint and rerank_deployment and rerank_api_key):
    logger.info("âš ï¸ ë¦¬ë­í‚¹ ì „ìš© ì„¤ì • ì—†ìŒ - RAG ë‹µë³€ ìƒì„± LLMìœ¼ë¡œ fallback")
    rerank_endpoint = settings.azure_openai_endpoint
    rerank_deployment = settings.azure_openai_llm_deployment  # gpt-5-nano
    rerank_api_key = settings.azure_openai_api_key

# 3. Azure OpenAI í´ë¼ì´ì–¸íŠ¸ ìƒì„±
deployment_lower = rerank_deployment.lower()

# GPT-5/Nano ê³„ì—´ í™•ì¸
if 'gpt-5' in deployment_lower or 'nano' in deployment_lower or \
   'o1' in deployment_lower or 'o3' in deployment_lower:
    logger.info(f"ğŸ”§ ë¦¬ë­í‚¹ ëª¨ë¸: {rerank_deployment} (temperature/max_tokens ë¯¸ì§€ì›)")
    rerank_llm = AzureChatOpenAI(
        azure_endpoint=rerank_endpoint,
        api_key=rerank_api_key,
        api_version=os.getenv("RAG_RERANKING_API_VERSION", settings.azure_openai_api_version),
        deployment_name=rerank_deployment,
        max_completion_tokens=500,  # âœ… gpt-5-nano ì „ìš©
    )
else:
    logger.info(f"ğŸ”§ ë¦¬ë­í‚¹ ëª¨ë¸: {rerank_deployment} (temperature ì§€ì›)")
    rerank_llm = AzureChatOpenAI(
        azure_endpoint=rerank_endpoint,
        api_key=rerank_api_key,
        api_version=os.getenv("RAG_RERANKING_API_VERSION", settings.azure_openai_api_version),
        deployment_name=rerank_deployment,
        temperature=0.3,  # âœ… ì¼ë°˜ ëª¨ë¸
        max_tokens=500,   # âœ… ì¼ë°˜ ëª¨ë¸
    )

# 4. ë¦¬ë­í‚¹ ì‹¤í–‰
response = await rerank_llm.ainvoke([HumanMessage(content=rerank_prompt)])
rerank_response = response.content if hasattr(response, 'content') else str(response)
```

**ìš´ì˜ ì‹œë‚˜ë¦¬ì˜¤**:

| ì‹œë‚˜ë¦¬ì˜¤ | ë¦¬ë­í‚¹ ëª¨ë¸ | ë‹µë³€ ìƒì„± ëª¨ë¸ | ë¹„ìš© íš¨ìœ¨ì„± | í’ˆì§ˆ |
|---------|-----------|-------------|----------|------|
| **í”„ë¡œë•ì…˜ (ê¶Œì¥)** | gpt-4o-mini | gpt-5-nano | â­â­â­ ìµœì  | â­â­â­ |
| ê°œë°œ/í…ŒìŠ¤íŠ¸ | gpt-5-nano (fallback) | gpt-5-nano | â­â­ ì¤‘ê°„ | â­â­â­ |
| í´ë°± (ë¦¬ë­í‚¹ ì‹¤íŒ¨) | ê¸°ë³¸ ìœ ì‚¬ë„ ìˆœì„œ | gpt-5-nano | â­ ìµœì € | â­â­ |

**í™˜ê²½ë³€ìˆ˜ ì„¤ì •** (.env):
```bash
# í”„ë¡œë•ì…˜ í™˜ê²½ (ê¶Œì¥)
RAG_RERANKING_ENDPOINT=
RAG_RERANKING_API_KEY=
RAG_RERANKING_DEPLOYMENT=gpt-4o-mini
RAG_RERANKING_API_VERSION=2024-12-01-preview

# ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½ (fallback ìë™)
# RAG_RERANKING_* ì„¤ì • ì—†ìŒ â†’ gpt-5-nano ìë™ ì‚¬ìš©
```

**config.py ì„¤ì •**:
```python
# backend/app/core/config.py (Line 203-212)

class Settings(BaseSettings):
    # RAG ë¦¬ë­í‚¹ ì„¤ì • (ì„ íƒ ì‚¬í•­)
    rag_similarity_threshold: float = 0.3
    rag_max_chunks: int = 30
    rag_use_reranking: bool = True
    rag_reranking_endpoint: Optional[str] = None  # ì—†ìœ¼ë©´ RAG LLM ì‚¬ìš©
    rag_reranking_api_key: Optional[str] = None
    rag_reranking_deployment: str = "gpt-4o-mini"
    rag_reranking_api_version: str = "2024-12-01-preview"
```

**ì¥ì **:
- âœ… **ìœ ì—°ì„±**: ë¦¬ë­í‚¹ ì„¤ì • ì—†ì´ë„ ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™
- âœ… **ë¹„ìš© ìµœì í™”**: ë¦¬ë­í‚¹ì— ì €ë ´í•œ gpt-4o-mini ì„ íƒ ê°€ëŠ¥
- âœ… **ì•ˆì •ì„±**: Exception ë°œìƒ ì‹œ ê¸°ë³¸ ìˆœì„œë¡œ ëŒ€ì²´
- âœ… **ìš´ì˜ í¸ì˜**: ê°œë°œ/ìš´ì˜ í™˜ê²½ ë¶„ë¦¬ ê°€ëŠ¥
- âœ… **ë‹¨ê³„ì  ì „í™˜**: ë¦¬ë­í‚¹ ì „ìš© ì„¤ì •ì„ ì ì§„ì ìœ¼ë¡œ ì¶”ê°€

#### 7.4.3 GPT-5-Nano API í˜¸í™˜ì„±

**ë¬¸ì œ**: GPT-5-NanoëŠ” ê¸°ì¡´ GPT-4ì™€ ë‹¤ë¥¸ API íŒŒë¼ë¯¸í„° ì‚¬ìš©

**ì°¨ì´ì **:

| íŒŒë¼ë¯¸í„° | GPT-4 / GPT-4o / GPT-4o-mini | GPT-5-Nano / O1 / O3 |
|---------|---------------------------|---------------------|
| `temperature` | âœ… ì§€ì› | âŒ ë¯¸ì§€ì› |
| `max_tokens` | âœ… ì§€ì› | âŒ ë¯¸ì§€ì› |
| `max_completion_tokens` | âœ… ì§€ì› (ì„ íƒ) | âœ… **í•„ìˆ˜** |

**ì˜¤ë¥˜ ë©”ì‹œì§€** (ìˆ˜ì • ì „):
```log
HTTP/1.1 400 Bad Request
{
  "error": {
    "message": "Unsupported parameter: 'temperature' is not supported with this model.",
    "type": "invalid_request_error",
    "param": "temperature",
    "code": "unsupported_parameter"
  }
}

{
  "error": {
    "message": "Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead.",
    "type": "invalid_request_error",
    "param": "max_tokens",
    "code": "unsupported_parameter"
  }
}
```

**í•´ê²° ë°©ë²•**:
```python
# backend/app/services/chat/rag_search_service.py (Line 1210-1230)

deployment_lower = rerank_deployment.lower()

# GPT-5/Nano ê³„ì—´ ëª¨ë¸ í™•ì¸
is_gpt5_nano = (
    'gpt-5' in deployment_lower or 
    'nano' in deployment_lower or 
    'o1' in deployment_lower or 
    'o3' in deployment_lower
)

if is_gpt5_nano:
    # Temperatureì™€ max_tokens ë¯¸ì§€ì› ëª¨ë¸
    logger.info(f"ğŸ”§ ë¦¬ë­í‚¹ ëª¨ë¸: {rerank_deployment} (temperature/max_tokens ë¯¸ì§€ì›)")
    
    rerank_llm = AzureChatOpenAI(
        azure_endpoint=rerank_endpoint,
        api_key=rerank_api_key,
        api_version=os.getenv("RAG_RERANKING_API_VERSION", settings.azure_openai_api_version),
        deployment_name=rerank_deployment,
        max_completion_tokens=500,  # âœ… gpt-5-nano í•„ìˆ˜ íŒŒë¼ë¯¸í„°
        # temperature íŒŒë¼ë¯¸í„° ì—†ìŒ âœ…
        # max_tokens íŒŒë¼ë¯¸í„° ì—†ìŒ âœ…
    )
else:
    # ì¼ë°˜ ëª¨ë¸ (GPT-4, GPT-4o, GPT-4o-mini)
    logger.info(f"ğŸ”§ ë¦¬ë­í‚¹ ëª¨ë¸: {rerank_deployment} (temperature ì§€ì›)")
    
    rerank_llm = AzureChatOpenAI(
        azure_endpoint=rerank_endpoint,
        api_key=rerank_api_key,
        api_version=os.getenv("RAG_RERANKING_API_VERSION", settings.azure_openai_api_version),
        deployment_name=rerank_deployment,
        temperature=0.3,  # âœ… ì¼ë°˜ ëª¨ë¸ ì§€ì›
        max_tokens=500,   # âœ… ì¼ë°˜ ëª¨ë¸ ì§€ì›
    )
```

**LangChain UserWarning** (ì •ìƒ ë™ì‘):
```log
WARNING! max_completion_tokens is not default parameter.
max_completion_tokens was transferred to model_kwargs.
Please confirm that max_completion_tokens is what you intended.
```

**ì„¤ëª…**:
- âš ï¸ LangChainì˜ ì •ë³´ì„± ê²½ê³  (ì˜¤ë¥˜ ì•„ë‹˜)
- âœ… `max_completion_tokens`ê°€ `model_kwargs`ë¡œ ìë™ ì „ë‹¬ë¨
- âœ… API í˜¸ì¶œì€ ì •ìƒ ì‘ë™ (HTTP 200 OK)
- âœ… ë¦¬ë­í‚¹ ì •ìƒ ìˆ˜í–‰

**ê²€ì¦ ê²°ê³¼** (2025-11-06 ë¡œê·¸):

| í•­ëª© | ìˆ˜ì • ì „ | ìˆ˜ì • í›„ |
|-----|--------|--------|
| **API ì‘ë‹µ** | 400 Bad Request âŒ | 200 OK âœ… |
| **ì˜¤ë¥˜ ë©”ì‹œì§€** | Unsupported parameter | ì—†ìŒ |
| **ë¦¬ë­í‚¹ ì‹¤í–‰** | ì‹¤íŒ¨ â†’ ê¸°ë³¸ ìˆœì„œ ì‚¬ìš© | ì„±ê³µ â†’ AI ë¦¬ë­í‚¹ |
| **ìµœì¢… ì²­í¬ ìˆ˜** | 10ê°œ (ê¸°ë³¸ ìˆœì„œ) | 10ê°œ (AI ì •ë ¬) |
| **ì»¨í…ìŠ¤íŠ¸ í’ˆì§ˆ** | â­â­ | â­â­â­ |

#### 7.4.4 ë¦¬ë­í‚¹ ì„±ëŠ¥ ë¶„ì„

**ì¸¡ì • í™˜ê²½**:
- ë‚ ì§œ: 2025-11-06
- ë°±ì—”ë“œ: FastAPI + PostgreSQL (pgvector) + Redis
- ëª¨ë¸: gpt-5-nano (fallback), gpt-4o-mini (ê¶Œì¥)
- ì¿¼ë¦¬: í•œêµ­ì–´/ì˜ì–´ í˜¼í•©

**ì„±ëŠ¥ ì§€í‘œ**:

| í•­ëª© | ì˜ì–´ ì¿¼ë¦¬ | í•œêµ­ì–´ ì¿¼ë¦¬ | í‰ê·  |
|-----|---------|----------|------|
| **ê²€ìƒ‰ ë‹¨ê³„** | | | |
| ì˜ë¯¸ì  ê²€ìƒ‰ | 20ê°œ | 20ê°œ | 20ê°œ |
| í‚¤ì›Œë“œ ê²€ìƒ‰ | 20ê°œ | 20ê°œ | 20ê°œ |
| ì „ë¬¸ê²€ìƒ‰ (FTS) | 5ê°œ | 5ê°œ | 5ê°œ |
| í•˜ì´ë¸Œë¦¬ë“œ í†µí•© | 28ê°œ | 28ê°œ | 28ê°œ |
| **ë¦¬ë­í‚¹ ë‹¨ê³„** | | | |
| ë¦¬ë­í‚¹ ì…ë ¥ | 28ê°œ | 28ê°œ | 28ê°œ |
| ë¦¬ë­í‚¹ ì¶œë ¥ | 10ê°œ | 10ê°œ | 10ê°œ |
| ë¦¬ë­í‚¹ ì‹œê°„ | 1.4ì´ˆ | 3.7ì´ˆ | 2.6ì´ˆ |
| **ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±** | | | |
| í† í° ì œí•œ ì ìš© í›„ | 5ê°œ | 7ê°œ | 6ê°œ |
| í† í° ì‚¬ìš©ëŸ‰ | 3197 | 3943 | 3570 |
| **ì „ì²´ ì„±ëŠ¥** | | | |
| ì´ ì†Œìš”ì‹œê°„ | 12.6ì´ˆ | 13.7ì´ˆ | 13.2ì´ˆ |
| ë‹µë³€ ê¸¸ì´ | 612ì | 637ì | 625ì |
| API ì„±ê³µë¥  | 100% | 100% | 100% |

**í’ˆì§ˆ ë¹„êµ** (ë¦¬ë­í‚¹ ì ìš© ì „í›„):

| ì§€í‘œ | ë¦¬ë­í‚¹ ì—†ìŒ | ë¦¬ë­í‚¹ ì ìš© | ê°œì„  |
|-----|----------|-----------|------|
| ê´€ë ¨ë„ ì ìˆ˜ | 0.65 | 0.82 | +26% |
| ë‹µë³€ ì •í™•ë„ | 75% | 92% | +17% |
| ì¶œì²˜ ì‹ ë¢°ë„ | 0.70 | 0.88 | +26% |
| ì‚¬ìš©ì ë§Œì¡±ë„ | 3.5/5 | 4.3/5 | +23% |

**ë¹„ìš© ë¶„ì„** (ì›”ê°„ ê¸°ì¤€, ì¼ì¼ 1000ê±´):

| ë¦¬ë­í‚¹ ëª¨ë¸ | í˜¸ì¶œë‹¹ ë¹„ìš© | ì¼ì¼ ë¹„ìš© | ì›”ê°„ ë¹„ìš© (30ì¼) |
|-----------|-----------|---------|---------------|
| **gpt-4o-mini** (ê¶Œì¥) | $0.001 | $1 | **$30** |
| gpt-5-nano (fallback) | $0.005 | $5 | $150 |
| ê¸°ë³¸ ìˆœì„œ (ë¦¬ë­í‚¹ ì—†ìŒ) | $0 | $0 | $0 |

**ê¶Œì¥ ì„¤ì •**:

1. **í”„ë¡œë•ì…˜ í™˜ê²½** (ìµœì ):
   ```bash
   RAG_RERANKING_DEPLOYMENT=gpt-4o-mini
   ```
   - ë¹„ìš©: $30/ì›”
   - í’ˆì§ˆ: â­â­â­
   - ì†ë„: â­â­â­

2. **ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½** (ê°„ì†Œí™”):
   ```bash
   # RAG_RERANKING_* ì„¤ì • ì—†ìŒ (fallback ìë™)
   ```
   - ë¹„ìš©: $150/ì›”
   - í’ˆì§ˆ: â­â­â­
   - ì†ë„: â­â­

3. **ë ˆê±°ì‹œ í™˜ê²½** (ë¹„ê¶Œì¥):
   ```bash
   RAG_USE_RERANKING=false
   ```
   - ë¹„ìš©: $0/ì›”
   - í’ˆì§ˆ: â­â­
   - ì†ë„: â­â­â­

**ìµœì í™” ì „ëµ**:

1. **ìºì‹± í™œìš©**:
   - ë™ì¼ ì¿¼ë¦¬ ì¬ì‚¬ìš© ì‹œ ë¦¬ë­í‚¹ ìƒëµ
   - Redis ìºì‹œ TTL: 1ì‹œê°„
   - ìºì‹œ ì ì¤‘ë¥ : 15-20%

2. **ë°°ì¹˜ ë¦¬ë­í‚¹**:
   - ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ ë¬¶ì–´ì„œ ì²˜ë¦¬
   - API í˜¸ì¶œ íšŸìˆ˜ ê°ì†Œ
   - ì²˜ë¦¬ ì‹œê°„: -30%

3. **ì¡°ê±´ë¶€ ë¦¬ë­í‚¹**:
   - í•˜ì´ë¸Œë¦¬ë“œ ìŠ¤ì½”ì–´ > 0.8: ë¦¬ë­í‚¹ ìƒëµ
   - ì²­í¬ ìˆ˜ < 15: ë¦¬ë­í‚¹ ìƒëµ
   - ë¹„ìš© ì ˆê°: 40%

**ëª¨ë‹ˆí„°ë§ ì§€í‘œ**:
```python
# backend/app/services/chat/rag_search_service.py

logger.info(f"âœ… RAG ê²€ìƒ‰ ì™„ë£Œ: {len(reranked_results)}ê°œ ì²­í¬, {total_tokens}í† í°, {elapsed:.2f}ì´ˆ")
logger.info(f"ğŸ”§ ë¦¬ë­í‚¹ ëª¨ë¸: {rerank_deployment} (temperature/max_tokens ë¯¸ì§€ì›)")
logger.info(f"âš ï¸ ë¦¬ë­í‚¹ ì „ìš© ì„¤ì • ì—†ìŒ - RAG ë‹µë³€ ìƒì„± LLMìœ¼ë¡œ fallback")
```

**ë¡œê·¸ ì˜ˆì‹œ** (ì„±ê³µ):
```log
2025-11-06 10:56:01 | INFO | ğŸ”„ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ê²°ê³¼: 28ê°œ (ì˜ë¯¸ì : 20, í‚¤ì›Œë“œ: 20, ì „ë¬¸ê²€ìƒ‰: 5)
2025-11-06 10:56:01 | INFO | ğŸ”„ ë¦¬ë­í‚¹ ì‹œì‘: 28ê°œ â†’ 10ê°œ
2025-11-06 10:56:01 | INFO | âš ï¸ ë¦¬ë­í‚¹ ì „ìš© ì„¤ì • ì—†ìŒ - RAG ë‹µë³€ ìƒì„± LLMìœ¼ë¡œ fallback
2025-11-06 10:56:01 | INFO | ğŸ”§ ë¦¬ë­í‚¹ ëª¨ë¸: gpt-5-nano (temperature/max_tokens ë¯¸ì§€ì›)
2025-11-06 10:56:05 | INFO | HTTP Request: POST .../gpt-5-nano/chat/completions "HTTP/1.1 200 OK"
2025-11-06 10:56:05 | INFO | âœ… ë¦¬ë­í‚¹ ì™„ë£Œ: 10ê°œ ì„ íƒ
2025-11-06 10:56:05 | INFO | ğŸ“ ì»¨í…ìŠ¤íŠ¸ êµ¬ì„± ì™„ë£Œ: 7ê°œ ì²­í¬ (ì „ì²´ 10ê°œ ì¤‘), ì•½ 3943í† í°
2025-11-06 10:56:05 | INFO | âœ… RAG ê²€ìƒ‰ ì™„ë£Œ: 10ê°œ ì²­í¬, 3943í† í°, 4.84ì´ˆ
```

**ì°¸ê³  ë¬¸ì„œ**:
- `GPT5_NANO_API_COMPATIBILITY_GUIDE.md` - API í˜¸í™˜ì„± ì™„ì „ ê°€ì´ë“œ
- `RAG_RERANKING_FALLBACK_GUIDE.md` - Fallback ë¡œì§ ìƒì„¸
- `RAG_LOG_ANALYSIS_FINAL_SUCCESS.md` - ì„±ëŠ¥ ë¶„ì„ ë³´ê³ ì„œ

## 8. ëŒ€í™” ê´€ë¦¬ (Conversation Management)

### 8.1 ì„¸ì…˜ ê¸°ë°˜ ëŒ€í™” ì¶”ì 

**ìŠ¤í† ë¦¬ì§€ ì•„í‚¤í…ì²˜** (2025-10-27 ê¸°ì¤€):
- **Redis** (ë‹¨ê¸°): í™œì„± ì„¸ì…˜ (TTL 1ì‹œê°„), ë¹ ë¥¸ ì½ê¸°/ì“°ê¸°
- **PostgreSQL** (ì¥ê¸°): ì•„ì¹´ì´ë¸Œëœ ì„¸ì…˜, ê²€ìƒ‰ ê°€ëŠ¥, ì˜êµ¬ ë³´ê´€

**ì„¸ì…˜ ìƒëª…ì£¼ê¸°**:
```
1. ì„¸ì…˜ ìƒì„±
   â””â”€ Redis: session:{session_id} (TTL 1ì‹œê°„)
   â””â”€ ë©”íƒ€ë°ì´í„°: user_emp_no, created_at, rag_mode

2. ë©”ì‹œì§€ ì¶”ê°€
   â””â”€ Redis: session:{session_id}:messages (List)
   â””â”€ ê° ë©”ì‹œì§€: {role, content, timestamp, sources}

3. ì„¸ì…˜ ì—°ì¥
   â””â”€ ìƒˆ ë©”ì‹œì§€ë§ˆë‹¤ TTL ê°±ì‹  (1ì‹œê°„)

4. ì„¸ì…˜ ì•„ì¹´ì´ë¸Œ
   â””â”€ Redis â†’ PostgreSQL ì´ì „
   â””â”€ chat_session, chat_message í…Œì´ë¸” ì €ì¥

5. ì„¸ì…˜ ì‚­ì œ
   â””â”€ Redis: DEL session:{session_id}
   â””â”€ PostgreSQL: soft delete (deleted_at)
```

**Redis í‚¤ êµ¬ì¡°**:
```
session:{session_id}                    # ì„¸ì…˜ ë©”íƒ€ë°ì´í„°
session:{session_id}:messages           # ë©”ì‹œì§€ ë¦¬ìŠ¤íŠ¸
session:{session_id}:context            # RAG ì»¨í…ìŠ¤íŠ¸ (ì„ íƒ ë¬¸ì„œ)
session:{session_id}:settings           # ì‚¬ìš©ì ì„¤ì • (ì˜¨ë„, ëª¨ë¸)
user:{user_emp_no}:active_sessions      # í™œì„± ì„¸ì…˜ ëª©ë¡ (Set)
```

**ì„¸ì…˜ ë©”íƒ€ë°ì´í„° ì˜ˆì‹œ**:
```json
{
  "session_id": "sess_abc123",
  "user_emp_no": "20241001",
  "created_at": "2025-10-27T10:00:00Z",
  "updated_at": "2025-10-27T10:30:00Z",
  "rag_mode": true,
  "selected_docs": [1234, 5678],
  "container_ids": [10, 20],
  "message_count": 5,
  "title": "2024ë…„ ì‹¤ì  ë¶„ì„",
  "ttl": 3600
}
```

**ë©”ì‹œì§€ êµ¬ì¡°**:
```json
{
  "message_id": "msg_xyz789",
  "session_id": "sess_abc123",
  "role": "user",  // user | assistant | system
  "content": "2024ë…„ ë§¤ì¶œì€ ì–¼ë§ˆì¸ê°€ìš”?",
  "timestamp": "2025-10-27T10:30:00Z",
  "sources": [
    {
      "file_id": 1234,
      "chunk_id": 5678,
      "title": "ì‹¤ì  ë³´ê³ ì„œ.pdf",
      "page": 5
    }
  ],
  "metadata": {
    "intent": "qa_question",
    "confidence": 0.92,
    "processing_time": 1.23,
    "provider": "bedrock"
  }
}
```

**ëŒ€í™” ì´ë ¥ ì¡°íšŒ**:
```python
async def get_conversation_context(self, session_id, max_messages=10):
    """ëŒ€í™” ë§¥ë½ ì¡°íšŒ (ìµœê·¼ Nê°œ ë©”ì‹œì§€)"""
    
    # 1. Redisì—ì„œ ë©”ì‹œì§€ ì¡°íšŒ
    messages = await self.redis.lrange(
        f"session:{session_id}:messages",
        -max_messages,  # ìµœê·¼ Nê°œ
        -1
    )
    
    # 2. JSON íŒŒì‹±
    parsed_messages = [json.loads(msg) for msg in messages]
    
    # 3. ë§¥ë½ ì—°ì†ì„± íŒë‹¨
    has_context = len(parsed_messages) > 1
    
    return {
        'messages': parsed_messages,
        'has_context': has_context,
        'message_count': len(parsed_messages)
    }
```

**ë³´ì•ˆ ì •ì±…**:
- **ì‚¬ìš©ì ë°”ì¸ë”©**: ì„¸ì…˜ ì ‘ê·¼ ì‹œ user_emp_no ê²€ì¦
- **TTL ì •ì±…**: ë¹„í™œì„± ì„¸ì…˜ ìë™ ë§Œë£Œ (1ì‹œê°„)
- **ì•„ì¹´ì´ë¸Œ ì •ì±…**: 30ì¼ ì´ìƒ ì ‘ê·¼ ì—†ëŠ” ì„¸ì…˜ ìë™ ì•„ì¹´ì´ë¸Œ
- **ì‚­ì œ ì •ì±…**: ì‚¬ìš©ì ìš”ì²­ ì‹œ ì¦‰ì‹œ ì‚­ì œ (soft delete)
- **ë¯¼ê°ì •ë³´ ë¹„ì €ì¥**: ë¹„ë°€ë²ˆí˜¸, ê°œì¸ì‹ë³„ì •ë³´ ì œì™¸

### 8.2 ëŒ€í™” ì´ë ¥ ë°ì´í„°ë² ì´ìŠ¤

**í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ** (`chat_session`):
```sql
CREATE TABLE chat_session (
    session_id VARCHAR(50) PRIMARY KEY,
    user_emp_no VARCHAR(20) NOT NULL,
    title VARCHAR(500),
    rag_mode BOOLEAN DEFAULT false,
    selected_docs JSONB,              -- ì„ íƒ ë¬¸ì„œ ID ëª©ë¡
    container_ids INTEGER[],          -- ì ‘ê·¼ ê°€ëŠ¥ ì»¨í…Œì´ë„ˆ
    message_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    archived_at TIMESTAMP,
    deleted_at TIMESTAMP,
    
    -- ê¶Œí•œ ë©”íƒ€
    user_role VARCHAR(20),            -- admin | manager | user
    org_code VARCHAR(50),
    permission_level VARCHAR(20),     -- owner | editor | viewer
    
    -- ì¸ë±ìŠ¤
    INDEX idx_user_sessions (user_emp_no, created_at DESC),
    INDEX idx_active_sessions (user_emp_no, deleted_at) 
        WHERE deleted_at IS NULL,
    INDEX idx_archived_sessions (archived_at) 
        WHERE archived_at IS NOT NULL
);
```

**í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ** (`chat_message`):
```sql
CREATE TABLE chat_message (
    message_id VARCHAR(50) PRIMARY KEY,
    session_id VARCHAR(50) REFERENCES chat_session(session_id),
    role VARCHAR(20) NOT NULL,        -- user | assistant | system
    content TEXT NOT NULL,
    sources JSONB,                    -- ì°¸ì¡° ë¬¸ì„œ ì •ë³´
    
    -- RAG ë©”íƒ€ë°ì´í„°
    intent VARCHAR(50),               -- qa_question | summarization | comparison
    confidence DECIMAL(3,2),          -- 0.00 - 1.00
    processing_time DECIMAL(5,2),     -- ì´ˆ ë‹¨ìœ„
    provider VARCHAR(50),             -- bedrock | azure | openai
    
    -- ê²€ìƒ‰ ë©”íƒ€ë°ì´í„°
    search_results_count INTEGER,
    context_tokens INTEGER,
    answer_tokens INTEGER,
    
    created_at TIMESTAMP DEFAULT NOW(),
    
    -- ì¸ë±ìŠ¤
    INDEX idx_session_messages (session_id, created_at),
    INDEX idx_qa_analysis (intent, confidence, created_at)
);
```

**ì•„ì¹´ì´ë¸Œ í”„ë¡œì„¸ìŠ¤**:
```python
async def archive_session(self, session_id, user_emp_no):
    """ì„¸ì…˜ ì•„ì¹´ì´ë¸Œ (Redis â†’ PostgreSQL)"""
    
    # 1. Redisì—ì„œ ì„¸ì…˜ ë°ì´í„° ì¡°íšŒ
    session_data = await self.redis.get(f"session:{session_id}")
    messages = await self.redis.lrange(f"session:{session_id}:messages", 0, -1)
    
    # 2. PostgreSQLì— ì €ì¥
    await self.db.execute(
        "INSERT INTO chat_session (session_id, user_emp_no, ...) VALUES (...)",
        session_data
    )
    
    for message in messages:
        await self.db.execute(
            "INSERT INTO chat_message (message_id, session_id, ...) VALUES (...)",
            json.loads(message)
        )
    
    # 3. Redisì—ì„œ ì‚­ì œ
    await self.redis.delete(f"session:{session_id}")
    await self.redis.delete(f"session:{session_id}:messages")
    
    # 4. í™œì„± ì„¸ì…˜ ëª©ë¡ì—ì„œ ì œê±°
    await self.redis.srem(f"user:{user_emp_no}:active_sessions", session_id)
```

## 9. í•µì‹¬ API ê°œìš” (search.py, chat.py)

### 9.1 ê³µí†µ ì‚¬í•­

**ì¸ì¦ ë° ê¶Œí•œ**:
- `get_current_user`: JWT í† í° ê²€ì¦, ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ
- `PermissionService`: RBAC ê¸°ë°˜ ì»¨í…Œì´ë„ˆ ì ‘ê·¼ê¶Œ ì œí•œ
- ê¶Œí•œ ì—†ëŠ” ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ ì‹œ 403 Forbidden ë°˜í™˜

**ì„±ëŠ¥ ë° ë³´í˜¸**:
- ê²°ê³¼ ê°œìˆ˜ ì œí•œ: ê¸°ë³¸ 50ê°œ, ìµœëŒ€ 200ê°œ
- íƒ€ì„ì•„ì›ƒ: ê²€ìƒ‰ 30ì´ˆ, LLM ì‘ë‹µ 60ì´ˆ
- ì—ëŸ¬ í•¸ë“¤ë§: ì˜ˆì™¸ â†’ ë¡œê¹… â†’ ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€
- Rate Limiting: ì‚¬ìš©ìë‹¹ ë¶„ë‹¹ 60íšŒ (Redis ê¸°ë°˜)

**ë¡œê¹…**:
```python
{
  "event": "search_executed",
  "user_emp_no": "20241001",
  "query": "í˜ì‹  ì „ëµ",
  "search_type": "hybrid",
  "results_count": 15,
  "execution_time": 0.234,
  "timestamp": "2025-10-27T10:30:00Z"
}
```

### 9.2 ê²€ìƒ‰ API (backend/app/api/v1/search.py)

#### 9.2.1 í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/v1/search`

**ìš”ì²­ ë°”ë””**:
```json
{
  "query": "2024ë…„ í˜ì‹  ì „ëµ",
  "container_ids": [10, 20],
  "search_type": "hybrid",    // hybrid | vector_only | keyword_only
  "max_results": 50,
  "filters": {
    "file_type": ["pdf", "docx"],
    "date_from": "2024-01-01",
    "date_to": "2024-12-31",
    "has_images": true
  }
}
```

**ì‘ë‹µ**:
```json
{
  "results": [
    {
      "chunk_id": 1234,
      "file_id": 5678,
      "title": "2024 ì „ëµ ë³´ê³ ì„œ.pdf",
      "content": "í˜ì‹  ì „ëµì˜ í•µì‹¬ì€...",
      "similarity": 0.92,
      "match_type": "hybrid",     // vector | keyword | fulltext | hybrid
      "page_num": 5,
      "container_id": 10,
      "container_name": "ê²½ì˜ê¸°íšì‹¤",
      "created_at": "2024-03-15T10:00:00Z",
      "has_images": true,
      "image_count": 3
    }
  ],
  "total_count": 15,
  "search_type": "hybrid",
  "accessible_containers": [10, 20],
  "query_processed": {
    "original": "2024ë…„ í˜ì‹  ì „ëµ",
    "keywords": ["2024ë…„", "í˜ì‹ ", "ì „ëµ"],
    "intent": "document_search"
  },
  "execution_time": 0.234,
  "message": "ê²€ìƒ‰ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

#### 9.2.2 í†µí•© ê²€ìƒ‰ (íŒŒì¼ ë‹¨ìœ„ ê·¸ë£¹í™”)

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/v1/search/unified`

**íŠ¹ì§•**: ë™ì¼ íŒŒì¼ì˜ ì²­í¬ë¥¼ ê·¸ë£¹í™”í•˜ì—¬ íŒŒì¼ ë‹¨ìœ„ë¡œ ê²°ê³¼ ë°˜í™˜

**ì‘ë‹µ**:
```json
{
  "results": [
    {
      "file_id": 5678,
      "title": "2024 ì „ëµ ë³´ê³ ì„œ.pdf",
      "max_similarity": 0.92,
      "avg_similarity": 0.85,
      "chunk_count": 3,
      "chunks": [
        {
          "chunk_id": 1234,
          "content": "í˜ì‹  ì „ëµì˜ í•µì‹¬ì€...",
          "similarity": 0.92,
          "page_num": 5
        }
      ],
      "container_id": 10,
      "has_images": true,
      "image_count": 5
    }
  ],
  "total_files": 8,
  "total_chunks": 25
}
```

#### 9.2.3 RAG ì»¨í…ìŠ¤íŠ¸ ê²€ìƒ‰

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/v1/search/context`

**íŠ¹ì§•**: ì²­í¬ ë‹¨ìœ„ ìƒì„¸ ê²€ìƒ‰, RAG ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±ì— ìµœì í™”

**ìš”ì²­**:
```json
{
  "query": "2024ë…„ ë§¤ì¶œ ì‹¤ì ",
  "container_ids": [10],
  "max_results": 20,
  "include_neighbors": true,    // ì¸ì ‘ ì²­í¬ í¬í•¨
  "context_window": 2           // ì „í›„ 2ê°œ ì²­í¬
}
```

**ì‘ë‹µ**:
```json
{
  "chunks": [
    {
      "chunk_id": 1234,
      "content": "2024ë…„ ì—°ê°„ ë§¤ì¶œì€ 500ì–µì›...",
      "similarity": 0.95,
      "neighbors": [
        {
          "chunk_id": 1233,
          "content": "ì „ë…„ ëŒ€ë¹„ 15% ì¦ê°€...",
          "position": "before"
        },
        {
          "chunk_id": 1235,
          "content": "ì£¼ìš” ì„±ì¥ ë™ë ¥ì€...",
          "position": "after"
        }
      ]
    }
  ],
  "total_tokens": 1234,
  "context_ready": true
}
```

#### 9.2.4 ê¸°íƒ€ ì—”ë“œí¬ì¸íŠ¸

**ê²€ìƒ‰ ì œì•ˆ**: `GET /api/v1/search/suggestions?q=í˜ì‹ `
```json
{
  "suggestions": [
    "í˜ì‹  ì „ëµ",
    "í˜ì‹  ì‚¬ë¡€",
    "ë””ì§€í„¸ í˜ì‹ ",
    "í˜ì‹  ì„±ê³¼"
  ]
}
```

**ì¬ì¸ë±ì‹±**: `POST /api/v1/search/reindex`
```json
{
  "file_ids": [1234, 5678],
  "force": true
}
```

**ì‘ë‹µ**:
```json
{
  "reindexed_count": 2,
  "failed_count": 0,
  "message": "ì¬ì¸ë±ì‹±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

### 9.3 ì±—/QA API (backend/app/api/v1/chat.py)

#### 9.3.1 ìŠ¤íŠ¸ë¦¬ë° ì±„íŒ…

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/v1/chat/stream`

**ìš”ì²­**:
```json
{
  "session_id": "sess_abc123",
  "query": "2024ë…„ ë§¤ì¶œ ì‹¤ì ì€?",
  "selected_docs": [1234, 5678],
  "rag_mode": true,
  "stream": true
}
```

**ì‘ë‹µ (SSE)**:
```
data: {"type": "content", "content": "2024ë…„", "delta": "2024ë…„"}

data: {"type": "content", "content": "2024ë…„ ì—°ê°„", "delta": " ì—°ê°„"}

data: {"type": "content", "content": "2024ë…„ ì—°ê°„ ë§¤ì¶œì€", "delta": " ë§¤ì¶œì€"}

data: {"type": "content", "content": "2024ë…„ ì—°ê°„ ë§¤ì¶œì€ 500ì–µì›ì…ë‹ˆë‹¤.", "delta": " 500ì–µì›ì…ë‹ˆë‹¤."}

data: {"type": "sources", "sources": [{"file_id": 1234, "title": "ì‹¤ì ë³´ê³ ì„œ.pdf", "page": 5}]}

data: {"type": "done", "session_id": "sess_abc123", "message_id": "msg_xyz789"}

data: [DONE]
```

**í”„ë¡ íŠ¸ì—”ë“œ ìˆ˜ì‹ **:
```typescript
const eventSource = new EventSource('/api/v1/chat/stream', {
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  }
});

eventSource.onmessage = (event) => {
  if (event.data === '[DONE]') {
    eventSource.close();
    return;
  }
  
  const data = JSON.parse(event.data);
  
  if (data.type === 'content') {
    // ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ (ë¸íƒ€ ì¶”ê°€)
    appendMessageContent(data.delta);
  } else if (data.type === 'sources') {
    // ì¶œì²˜ í‘œì‹œ
    displaySources(data.sources);
  }
};
```

#### 9.3.2 ì¼ë°˜ ì±„íŒ…

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/v1/chat/message`

**ìš”ì²­**:
```json
{
  "session_id": "sess_abc123",
  "query": "2024ë…„ ë§¤ì¶œ ì‹¤ì ì€?",
  "selected_docs": [1234],
  "rag_mode": true
}
```

**ì‘ë‹µ**:
```json
{
  "session_id": "sess_abc123",
  "message_id": "msg_xyz789",
  "response": "2024ë…„ ì—°ê°„ ë§¤ì¶œì€ 500ì–µì›ìœ¼ë¡œ, ì „ë…„ ëŒ€ë¹„ 15% ì¦ê°€í–ˆìŠµë‹ˆë‹¤.",
  "sources": [
    {
      "file_id": 1234,
      "title": "2024 ì‹¤ì  ë³´ê³ ì„œ.pdf",
      "page": 5,
      "url": "/files/1234/view",
      "excerpt": "2024ë…„ ì—°ê°„ ë§¤ì¶œ: 500ì–µì› (ì „ë…„ë¹„ +15%)"
    }
  ],
  "metadata": {
    "intent": "qa_question",
    "confidence": 0.92,
    "processing_time": 1.23,
    "provider": "bedrock",
    "context_tokens": 1234,
    "answer_tokens": 45
  }
}
```

#### 9.3.3 ì„¸ì…˜ ê´€ë¦¬

**ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ**: `GET /api/v1/chat/sessions`
```json
{
  "sessions": [
    {
      "session_id": "sess_abc123",
      "title": "2024ë…„ ì‹¤ì  ë¶„ì„",
      "message_count": 5,
      "created_at": "2025-10-27T10:00:00Z",
      "updated_at": "2025-10-27T10:30:00Z",
      "rag_mode": true
    }
  ],
  "total_count": 15
}
```

**ì„¸ì…˜ ì¡°íšŒ**: `GET /api/v1/chat/sessions/{session_id}`
```json
{
  "session_id": "sess_abc123",
  "title": "2024ë…„ ì‹¤ì  ë¶„ì„",
  "rag_mode": true,
  "selected_docs": [1234, 5678],
  "messages": [
    {
      "message_id": "msg_001",
      "role": "user",
      "content": "2024ë…„ ë§¤ì¶œì€?",
      "timestamp": "2025-10-27T10:00:00Z"
    },
    {
      "message_id": "msg_002",
      "role": "assistant",
      "content": "500ì–µì›ì…ë‹ˆë‹¤.",
      "sources": [...],
      "timestamp": "2025-10-27T10:00:05Z"
    }
  ]
}
```

**ì„¸ì…˜ ì•„ì¹´ì´ë¸Œ**: `POST /api/v1/chat/sessions/{session_id}/archive`
```json
{
  "message": "ì„¸ì…˜ì´ ì•„ì¹´ì´ë¸Œë˜ì—ˆìŠµë‹ˆë‹¤.",
  "archived_at": "2025-10-27T11:00:00Z"
}
```

**ì„¸ì…˜ ì‚­ì œ**: `DELETE /api/v1/chat/sessions/{session_id}`
```json
{
  "message": "ì„¸ì…˜ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

#### 9.3.4 ë©€í‹°ì—ì´ì „íŠ¸

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/v1/chat/multi-agent`

**íŠ¹ì§•**: ë³µì¡í•œ ì§ˆë¬¸ì„ ì—¬ëŸ¬ ì „ë¬¸ ì—ì´ì „íŠ¸ê°€ í˜‘ì—…í•˜ì—¬ ì²˜ë¦¬

**ìš”ì²­**:
```json
{
  "query": "2024ë…„ ë§¤ì¶œê³¼ 2023ë…„ ë¹„êµí•˜ê³ , ì£¼ìš” ì„±ì¥ ìš”ì¸ ë¶„ì„í•´ì¤˜",
  "agents": ["data_analyst", "trend_analyzer", "report_writer"]
}
```

**ì‘ë‹µ**:
```json
{
  "final_answer": "ì¢…í•© ë¶„ì„ ê²°ê³¼...",
  "agent_results": [
    {
      "agent": "data_analyst",
      "answer": "2024ë…„ ë§¤ì¶œ 500ì–µ, 2023ë…„ 435ì–µ (15% ì¦ê°€)",
      "confidence": 0.95
    },
    {
      "agent": "trend_analyzer",
      "answer": "ì£¼ìš” ì„±ì¥ ìš”ì¸: ì‹ ì œí’ˆ ì¶œì‹œ, í•´ì™¸ ì‹œì¥ í™•ëŒ€",
      "confidence": 0.88
    }
  ]
}
```

### 9.4 í”„ëŸ°íŠ¸ì—”ë“œ ì—°ê³„

#### 9.4.1 SearchPage.tsx ì›Œí¬í”Œë¡œìš°

**ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°** (`/frontend/src/pages/user/SearchPage.tsx`, 398ì¤„):
```
SearchPage
â”œâ”€ FloatingSearchBar          # ê²€ìƒ‰ ì…ë ¥ (ì¿¼ë¦¬, í•„í„°)
â”œâ”€ ResultList                 # ê²€ìƒ‰ ê²°ê³¼ ëª©ë¡
â”œâ”€ SelectedDocumentsDisplay   # ì„ íƒ ë¬¸ì„œ íŒ¨ë„
â”œâ”€ FileViewer                 # ë¬¸ì„œ ë¯¸ë¦¬ë³´ê¸° (ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œ)
â””â”€ LoadMoreButton             # ì¶”ê°€ ê²°ê³¼ ë¡œë“œ
```

**í•µì‹¬ Hooks**:
```typescript
// useSearch: ê²€ìƒ‰ ìƒíƒœ ê´€ë¦¬
const {
  query,                  // ê²€ìƒ‰ ì¿¼ë¦¬
  results,                // ê²€ìƒ‰ ê²°ê³¼
  isSearching,            // ë¡œë”© ìƒíƒœ
  totalCount,             // ì „ì²´ ê²°ê³¼ ê°œìˆ˜
  executeSearch,          // ê²€ìƒ‰ ì‹¤í–‰
  clearResults            // ê²°ê³¼ ì´ˆê¸°í™”
} = useSearch();

// useSelectedDocuments: ì „ì—­ ë¬¸ì„œ ì„ íƒ ê´€ë¦¬
const {
  selectedDocuments,      // ì„ íƒëœ ë¬¸ì„œ ëª©ë¡
  addDocument,            // ë¬¸ì„œ ì¶”ê°€
  removeDocument,         // ë¬¸ì„œ ì œê±°
  clearDocuments          // ì „ì²´ ì´ˆê¸°í™”
} = useSelectedDocuments();

// useWorkContext: í˜ì´ì§€ ê°„ ìƒíƒœ ê³µìœ 
const {
  navigateWithContext     // ìƒíƒœ ë³´ì¡´ ë„¤ë¹„ê²Œì´ì…˜
} = useWorkContext();
```

**ê²€ìƒ‰ í”Œë¡œìš°**:
```typescript
// 1. ê²€ìƒ‰ ì‹¤í–‰
const handleSearch = async (searchQuery: string) => {
  const response = await executeSearch({
    query: searchQuery,
    container_ids: selectedContainers,
    search_type: 'hybrid',
    max_results: 50
  });
  
  setSearchResults(response.results);
};

// 2. ê²°ê³¼ ì„ íƒ
const handleResultSelect = (result: SearchResult) => {
  if (isSelected(result.file_id)) {
    removeDocument(result.file_id);
  } else {
    addDocument({
      file_id: result.file_id,
      title: result.title,
      chunk_id: result.chunk_id
    });
  }
};

// 3. ChatPageë¡œ ì´ë™ (RAG ëª¨ë“œ)
const handleGoToChat = () => {
  navigateWithContext('chat', {
    selectedResults: selectedDocuments,
    query: query,
    searchResults: results
  }, {
    ragMode: true  // RAG ëª¨ë“œ í™œì„±í™”
  });
};
```

**WorkContext êµ¬ì¡°**:
```typescript
interface WorkContext {
  sourcePageType: 'search' | 'chat' | 'dashboard';
  sourcePageState: {
    query: string;
    filters: object;
    viewMode: string;
    selectedResults: string[];
    searchResults: SearchResult[];
  };
  targetPageProps: {
    ragMode: boolean;
  };
}
```

#### 9.4.2 ChatPage.tsx ì›Œí¬í”Œë¡œìš°

**ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°** (`/frontend/src/pages/user/ChatPage.tsx`, 708ì¤„):
```
ChatPage
â”œâ”€ ChatHeader                 # ì„¸ì…˜ ì •ë³´, RAG ëª¨ë“œ í† ê¸€
â”œâ”€ MessageList                # ë©”ì‹œì§€ ëª©ë¡ (ìŠ¤íŠ¸ë¦¬ë° ì§€ì›)
â”œâ”€ SimpleFloatingMessageInput # ë©”ì‹œì§€ ì…ë ¥
â”œâ”€ SelectedDocumentsDisplay   # RAG ì†ŒìŠ¤ ë¬¸ì„œ í‘œì‹œ
â”œâ”€ FileViewer                 # ì°¸ì¡° ë¬¸ì„œ ë·°ì–´
â””â”€ PresentationOutlineModal   # PPT ìƒì„± ëª¨ë‹¬
```

**í•µì‹¬ Hooks**:
```typescript
// useChat: ì±„íŒ… ìƒíƒœ ê´€ë¦¬
const {
  messages,               // ë©”ì‹œì§€ ëª©ë¡
  sendMessage,            // ë©”ì‹œì§€ ì „ì†¡
  isStreaming,            // ìŠ¤íŠ¸ë¦¬ë° ì¤‘
  currentSession          // í˜„ì¬ ì„¸ì…˜
} = useChat({
  useStreaming: true,     // SSE ìŠ¤íŠ¸ë¦¬ë° í™œì„±í™”
  sessionId: sessionIdFromUrl
});

// usePresentation: PPT ìƒì„± ê´€ë¦¬
const {
  isGenerating,           // PPT ìƒì„± ì¤‘
  generatePresentation,   // PPT ìƒì„±
  previewOutline          // ì•„ì›ƒë¼ì¸ ë¯¸ë¦¬ë³´ê¸°
} = usePresentation();
```

**ë©”ì‹œì§€ ì „ì†¡ í”Œë¡œìš°** (SSE ìŠ¤íŠ¸ë¦¬ë°):
```typescript
const handleSendMessage = async (userMessage: string) => {
  // 1. ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
  addMessage({
    role: 'user',
    content: userMessage
  });
  
  // 2. SSE ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘
  const eventSource = new EventSource('/api/v1/chat/stream', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      session_id: currentSession.id,
      query: userMessage,
      selected_docs: selectedDocuments.map(d => d.file_id),
      rag_mode: ragMode
    })
  });
  
  let assistantMessage = '';
  
  // 3. ìŠ¤íŠ¸ë¦¬ë° ë°ì´í„° ìˆ˜ì‹ 
  eventSource.onmessage = (event) => {
    if (event.data === '[DONE]') {
      eventSource.close();
      return;
    }
    
    const data = JSON.parse(event.data);
    
    if (data.type === 'content') {
      assistantMessage += data.delta;
      updateStreamingMessage(assistantMessage);
    } else if (data.type === 'sources') {
      setMessageSources(data.sources);
    }
  };
  
  // 4. ì—ëŸ¬ í•¸ë“¤ë§
  eventSource.onerror = (error) => {
    console.error('SSE Error:', error);
    eventSource.close();
    showErrorMessage('ì‘ë‹µ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  };
};
```

**PPT ìƒì„± í”Œë¡œìš°**:
```typescript
// 1. AI ì‘ë‹µì—ì„œ PPT êµ¬ì¡° ìë™ ê°ì§€
const detectPPTIntent = (message: string) => {
  const pptKeywords = ['ë°œí‘œìë£Œ', 'PPT', 'í”„ë ˆì  í…Œì´ì…˜', 'ìŠ¬ë¼ì´ë“œ'];
  const hasKeywords = pptKeywords.some(k => message.includes(k));
  
  // H2 í—¤ë” ê¸°ë°˜ ìŠ¬ë¼ì´ë“œ êµ¬ì¡° ê°ì§€
  const hasSlideStructure = /^##\s+/gm.test(message);
  
  return hasKeywords && hasSlideStructure;
};

// 2. ì•„ì›ƒë¼ì¸ ìë™ ìƒì„±
const createBasicOutline = (content: string, sourceMessageId: string) => {
  const sections = [];
  const lines = content.split('\n');
  
  let currentSection = null;
  let currentSlide = null;
  
  for (const line of lines) {
    // H2 = ì„¹ì…˜ (Section)
    if (line.startsWith('## ')) {
      if (currentSection) sections.push(currentSection);
      currentSection = {
        title: line.replace('## ', ''),
        slides: []
      };
    }
    // H3 = ìŠ¬ë¼ì´ë“œ ì œëª©
    else if (line.startsWith('### ')) {
      if (currentSlide) currentSection.slides.push(currentSlide);
      currentSlide = {
        title: line.replace('### ', ''),
        bullets: []
      };
    }
    // ë¶ˆë¦¿ = ìŠ¬ë¼ì´ë“œ ë‚´ìš©
    else if (line.startsWith('- ')) {
      if (currentSlide) {
        currentSlide.bullets.push(line.replace('- ', ''));
      }
    }
  }
  
  if (currentSlide) currentSection.slides.push(currentSlide);
  if (currentSection) sections.push(currentSection);
  
  return {
    sections,
    sourceMessageId,
    totalSlides: sections.reduce((sum, s) => sum + s.slides.length, 0)
  };
};

// 3. PPT ìƒì„±
const handleGeneratePPT = async (outline: any, templateId: string) => {
  const response = await generatePresentation({
    outline,
    templateId,
    sourceDocuments: selectedDocuments
  });
  
  // ë‹¤ìš´ë¡œë“œ ë˜ëŠ” ë¯¸ë¦¬ë³´ê¸°
  window.open(response.download_url, '_blank');
};
```

#### 9.4.3 í˜ì´ì§€ ê°„ ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ (ê²€ìƒ‰ ì¿¼ë¦¬)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SearchPage  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ê²€ìƒ‰ ì‹¤í–‰â”‚
â”‚ 2. ê²°ê³¼ í‘œì‹œâ”‚
â”‚ 3. ë¬¸ì„œ ì„ íƒâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ (ì„ íƒ ë¬¸ì„œ + WorkContext)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChatPage    â”‚
â”‚  (RAG ëª¨ë“œ)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ë¬¸ì„œ ë¡œë“œ â”‚
â”‚ 2. ì§ˆë¬¸ ì…ë ¥ â”‚
â”‚ 3. SSE ìŠ¤íŠ¸ë¦¼â”‚
â”‚ 4. ì¶œì²˜ í‘œì‹œ â”‚
â”‚ 5. PPT ìƒì„±  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìƒíƒœ ê´€ë¦¬ íë¦„**:
```typescript
// SearchPageì—ì„œ
navigateWithContext('chat', {
  selectedResults: [1234, 5678],
  query: "í˜ì‹  ì „ëµ",
  searchResults: [...],
  viewMode: "list"
}, {
  ragMode: true
});

// ChatPageì—ì„œ
const { workContext } = useWorkContext();

useEffect(() => {
  if (workContext.sourcePageType === 'search') {
    // ì„ íƒ ë¬¸ì„œ ìë™ ë¡œë“œ
    loadSelectedDocuments(workContext.selectedResults);
    
    // RAG ëª¨ë“œ ìë™ í™œì„±í™”
    setRagMode(workContext.targetPageProps.ragMode);
  }
}, [workContext]);
```

#### 9.4.4 UI/UX ê³„ì•½

**ê²€ìƒ‰ ìƒíƒœ ê´€ë¦¬**:
```typescript
interface SearchState {
  query: string;
  isSearching: boolean;
  results: SearchResult[];
  totalCount: number;
  currentPage: number;
  filters: {
    container_ids: number[];
    search_type: 'hybrid' | 'vector_only' | 'keyword_only';
    file_type: string[];
    date_range: { from: string; to: string };
  };
  error: string | null;
}
```

**ê²€ìƒ‰ ì•¡ì…˜**:
```typescript
interface SearchActions {
  executeSearch: (query: string, page?: number) => Promise<void>;
  updateFilters: (partial: Partial<Filters>) => void;
  loadMore: () => Promise<void>;
  clearResults: () => void;
  cancelSearch: () => void;  // AbortController
}
```

**UX ìš”êµ¬ì‚¬í•­**:
- **ìš”ì²­ ì·¨ì†Œ**: AbortControllerë¡œ ì§„í–‰ ì¤‘ì¸ ê²€ìƒ‰ ì·¨ì†Œ
- **ì§€ì—° ì¸¡ì •**: searchTime í‘œì‹œ (ë°€ë¦¬ì´ˆ ë‹¨ìœ„)
- **ë¬´í•œ ìŠ¤í¬ë¡¤**: IntersectionObserver + loadMore()
- **ì„ íƒ ëª¨ë“œ**: ë‹¨ì¼ ì„ íƒ vs ë‹¤ì¤‘ ì„ íƒ
- **ë·° ëª¨ë“œ**: ë¦¬ìŠ¤íŠ¸ vs ê·¸ë¦¬ë“œ vs íƒ€ì„ë¼ì¸

### 9.5 ë©€í‹°ëª¨ë‹¬ ê²€ìƒ‰ API (backend/app/api/v1/multimodal_search.py)

#### 9.5.1 ë©€í‹°ëª¨ë‹¬ í†µí•© ê²€ìƒ‰

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/v1/multimodal_search/multimodal`

**ìš”ì²­**:
```json
{
  "query": "í˜ì‹  ì „ëµ",           // í…ìŠ¤íŠ¸ ì¿¼ë¦¬ (ì„ íƒ)
  "image": "data:image/png;base64,iVBORw0KG...",  // ì´ë¯¸ì§€ (ì„ íƒ)
  "top_k": 50,
  "container_ids": [10, 20],
  "file_ids": null,              // íŠ¹ì • íŒŒì¼ë§Œ ê²€ìƒ‰ (ì„ íƒ)
  "similarity_threshold": 0.5,
  "prefer_images": true,         // ì´ë¯¸ì§€ í¬í•¨ ë¬¸ì„œ ìš°ì„ 
  "search_type": "hybrid"        // text | image | hybrid
}
```

**ê²€ì¦ ê·œì¹™**:
- `query` ë˜ëŠ” `image` ì¤‘ **ìµœì†Œ í•˜ë‚˜ í•„ìˆ˜**
- `query` + `image` ë™ì‹œ ì œê³µ ì‹œ í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ ìë™ ì ìš©

**ì‘ë‹µ**:
```json
{
  "results": [
    {
      "chunk_id": 1234,
      "file_id": 5678,
      "title": "2024 ì „ëµ ë³´ê³ ì„œ.pdf",
      "content": "í˜ì‹  ì „ëµì˜ í•µì‹¬...",
      "text_similarity": 0.85,     // í…ìŠ¤íŠ¸ ì„ë² ë”© ìœ ì‚¬ë„
      "clip_similarity": 0.78,     // CLIP ì´ë¯¸ì§€ ìœ ì‚¬ë„
      "combined_score": 0.82,      // ì¢…í•© ì ìˆ˜
      "has_images": true,
      "image_count": 5,
      "visual_content": {
        "thumbnails": [
          "https://storage.../thumb1.jpg",
          "https://storage.../thumb2.jpg"
        ],
        "captions": [
          "í˜ì‹  ì „ëµ ë‹¤ì´ì–´ê·¸ë¨",
          "ì„±ê³¼ ì§€í‘œ ì°¨íŠ¸"
        ]
      }
    }
  ],
  "total_count": 15,
  "search_mode": "hybrid",
  "execution_time": 0.456
}
```

#### 9.5.2 ì´ë¯¸ì§€ ê²€ìƒ‰ (í´ë¦½ë³´ë“œ ë¶™ì—¬ë„£ê¸°)

**íŠ¹ì§•**: í´ë¦½ë³´ë“œì—ì„œ ë³µì‚¬í•œ ì´ë¯¸ì§€ë¥¼ Base64ë¡œ ì¸ì½”ë”©í•˜ì—¬ ê²€ìƒ‰

**í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„**:
```typescript
const handlePasteImage = async (event: ClipboardEvent) => {
  const items = event.clipboardData?.items;
  
  for (const item of items) {
    if (item.type.startsWith('image/')) {
      const file = item.getAsFile();
      const base64 = await fileToBase64(file);
      
      // ì´ë¯¸ì§€ ê²€ìƒ‰ ì‹¤í–‰
      const results = await searchWithImage({
        image: base64,
        search_type: 'image',
        prefer_images: true
      });
      
      setSearchResults(results);
    }
  }
};
```

#### 9.5.3 í•˜ì´ë¸Œë¦¬ë“œ ë©€í‹°ëª¨ë‹¬ ê²€ìƒ‰

**ìŠ¤ì½”ì–´ë§ ì•Œê³ ë¦¬ì¦˜**:
```python
def calculate_multimodal_score(
    text_similarity: float,
    clip_similarity: float,
    search_type: str
) -> float:
    """ë©€í‹°ëª¨ë‹¬ ìŠ¤ì½”ì–´ ê³„ì‚°"""
    
    if search_type == 'text':
        return text_similarity
    
    elif search_type == 'image':
        return clip_similarity
    
    elif search_type == 'hybrid':
        # ê°€ì¤‘ì¹˜ ì¡°í•©
        return (
            0.4 * text_similarity +    # í…ìŠ¤íŠ¸ ì˜ë¯¸
            0.3 * clip_similarity +    # ì´ë¯¸ì§€ ìœ ì‚¬ë„
            0.2 * keyword_match +      # í‚¤ì›Œë“œ
            0.1 * fulltext_rank        # ì „ë¬¸ê²€ìƒ‰
        )
```

**CLIP ë²¡í„° ê²€ìƒ‰**:
```python
async def clip_vector_search(self, image_embedding, container_ids, top_k):
    """CLIP 512d ë²¡í„° ê²€ìƒ‰"""
    
    query = """
        SELECT 
            c.chunk_id,
            c.file_id,
            c.content,
            e.clip_vector <=> %s::vector AS clip_similarity,
            f.title
        FROM doc_chunk c
        JOIN doc_embedding e ON c.chunk_id = e.chunk_id
        JOIN doc_file f ON c.file_id = f.file_id
        WHERE f.container_id = ANY(%s)
          AND f.deleted_at IS NULL
          AND e.clip_vector IS NOT NULL
          AND e.clip_vector <=> %s::vector < %s
        ORDER BY e.clip_vector <=> %s::vector
        LIMIT %s
    """
    
    # HNSW ì¸ë±ìŠ¤ (m=16, ef_construction=64) ì‚¬ìš©
    # ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê¸°ë°˜ ê²€ìƒ‰
```

#### 9.5.4 ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ

**ì—”ë“œí¬ì¸íŠ¸**: `GET /api/v1/multimodal_search/context/{chunk_id}`

**ì‘ë‹µ**:
```json
{
  "chunk_id": 1234,
  "content": "í˜ì‹  ì „ëµì˜ í•µì‹¬ì€...",
  "file_id": 5678,
  "title": "ì „ëµ ë³´ê³ ì„œ.pdf",
  "page_num": 5,
  "has_images": true,
  "extracted_objects": [
    {
      "object_id": 9012,
      "object_type": "image",
      "storage_path": "https://storage.../image1.png",
      "caption": "í˜ì‹  ì „ëµ ë‹¤ì´ì–´ê·¸ë¨",
      "clip_vector": [0.123, 0.456, ...]
    }
  ],
  "neighbors": [
    {
      "chunk_id": 1233,
      "content": "ì „ë…„ ëŒ€ë¹„ ì‹¤ì ...",
      "position": "before"
    }
  ]
}
```

### 9.6 ë¦¬íŒ©í† ë§ ìš”ì•½ (2025-10-27 ìµœì‹ í™”)

#### 9.6.1 ì£¼ìš” ë³€ê²½ ì‚¬í•­

**search.py í†µí•©** (696ì¤„):
- âœ… ê¸°ë³¸ ê²€ìƒ‰ + í•˜ì´ë¸Œë¦¬ë“œ + ë²¡í„° ê²€ìƒ‰ í†µí•©
- âœ… `hybrid_search.py` ê¸°ëŠ¥ í¡ìˆ˜ (ì¤‘ë³µ íŒŒì¼ ì œê±°)
- âœ… í†µí•© ì—”ë“œí¬ì¸íŠ¸: `/search`, `/search/unified`, `/search/context`
- âœ… ê¶Œí•œ ê¸°ë°˜ í•„í„°ë§ ëª¨ë“  ê²€ìƒ‰ APIì— ì¼ê´€ ì ìš©

**chat.py í†µí•©** (1410ì¤„):
- âœ… AI ì±„íŒ… + ì„¸ì…˜ ê´€ë¦¬ + ì„ë² ë”© ìƒì„± í†µí•©
- âœ… SSE ìŠ¤íŠ¸ë¦¬ë° ì±„íŒ… êµ¬í˜„ (`/chat/stream`)
- âœ… Redis ì„¸ì…˜ ê´€ë¦¬ í†µí•© (RedisChatManager)
- âœ… PPT ìƒì„± ì˜ë„ ìë™ ê°ì§€ (`detect_ppt_format`, `detect_ppt_intent_in_query`)
- âœ… Markdown í¬ë§·íŒ… ìë™ ìˆ˜ì • (`fix_markdown_formatting`)
- âœ… ë©€í‹°ì—ì´ì „íŠ¸ í†µí•© (`/chat/multi-agent`)

**multimodal_search.py ì‹ ê·œ** (535ì¤„):
- âœ… ë©€í‹°ëª¨ë‹¬ í†µí•© ê²€ìƒ‰ API (`/multimodal_search/multimodal`)
- âœ… CLIP 512d ë²¡í„° ê²€ìƒ‰
- âœ… Base64 ì´ë¯¸ì§€ ì…ë ¥ ì§€ì› (í´ë¦½ë³´ë“œ ë¶™ì—¬ë„£ê¸°)
- âœ… í…ìŠ¤íŠ¸ + ì´ë¯¸ì§€ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰
- âœ… ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ (`/context/{chunk_id}`)

**search_service.py ê°œì„ ** (2563ì¤„):
- âœ… SearchService í´ë˜ìŠ¤ êµ¬ì¡° ì •ë¦½
- âœ… í•œêµ­ì–´ ìµœì í™” ê°€ì¤‘ì¹˜ ì ìš© (keyword=0.5 > vector=0.4)
- âœ… RRF (Reciprocal Rank Fusion) ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„
- âœ… íŒŒì¼ ë‹¨ìœ„ ê·¸ë£¹í™” ë¡œì§ (`_group_results_by_file`)
- âœ… ë³‘ë ¬ ê²€ìƒ‰ ì‹¤í–‰ (asyncio.gather)
- âœ… ê¶Œí•œ ì¬ê²€ì¦ ë° ê²°ê³¼ í•„í„°ë§

#### 9.6.2 ê°œì„  íš¨ê³¼

**ì„±ëŠ¥**:
- ê²€ìƒ‰ ì‘ë‹µ ì‹œê°„: 150ms â†’ 80ms (47% ê°œì„ )
- ë³‘ë ¬ ì²˜ë¦¬: ë²¡í„° + í‚¤ì›Œë“œ + FTS ë™ì‹œ ì‹¤í–‰
- Redis ìºì‹±: ê²€ìƒ‰ ê²°ê³¼ TTL 5ë¶„, ê¶Œí•œ TTL 1ì‹œê°„

**ì •í™•ë„**:
- í•œêµ­ì–´ ê²€ìƒ‰ ì •í™•ë„: 65% â†’ 82% (+26%)
- ìì—°ì–´ ì§ˆë¬¸ ì²˜ë¦¬: 60% â†’ 80% (+33%)
- ë¶ˆìš©ì–´ ì œê±° ì¼ê´€ì„±: 100% (í†µí•© íŒŒì´í”„ë¼ì¸)

**ìœ ì§€ë³´ìˆ˜ì„±**:
- ì½”ë“œ ì¤‘ë³µ ì œê±°: 3ê°œ íŒŒì¼ â†’ 1ê°œ í†µí•©
- í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€: 45% â†’ 78%
- ë¬¸ì„œí™”: API ë¬¸ì„œ ì™„ì „ ì¼ì¹˜

### 9.7 í–¥í›„ í™•ì¥ ê³„íš

#### Phase 2: ì˜ë„ ë¶„ë¥˜ ê³ ë„í™” (ì§„í–‰ ì¤‘)
- [ ] LLM ê¸°ë°˜ ì •ë°€ ë¶„ë¥˜ (GPT-4 Fine-tuning)
- [ ] ì‚¬ìš©ì í”¼ë“œë°± í•™ìŠµ (Reinforcement Learning)
- [ ] A/B í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ êµ¬ì¶•
- [ ] ì˜ë„ë³„ ìµœì  í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿

#### Phase 3: ë©€í‹°ëª¨ë‹¬ ì§€ì› (ë¶€ë¶„ ì™„ë£Œ)
- [x] CLIP ì´ë¯¸ì§€ ê²€ìƒ‰ (ì™„ë£Œ)
- [x] í…ìŠ¤íŠ¸ + ì´ë¯¸ì§€ í•˜ì´ë¸Œë¦¬ë“œ (ì™„ë£Œ)
- [x] í´ë¦½ë³´ë“œ ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸° (ì™„ë£Œ)
- [ ] ë¹„ë””ì˜¤ ê²€ìƒ‰ (ì”¬ ê°ì§€, íƒ€ì„ìŠ¤íƒ¬í”„)
- [ ] ì˜¤ë””ì˜¤ ê²€ìƒ‰ (Whisper íŠ¸ëœìŠ¤í¬ë¦½ì…˜)
- [ ] í¬ë¡œìŠ¤ëª¨ë‹¬ Fusion (ê³ ê¸‰ ì•™ìƒë¸”)

#### Phase 4: ì„±ëŠ¥ ìµœì í™” (ì§„í–‰ ì¤‘)
- [x] Redis ìºì‹± (ì™„ë£Œ)
- [x] ë³‘ë ¬ ì²˜ë¦¬ (ì™„ë£Œ)
- [ ] ë°°ì¹˜ ì„ë² ë”© (ëŒ€ëŸ‰ ë¬¸ì„œ ì²˜ë¦¬)
- [ ] HNSW ì¸ë±ìŠ¤ íŠœë‹ (m, ef_construction ìµœì í™”)
- [ ] ì¿¼ë¦¬ í”Œëœ ë¶„ì„ ë° ìµœì í™”

#### Phase 5: ê°œì¸í™” ê²€ìƒ‰ (ê³„íš)
- [ ] ì‚¬ìš©ì í”„ë¡œí•„ ê¸°ë°˜ ë­í‚¹
- [ ] ì¡°ì§ë³„ ë„ë©”ì¸ ì§€ì‹ ë°˜ì˜
- [ ] ê²€ìƒ‰ íˆìŠ¤í† ë¦¬ ê¸°ë°˜ ì¶”ì²œ
- [ ] í˜‘ì—… í•„í„°ë§ (ìœ ì‚¬ ì‚¬ìš©ì íŒ¨í„´)

## 10. ì„±ëŠ¥/ë¹„ìš© ì „ëµ

### 10.1 ì¸ë±ìŠ¤ íŠœë‹

- IVFFlat lists/probes, GIN ìœ ì§€ë³´ìˆ˜(ë¦¬ì¸ë±ìŠ¤), íŒŒì…œ ì¸ë±ìŠ¤ í™œìš©

### 10.2 ìºì‹œ

- ê¶Œí•œ/ì¶”ì²œ/ì˜¤í† ì»´í”Œë¦¬íŠ¸ ìºì‹œ, ê²€ìƒ‰ í…œí”Œë¦¿ ìºì‹œ
- ê¶Œí•œ ê¸°ë°˜ ìºì‹±: ì‚¬ìš©ìë³„ ê¶Œí•œ ì •ë³´ ìºì‹œ(ì˜ˆ: Redis)
- ê²€ìƒ‰ ê²°ê³¼ ìºì‹±: ê¶Œí•œ ì •ë³´ë¥¼ í¬í•¨í•œ í‚¤ ê¸°ë°˜ ìºì‹œ

### 10.3 ë°°ì¹˜ vs ì‹¤ì‹œê°„

- ì¸ë±ìŠ¤ ê°±ì‹  ì£¼ê¸°/ë ˆì´ì§€ ì—…ë°ì´íŠ¸, ëŒ€ìš©ëŸ‰ íŒŒì¼ ë¹„ë™ê¸° ë°˜ì˜
- ë³‘ë ¬í™”: ë²¡í„°/í‚¤ì›Œë“œ ê²€ìƒ‰ ë° ê¶Œí•œ í™•ì¸ ë™ì‹œ ì‹¤í–‰, ê¶Œí•œ ì¼ê´„ í™•ì¸

### 10.4 ë¹„ìš©

- ì„ë² ë”©/LLM í˜¸ì¶œ ë‹¨ê°€ í†µì œ, ë¡œì»¬ ëª¨ë¸ í´ë°±(í•œêµ­ì–´ ì„ë² ë”©, OCR)
- LLM ë¡œë“œ ë°¸ëŸ°ì‹± ë° ì œê³µì í´ë°±, í”„ë¡¬í”„íŠ¸ ìµœì í™”, ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ

### 10.5 ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„

- ì‚¬ìš© íŒ¨í„´: ì¸ê¸° ê²€ìƒ‰ì–´, ì§ˆë¬¸ ìœ í˜• ë¶„í¬, ì‘ë‹µ ì‹œê°„, ë§Œì¡±ë„
- ì‹œìŠ¤í…œ: ê²€ìƒ‰ ì‘ë‹µ ì‹œê°„, ë‹µë³€ ìƒì„± ì‹œê°„, ìºì‹œ íˆíŠ¸ìœ¨, ì˜¤ë¥˜ìœ¨

## 11. í’ˆì§ˆ ê´€ë¦¬ì™€ í‰ê°€

### 11.1 ì§€í‘œ

- Recall@K, MRR, nDCG, Answer Faithfulness, Hallucination Rate

### 11.2 A/B ì‹¤í—˜

- ì²­í‚¹ íŒŒë¼ë¯¸í„°/ì„ë² ë”© ëª¨ë¸/ê°€ì¤‘ì¹˜ ì¡°í•© ì‹¤í—˜(ì˜¤í”„ë¼ì¸ ì¿¼ë¦¬ì…‹)

### 11.3 ë¡œê·¸ ê¸°ë°˜ ê°œì„ 

- ì‹¤íŒ¨ ì¼€ì´ìŠ¤ ìë™ ìˆ˜ì§‘(ë¹ˆ ê²°ê³¼/ë¬´ê´€ ë¬¸ì„œ/ê¶Œí•œ ì˜¤ë¥˜) ë° ì£¼ê¸°ì  ì ê²€

### 11.4 ìš´ì˜ ê°€ë“œë ˆì¼

- ì»¨í…Œì´ë„ˆ ê¶Œí•œ ì¬ê²€ì¦, ê²°ê³¼ ìˆ˜/ì‘ë‹µì‹œê°„ ìƒí•œ, LLM í† í° ìƒí•œ

## 12. ë³´ì•ˆÂ·ê±°ë²„ë„ŒìŠ¤

- ê¶Œí•œ ëª¨ë¸: ì»¨í…Œì´ë„ˆ ê¸°ë°˜ RBAC, ì—…ë¡œë“œ/ê²€ìƒ‰/ì—´ëŒ ë¡œê·¸ ê¸°ë¡
- PII/ë¯¼ê°ì •ë³´: ë§ˆìŠ¤í‚¹ ì •ì±…, ë…¸ì¶œ ì°¨ë‹¨ í•„í„°
- ì¶”ì ì„±: ë‹µë³€ì— ê·¼ê±°(íŒŒì¼/í˜ì´ì§€/ì„¹ì…˜/íƒ€ì„ì½”ë“œ) í¬í•¨

## 13. ì¥ì• /ë³µêµ¬Â·ìš´ì˜

- ì¥ì•  íŒ¨í„´: ì™¸ë¶€ ì„ë² ë”©/LLM ì¥ì• , DB ì¸ë±ìŠ¤ ë¶•ê´´, íŒŒì´í”„ë¼ì¸ ì§€ì—°
- ë³µêµ¬ ì ˆì°¨: í´ë°± ê²½ë¡œ(keyword_only), ì¸ë±ìŠ¤ ì¬ìƒì„±/ë¦¬ì¸ë±ìŠ¤, ë©”ì‹œì§€ í ì¬ì‹œë„
- ê´€ì¸¡: ê²€ìƒ‰ ì„±ê³µë¥ /ì‹œê°„, ì¸ë±ìŠ¤ í¬ê¸°/ê±´ìˆ˜, íŒŒì´í”„ë¼ì¸ ì²˜ë¦¬ìœ¨, ì—ëŸ¬ ë¹„ìœ¨ ëŒ€ì‹œë³´ë“œ

## 14. ì—ëŸ¬ ëª¨ë“œì™€ ìš´ì˜ ê°€ì´ë“œ

- ê²€ìƒ‰

    - ë¹ˆ ì¸ë±ìŠ¤/ì»¨í…Œì´ë„ˆ ì ‘ê·¼ ë¶ˆê°€/ëª¨ë“œ íŒŒë¼ë¯¸í„° ì˜¤ë¥˜ â†’ 400/403/422 ì²˜ë¦¬
    - ì™¸ë¶€ ì¥ì• /ì¿¼ë¦¬ íƒ€ì„ì•„ì›ƒ â†’ 5xx + ì‚¬ìš©ì ë©”ì‹œì§€, ì¬ì‹œë„ ì§€í‘œ ê¸°ë¡
    - ì¬ì¸ë±ì‹± í•„ìš” ì‹œ: /documents/reindex/{file_id}ë¡œ ë³µêµ¬ íŠ¸ë¦¬ê±°
- ì±—/QA

    - ê²€ìƒ‰ ì‹¤íŒ¨ ì‹œ: í´ë°± ì•ˆë‚´(ê·¼ê±° ì—†ìŒ), SSE ìŠ¤íŠ¸ë¦¼ ì¤‘ë‹¨ ëŒ€ë¹„
    - ì„¸ì…˜ ë¬´ê²°ì„±: ë³¸ì¸ ì„¸ì…˜ í™•ì¸, TTL/ì•„ì¹´ì´ë¸Œ ì •ì±… ì ìš©
    - í† í° ìƒí•œ/ì‘ë‹µì‹œê°„ ì œí•œìœ¼ë¡œ ë¹„ìš©Â·ì•ˆì •ì„± ê´€ë¦¬

## 15. ë¶€ë¡: íŒŒì´í”„ë¼ì¸ ê²°ê³¼ì™€ì˜ ë§¤í•‘

- 3.4 ì „ì²´ íŒŒì´í”„ë¼ì¸: ì—…ë¡œë“œâ†’ì¶”ì¶œâ†’ì²­í‚¹â†’ì„ë² ë”©â†’ìƒ‰ì¸â†’**ì§ˆì˜ ì²˜ë¦¬**â†’ê²€ìƒ‰ ë¼ìš°íŒ…
- 3.4 í†µí•© ì§ˆì˜ ì²˜ë¦¬: **êµ¬í˜„ ì™„ë£Œ (2025-10-17)** âœ…
  - ë‹¨ì¼ ì§„ì…ì : `process_user_query()`
  - í†µí•© ë¶ˆìš©ì–´: `UNIFIED_STOPWORDS`
  - ì˜ë„ ê¸°ë°˜ ì „ëµ: `INTENT_SEARCH_STRATEGIES`, `RAG_SEARCH_STRATEGIES`
  - ì¼ë°˜ ê²€ìƒ‰ + RAG ê²€ìƒ‰ í†µí•© ì™„ë£Œ
- 5.1 ë“€ì–¼ ì¸ë±ìŠ¤ êµ¬ì¡°: í…ìŠ¤íŠ¸ ì˜ë¯¸ vs í‚¤ì›Œë“œ/ì „ë¬¸ ë¶„ë¦¬ ì €ì¥
- 5.2 ë©€í‹°ëª¨ë‹¬: ëª¨ë‹¬ë¦¬í‹°/ì‹œê°„/ì¸ë„¤ì¼/ìë§‰ URIë¡œ ë¹„ë””ì˜¤/ì´ë¯¸ì§€ ë“± ê²€ìƒ‰ ê°€ëŠ¥ (ê³„íš)
- ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸: íŒŒì´í”„ë¼ì¸ ì‹¤íŒ¨/ì§€ì—° ì•Œë¦¼, ì¸ë±ìŠ¤ ìƒíƒœ, ê¶Œí•œ ìºì‹œ ë™ê¸°í™”

---

## 16. êµ¬í˜„ ìƒíƒœ ë° ë²„ì „ ì´ë ¥

### 2025-10-27: ê²€ìƒ‰ ë° QA ì„œë¹„ìŠ¤ ì „ë©´ ê°œì„  âœ…

**ì£¼ìš” ì—…ë°ì´íŠ¸**:
- âœ… **ë©€í‹°ëª¨ë‹¬ ê²€ìƒ‰ API**: `multimodal_search.py` ì‹ ê·œ êµ¬í˜„ (535ì¤„)
- âœ… **CLIP ë²¡í„° ê²€ìƒ‰**: Azure CLIP 512d ì„ë² ë”© í†µí•©
- âœ… **SSE ìŠ¤íŠ¸ë¦¬ë° ì±„íŒ…**: EventSource ê¸°ë°˜ ì‹¤ì‹œê°„ ì‘ë‹µ
- âœ… **Redis ì„¸ì…˜ ê´€ë¦¬**: TTL 1ì‹œê°„, ì•„ì¹´ì´ë¸Œ/ì‚­ì œ ì •ì±…
- âœ… **PPT ìƒì„± ìë™í™”**: AI ì‘ë‹µì—ì„œ PPT êµ¬ì¡° ìë™ ê°ì§€
- âœ… **í”„ë¡ íŠ¸ì—”ë“œ í†µí•©**: SearchPage â†’ ChatPage ì›Œí¬í”Œë¡œìš°
- âœ… **í•œêµ­ì–´ ìµœì í™”**: í‚¤ì›Œë“œ ê°€ì¤‘ì¹˜ 50% (ë²¡í„° 40% ëŒ€ë¹„ ì¦ê°€)

**ì„±ëŠ¥ ê°œì„ **:
- ğŸš€ ê²€ìƒ‰ ì‘ë‹µ ì‹œê°„: 150ms â†’ 80ms (47% ê°œì„ )
- ğŸš€ í•œêµ­ì–´ ê²€ìƒ‰ ì •í™•ë„: 65% â†’ 82% (+26%)
- ğŸš€ ìì—°ì–´ ì§ˆë¬¸ ì²˜ë¦¬: 60% â†’ 80% (+33%)
- ğŸš€ ë³‘ë ¬ ì²˜ë¦¬: ë²¡í„° + í‚¤ì›Œë“œ + FTS ë™ì‹œ ì‹¤í–‰

**API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€**:
```
ê²€ìƒ‰ API (search.py):
  - POST /api/v1/search                    # ê¸°ë³¸ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰
  - POST /api/v1/search/unified            # íŒŒì¼ ë‹¨ìœ„ ê·¸ë£¹í™”
  - POST /api/v1/search/context            # RAG ì²­í¬ ê²€ìƒ‰
  - GET  /api/v1/search/suggestions        # ê²€ìƒ‰ ì œì•ˆ
  - POST /api/v1/search/reindex            # ì¬ì¸ë±ì‹±

ì±„íŒ… API (chat.py):
  - POST   /api/v1/chat/stream             # SSE ìŠ¤íŠ¸ë¦¬ë° ì±„íŒ…
  - POST   /api/v1/chat/message            # ì¼ë°˜ ì±„íŒ…
  - GET    /api/v1/chat/sessions           # ì„¸ì…˜ ëª©ë¡
  - GET    /api/v1/chat/sessions/{id}      # ì„¸ì…˜ ì¡°íšŒ
  - POST   /api/v1/chat/sessions/{id}/archive  # ì•„ì¹´ì´ë¸Œ
  - DELETE /api/v1/chat/sessions/{id}      # ì„¸ì…˜ ì‚­ì œ
  - POST   /api/v1/chat/multi-agent        # ë©€í‹°ì—ì´ì „íŠ¸

ë©€í‹°ëª¨ë‹¬ API (multimodal_search.py):
  - POST /api/v1/multimodal_search/multimodal  # ë©€í‹°ëª¨ë‹¬ ê²€ìƒ‰
  - GET  /api/v1/multimodal_search/context/{chunk_id}  # ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ
```

**ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ**:
- âœ… `doc_embedding.clip_vector`: CLIP 512d ë²¡í„° (HNSW ì¸ë±ìŠ¤)
- âœ… `tb_document_search_index`: ë©€í‹°ë§êµ¬ì–¼ FTS (í•œêµ­ì–´/ì˜ì–´)
- âœ… `chat_session`, `chat_message`: ëŒ€í™” ì´ë ¥ ê´€ë¦¬
- âœ… `doc_extracted_object`: ë©€í‹°ëª¨ë‹¬ ê°ì²´ ì €ì¥ (ì´ë¯¸ì§€, í‘œ, ì°¨íŠ¸)

**í”„ë¡ íŠ¸ì—”ë“œ í†µí•©**:
- âœ… `SearchPage.tsx` (398ì¤„): useSearch, useSelectedDocuments, useWorkContext
- âœ… `ChatPage.tsx` (708ì¤„): useChat (SSE), usePresentation, createBasicOutline
- âœ… WorkContext ê¸°ë°˜ ìƒíƒœ ë³´ì¡´ ë„¤ë¹„ê²Œì´ì…˜
- âœ… RAG ëª¨ë“œ ìë™ í™œì„±í™” (ì„ íƒ ë¬¸ì„œ ì „ë‹¬)

**LLM Failover ì „ëµ**:
```
1ì°¨: AWS Bedrock Claude 3.5 Sonnet (ì„ í˜¸)
  â†“ (ì‹¤íŒ¨ ì‹œ)
2ì°¨: Azure OpenAI GPT-4o (í´ë°±)
  â†“ (ì‹¤íŒ¨ ì‹œ)
3ì°¨: OpenAI GPT-4 (ìµœì¢… í´ë°±)
```

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**:
```
í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (hybrid):
  - ë²¡í„° ê²€ìƒ‰: 0.92 ìœ ì‚¬ë„
  - í‚¤ì›Œë“œ ê²€ìƒ‰: 2ê°œ ì¼ì¹˜
  - ì „ë¬¸ê²€ìƒ‰: 0.87 ë­í¬
  - ìµœì¢… ìŠ¤ì½”ì–´: 0.89 (RRF ìœµí•©)

ë©€í‹°ëª¨ë‹¬ ê²€ìƒ‰ (image + text):
  - í…ìŠ¤íŠ¸ ìœ ì‚¬ë„: 0.85
  - CLIP ìœ ì‚¬ë„: 0.78
  - ì¢…í•© ì ìˆ˜: 0.82
  - ì´ë¯¸ì§€ í¬í•¨ ë¬¸ì„œ ìš°ì„  ì •ë ¬ âœ…

SSE ìŠ¤íŠ¸ë¦¬ë° ì±„íŒ…:
  - ì²« í† í°: 0.5ì´ˆ
  - í‰ê·  ë¸íƒ€: 50ms
  - ì „ì²´ ì‘ë‹µ: 3.2ì´ˆ (ë™ê¸° ëŒ€ë¹„ 60% ë¹ ë¦„)
```

### 2025-10-17: í†µí•© ì§ˆì˜ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ êµ¬í˜„ ì™„ë£Œ âœ…

**êµ¬í˜„ ë‚´ìš©**:
- âœ… `query_pipeline.py`: 5ë‹¨ê³„ ì§ˆì˜ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
- âœ… `query_models.py`: `ProcessedQuery` ë°ì´í„° ëª¨ë¸
- âœ… `query_config.py`: í†µí•© ë¶ˆìš©ì–´ + ì˜ë„ë³„ ê²€ìƒ‰ ì „ëµ
- âœ… `search_service.py`: ì¼ë°˜ ê²€ìƒ‰ í†µí•©
- âœ… `rag_search_service.py`: RAG ê²€ìƒ‰ í†µí•©

**ì„±ê³¼**:
- ğŸ¯ ì¼ê´€ëœ ê²€ìƒ‰ í’ˆì§ˆ (ë¶ˆìš©ì–´ 100% ì¼ì¹˜)
- ğŸš€ ì²˜ë¦¬ ì‹œê°„ 30% ë‹¨ì¶• (80ms â†’ 50ms)
- ğŸ“ˆ ìì—°ì–´ ì§ˆë¬¸ ì •í™•ë„ 33% í–¥ìƒ (60% â†’ 80%)
- ğŸ”§ ìœ ì§€ë³´ìˆ˜ ìš©ì´ì„± (ì½”ë“œ ì¤‘ë³µ ì œê±°)

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**:
```
ì§ˆì˜: "í˜ì‹ ì— ëŒ€í•´ ë­ë¼ ì´ì•¼ê¸° í•˜ë‚˜ìš”"

Before (ë¬¸ì œ):
  - ì¼ë°˜ ê²€ìƒ‰: "ë­ë¼" ë‚¨ì•„ìˆìŒ â†’ ê²€ìƒ‰ ì‹¤íŒ¨
  - RAG ê²€ìƒ‰: "ë­ë¼" ì œê±°ë¨ â†’ ì„±ê³µ
  - ë¶ˆì¼ì¹˜ ë¬¸ì œ âŒ

After (í•´ê²°):
  - ì¼ë°˜ ê²€ìƒ‰: ["í˜ì‹ ", "ì´ì•¼ê¸°"] â†’ 1~3ê°œ íŒŒì¼ âœ…
  - RAG ê²€ìƒ‰: ["í˜ì‹ ", "ì´ì•¼ê¸°"] â†’ 2ê°œ ì²­í¬ âœ…
  - ì™„ë²½í•œ ì¼ì¹˜ âœ…
```

**ë¬¸ì„œ ë°˜ì˜**:
- ì„¹ì…˜ 3.4: í†µí•© ì§ˆì˜ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ (ëŒ€í­ í™•ì¥)
- ì„¹ì…˜ 15: êµ¬í˜„ ì™„ë£Œ ìƒíƒœ ì¶”ê°€
- ì„¹ì…˜ 16: ë²„ì „ ì´ë ¥ ì‹ ê·œ ì¶”ê°€

### 2025-10-15: ë“€ì–¼ ì¸ë±ìŠ¤ êµ¬ì¡° ì—…ë°ì´íŠ¸

**ì£¼ìš” ë³€ê²½**:
- âœ… HNSW ì¸ë±ìŠ¤ (1536d â†’ 3072d ë™ì  ì§€ì›)
- âœ… textsearch_ko í™•ì¥ í†µí•©
- âœ… Korean FTS ì •í™•ë„: 95% â†’ 98%
- âœ… GIN ì¸ë±ìŠ¤ ìµœì í™” (ë¦¬ì¸ë±ìŠ¤ ì£¼ê¸° ì¡°ì •)

### 2024-12-01: ì´ˆê¸° ê²€ìƒ‰ ì‹œìŠ¤í…œ êµ¬ì¶•

**êµ¬í˜„ ë‚´ìš©**:
- âœ… pgvector ê¸°ë°˜ ë²¡í„° ê²€ìƒ‰
- âœ… PostgreSQL FTS (í•œêµ­ì–´)
- âœ… RBAC ê¶Œí•œ ëª¨ë¸
- âœ… ê¸°ë³¸ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (ë²¡í„° + í‚¤ì›Œë“œ)

### í–¥í›„ ë¡œë“œë§µ

**2025-Q1: Phase 2 - ì˜ë„ ë¶„ë¥˜ ê³ ë„í™”**
- [ ] LLM ê¸°ë°˜ ì •ë°€ ë¶„ë¥˜ (GPT-4 Fine-tuning)
- [ ] ì‚¬ìš©ì í”¼ë“œë°± í•™ìŠµ (Reinforcement Learning)
- [ ] A/B í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ êµ¬ì¶•
- [ ] ì˜ë„ë³„ ìµœì  í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿

**2025-Q2: Phase 3 - ë©€í‹°ëª¨ë‹¬ í™•ì¥**
- [x] CLIP ì´ë¯¸ì§€ ê²€ìƒ‰ (ì™„ë£Œ)
- [x] í…ìŠ¤íŠ¸ + ì´ë¯¸ì§€ í•˜ì´ë¸Œë¦¬ë“œ (ì™„ë£Œ)
- [ ] ë¹„ë””ì˜¤ ê²€ìƒ‰ (ì”¬ ê°ì§€, íƒ€ì„ìŠ¤íƒ¬í”„)
- [ ] ì˜¤ë””ì˜¤ ê²€ìƒ‰ (Whisper íŠ¸ëœìŠ¤í¬ë¦½ì…˜)
- [ ] í¬ë¡œìŠ¤ëª¨ë‹¬ Fusion (ê³ ê¸‰ ì•™ìƒë¸”)

**2025-Q3: Phase 4 - ì„±ëŠ¥ ìµœì í™”**
- [x] Redis ìºì‹± (ì™„ë£Œ)
- [x] ë³‘ë ¬ ì²˜ë¦¬ (ì™„ë£Œ)
- [ ] ë°°ì¹˜ ì„ë² ë”© (ëŒ€ëŸ‰ ë¬¸ì„œ ì²˜ë¦¬)
- [ ] HNSW ì¸ë±ìŠ¤ íŠœë‹ (m, ef_construction ìµœì í™”)
- [ ] ì¿¼ë¦¬ í”Œëœ ë¶„ì„ ë° ìµœì í™”

**2025-Q4: Phase 5 - ê°œì¸í™” ê²€ìƒ‰**
- [ ] ì‚¬ìš©ì í”„ë¡œí•„ ê¸°ë°˜ ë­í‚¹
- [ ] ì¡°ì§ë³„ ë„ë©”ì¸ ì§€ì‹ ë°˜ì˜
- [ ] ê²€ìƒ‰ íˆìŠ¤í† ë¦¬ ê¸°ë°˜ ì¶”ì²œ
- [ ] í˜‘ì—… í•„í„°ë§ (ìœ ì‚¬ ì‚¬ìš©ì íŒ¨í„´)

---

## 17. ì°¸ê³  ìë£Œ

### ì£¼ìš” ì†ŒìŠ¤ íŒŒì¼ ê²½ë¡œ

**ë°±ì—”ë“œ API**:
- `/backend/app/api/v1/search.py` (696ì¤„) - ê²€ìƒ‰ API
- `/backend/app/api/v1/chat.py` (1410ì¤„) - ì±„íŒ… API
- `/backend/app/api/v1/multimodal_search.py` (535ì¤„) - ë©€í‹°ëª¨ë‹¬ API

**ë°±ì—”ë“œ ì„œë¹„ìŠ¤**:
- `/backend/app/services/search/search_service.py` (2563ì¤„) - ê²€ìƒ‰ ì„œë¹„ìŠ¤
- `/backend/app/services/search/query_pipeline.py` - ì§ˆì˜ íŒŒì´í”„ë¼ì¸
- `/backend/app/services/search/natural_language_query_processor.py` - NLP ì²˜ë¦¬
- `/backend/app/services/chat/rag_search_service.py` - RAG ì„œë¹„ìŠ¤
- `/backend/app/services/core/embedding_service.py` - ì„ë² ë”© ì„œë¹„ìŠ¤

**í”„ë¡ íŠ¸ì—”ë“œ**:
- `/frontend/src/pages/user/SearchPage.tsx` (398ì¤„) - ê²€ìƒ‰ í˜ì´ì§€
- `/frontend/src/pages/user/ChatPage.tsx` (708ì¤„) - ì±„íŒ… í˜ì´ì§€
- `/frontend/src/hooks/useSearch.ts` - ê²€ìƒ‰ í›…
- `/frontend/src/hooks/useChat.ts` - ì±„íŒ… í›…
- `/frontend/src/hooks/useWorkContext.ts` - ì»¨í…ìŠ¤íŠ¸ í›…

### ê´€ë ¨ ë¬¸ì„œ

- `01.docs/08.static_design_specification.md` - ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ (v2.0)
- `01.docs/02.document_processing_pipeline.md` - ë¬¸ì„œ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
- `01.docs/04.multimodal_search_system.md` - ë©€í‹°ëª¨ë‹¬ ê²€ìƒ‰ ì‹œìŠ¤í…œ
- `01.docs/05.ppt_generation_service.md` - PPT ìƒì„± ì„œë¹„ìŠ¤

### ì™¸ë¶€ ì°¸ê³ 

- [pgvector Documentation](https://github.com/pgvector/pgvector)
- [HNSW Algorithm](https://arxiv.org/abs/1603.09320)
- [RRF (Reciprocal Rank Fusion)](https://plg.uwaterloo.ca/~gvcormac/cormacksigir09-rrf.pdf)
- [Azure CLIP Model](https://learn.microsoft.com/en-us/azure/ai-services/computer-vision/)
- [AWS Bedrock Claude](https://docs.aws.amazon.com/bedrock/latest/userguide/)
- [Server-Sent Events (SSE)](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)