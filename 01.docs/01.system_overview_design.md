# 01. ABEKM(AI Based Enterprise Knowledge Management) 시스템 개요 설계서

> 본 문서는 2025년 10월 현재 운영/구현된 기능 중심의 **실제 시스템 구조와 동작 현황**을 기술합니다.

---

## 목차 (TOC)

1. [프로젝트 개요](#1-프로젝트-개요)
2. [시스템 아키텍처](#2-시스템-아키텍처)
3. [주요 서브시스템 설계](#3-주요-서브시스템-설계)
4. [관리자 기능 설계](#4-관리자-기능-설계)
5. [기술 스택 및 플랫폼](#5-기술-스택-및-플랫폼)
6. [핵심 품질 지표(KPI)](#6-핵심-품질-지표kpi)
7. [프로젝트 문서 구조](#7-프로젝트-문서-구조)
8. [개정 이력](#8-개정-이력)

---

## 1. 프로젝트 개요

### 1.1 프로젝트 목적

**ABEKM (AI Based Enterprise Knowledge Management)**는 기업의 지식 자산을 통합 관리하고, AI 기반 검색 및 질의응답 시스템을 통해 임직원의 업무 효율성을 극대화하는 차세대 지식관리 플랫폼입니다.

**핵심 가치:**
- 📚 **통합 지식 관리**: 부서별로 분산된 문서를 중앙 집중식으로 관리
- 🔍 **지능형 검색**: RAG 기반 멀티모달 하이브리드 검색
- 🤖 **AI 지식 생성**: 멀티 에이전트 협업을 통한 자동 보고서/프레젠테이션 생성
- 🏢 **조직 기반 권한**: SAP 연동 계층적 권한 관리
- 📊 **실시간 분석**: 지식 활용도 및 검색 트렌드 모니터링

### 1.2 주요 기능

| 기능 영역        | 핵심 기능             | 주요 특징                              |
| ------------ | ----------------- | ---------------------------------- |
| **문서 관리**    | 다양한 형식 지원         | MS Office, PDF, 한글(HWP), 이미지 OCR   |
| **검색**       | 하이브리드 검색          | 벡터 검색(의미) + 전문 검색(키워드) 결합          |
| **질의응답**     | RAG 기반 AI 답변      | 멀티 LLM 프로바이더(Bedrock/Azure/OpenAI) |
| **음성 입력** 🆕 | **실시간 STT**       | **AWS Transcribe 한국어/영어 음성 인식**    |
| **지식 생성**    | 멀티 에이전트 시스템       | 자동 요약, 분석, PPT 생성                  |
| **파일 뷰어**    | LibreOffice 기반 변환 | Office/HWP → PDF 실시간 변환 및 웹 뷰어     |
| **권한 관리**    | SAP 연동 RBAC       | 조직도 기반 컨테이너별 접근 제어                 |
| **대용량 처리**   | 적응형 청킹            | 최대 100MB 파일 백그라운드 처리               |

---

## 2. 시스템 아키텍처

### 2.1 전체 시스템 구조

**ABEKM 시스템은 마이크로서비스 아키텍처**를 기반으로 다음과 같은 주요 레이어로 구성됩니다:

```
┌─────────────────────────────────────────────────────────────┐
│                    프론트엔드 레이어                           │
│  React + TypeScript │ 채팅 UI │ 검색 UI │ 관리자 대시보드       │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                    API 게이트웨이 레이어                        │
│           FastAPI REST API │ SSE 스트리밍 │ JWT 인증           │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                  비즈니스 로직 레이어 (서브시스템)                 │
├─────────────────────────────────────────────────────────────┤
│ 문서 처리 │ 벡터 검색 │ RAG 엔진 │ 멀티 에이전트 │ 권한 관리    │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                    데이터 레이어                              │
├──────────────────────┬──────────────────┬──────────────────┤
│ PostgreSQL + pgvector│  Redis (캐시)     │  Multi-Cloud 스토리지│
│ 문서/벡터/메타데이터      │  세션/임베딩 캐시   │  원본 문서 저장     │
└──────────────────────┴──────────────────┴──────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                  외부 서비스 레이어                            │
├──────────────────────┬──────────────────┬──────────────────┤
│ AWS Bedrock/OpenAI   │  SAP RFC         │  AWS Textract    │
│ LLM/임베딩 생성         │  조직 정보 연동    │  OCR 처리         │
└──────────────────────┴──────────────────┴──────────────────┘
```

### 2.6 멀티 프로바이더 AI 아키텍처 🆕

**ABEKM은 클라우드 중립적 AI 아키텍처**를 채택하여 LLM, 임베딩, 문서 처리 등 모든 AI 서비스를 프로바이더 독립적으로 운영합니다.

#### 2.6.1 Provider 기반 설계 원칙

**핵심 설계 철학:**
- ✅ **코드 수정 없음**: `.env` 설정만으로 프로바이더 전환
- ✅ **자동 Failover**: 프로바이더 장애 시 대체 서비스 자동 선택
- ✅ **비용 최적화**: 프로바이더별 가격 정책에 따라 유연한 선택
- ✅ **벤더 Lock-in 방지**: 단일 프로바이더 의존성 제거

#### 2.6.2 지원 AI 프로바이더

| Provider         | LLM                  | 텍스트 임베딩                        | 이미지 임베딩           | 문서 처리                 | 상태         |
| ---------------- | -------------------- | ------------------------------ | ----------------- | --------------------- | ---------- |
| **AWS Bedrock**  | Nova Pro, Claude 3.5 | Titan v2 (1024d)               | Marengo (512d)    | Textract              | ✅ 운영 중     |
| **Azure OpenAI** | GPT-4o, GPT-5-nano   | text-embedding-3-small (1536d) | Azure CLIP (512d) | Document Intelligence | ✅ 지원       |
| **OpenAI**       | GPT-4-turbo          | text-embedding-ada-002 (1536d) | -                 | -                     | ✅ Fallback |
| **Upstage**      | -                    | -                              | -                 | Document Parse        | ✅ 운영 중     |

#### 2.6.3 임베딩 프로바이더 아키텍처

**텍스트 임베딩** (문서 청킹, RAG 쿼리):

```
EmbeddingService
├── Provider 설정: DEFAULT_EMBEDDING_PROVIDER
├── Bedrock → amazon.titan-embed-text-v2:0 (1024d)
│   └── 저장: vs_doc_contents_chunks.aws_embedding_1024
├── Azure OpenAI → text-embedding-3-small (1536d)
│   └── 저장: vs_doc_contents_chunks.azure_embedding_1536
└── OpenAI → text-embedding-ada-002 (1536d)
    └── 저장: vs_doc_contents_chunks.azure_embedding_1536
```

**이미지 임베딩** (멀티모달 검색):

```
ImageEmbeddingService
├── Provider 설정: DEFAULT_EMBEDDING_PROVIDER
├── Bedrock → twelvelabs.marengo-embed-3-0-v1:0 (512d)
│   └── 저장: doc_embedding.aws_marengo_vector_512
├── Azure OpenAI → Azure CLIP (512d)
│   └── 저장: doc_embedding.azure_clip_vector
└── Local → Hugging Face CLIP (512d)
    └── 저장: doc_embedding.clip_vector
```

**벡터 저장 스키마**:
```sql
-- 텍스트 임베딩 (vs_doc_contents_chunks 테이블)
aws_embedding_1024      vector(1024)    -- Bedrock Titan
azure_embedding_1536    vector(1536)    -- Azure/OpenAI
chunk_embedding         vector          -- 레거시 폴백

-- 이미지 임베딩 (doc_embedding 테이블)
aws_marengo_vector_512  vector(512)     -- Bedrock Marengo
azure_clip_vector       vector(512)     -- Azure CLIP
clip_vector             vector(512)     -- 로컬 CLIP
```

#### 2.6.4 LLM 프로바이더 아키텍처

**RAG 답변 생성**:

```
AIService (LLM 추상화)
├── Provider 설정: DEFAULT_LLM_PROVIDER
├── Bedrock
│   ├── amazon.nova-pro-v1:0 (주력 모델)
│   └── anthropic.claude-3-5-sonnet (고품질 답변)
├── Azure OpenAI
│   ├── gpt-4o (주력 모델)
│   └── gpt-5-nano (경량 모델)
└── OpenAI
    └── gpt-4-turbo (Fallback)
```

**Failover 전략**:
```
1차: DEFAULT_LLM_PROVIDER (설정된 프로바이더)
  ↓ 실패 시
2차: 대체 프로바이더 (bedrock → azure_openai → openai)
  ↓ 실패 시
3차: 경량 모델 재시도
  ↓ 모두 실패 시
에러 응답: "일시적 오류 발생"
```

#### 2.6.5 문서 처리 프로바이더 아키텍처

**문서 파싱**:

```
DocumentProcessingService
├── Provider 설정: DOCUMENT_PROCESSING_PROVIDER
├── Upstage Document Parse (현재 운영 중) ✅
│   └── 한국어 우수, OCR 최적화
├── Azure Document Intelligence
│   └── 한국어 완벽 지원, 레이아웃 인식
├── AWS Textract
│   └── 영문 중심, 표/양식 추출 특화
└── Fallback: DOCUMENT_PROCESSING_FALLBACK
```

#### 2.6.6 프로바이더 전환 가이드

**1단계: .env 설정 변경**
```bash
# Bedrock 사용 (현재 운영)
DEFAULT_LLM_PROVIDER=bedrock
DEFAULT_EMBEDDING_PROVIDER=bedrock
BEDROCK_LLM_MODEL_ID=amazon.nova-pro-v1:0
BEDROCK_EMBEDDING_MODEL_ID=amazon.titan-embed-text-v2:0
BEDROCK_MULTIMODAL_EMBEDDING_MODEL_ID=twelvelabs.marengo-embed-3-0-v1:0

# Azure OpenAI로 전환

DEFAULT_LLM_PROVIDER=azure_openai
DEFAULT_EMBEDDING_PROVIDER=azure_openai
AZURE_OPENAI_LLM_DEPLOYMENT=gpt-4o
AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-3-small
AZURE_OPENAI_MULTIMODAL_EMBEDDING_DEPLOYMENT=openai-clip-image-text-embed-11
```

**2단계: 서비스 재시작**
```bash
docker-compose restart backend
```

**3단계: 자동 처리 사항**
- ✅ 임베딩 생성 시 올바른 모델 API 호출
- ✅ 벡터 저장 시 프로바이더별 컬럼 자동 선택
- ✅ 검색 시 프로바이더별 벡터 컬럼 자동 참조
- ✅ LLM 답변 생성 시 프로바이더 자동 선택

#### 2.6.7 비용 최적화 전략

**프로바이더별 비용 비교** (2025-11-18 기준):

| 서비스             | AWS Bedrock          | Azure OpenAI     | 절감률        |
| --------------- | -------------------- | ---------------- | ---------- |
| **텍스트 임베딩**     | $0.0001/1K tokens    | $0.001/1K tokens | **90% 절감** |
| **LLM (답변 생성)** | $0.80/$3.20 per MTok | $5/$15 per MTok  | **70% 절감** |
| **이미지 임베딩**     | Marengo 포함           | CLIP 별도 배포 필요    | 운영 비용 절감   |

**권장 설정** (비용 최적화):
- 대량 임베딩: Bedrock (Titan v2 1024d) ✅
- 고품질 답변: Bedrock (Claude 3.5 Sonnet) ✅
- Fallback: Azure OpenAI (가용성 보장)

### 2.7 멀티 클라우드 스토리지 아키텍처

**ABEKM은 유연한 스토리지 백엔드 전환을 지원**하여 클라우드 환경에 따라 최적의 스토리지를 선택할 수 있습니다.

#### 2.7.1 지원 스토리지 백엔드

| 백엔드                    | 제공자                 | 용도           | 설정 키         |
| ---------------------- | ------------------- | ------------ | ------------ |
| **Azure Blob Storage** | Microsoft Azure     | 프로덕션 환경 (기본) | `azure_blob` |
| **AWS S3**             | Amazon Web Services | AWS 네이티브 환경  | `s3`         |
| **Local File System**  | 서버 디스크              | 개발/테스트 환경    | `local`      |

#### 2.7.2 스토리지 추상화 계층

**FileStorageService**가 스토리지 백엔드 추상화를 담당하며, `.env` 설정만으로 전환 가능:

```python
class FileStorageService:
    def __init__(self):
        self.backend = settings.storage_backend  # 'azure_blob' | 's3' | 'local'
        if self.backend == 's3':
            self.s3 = S3Service()
        elif self.backend == 'azure_blob':
            self.azure_blob = AzureBlobService()
```

**핵심 설계 원칙:**
- ✅ **단일 인터페이스**: 동일한 API로 모든 백엔드 접근
- ✅ **런타임 전환**: 코드 수정 없이 환경 변수로 전환
- ✅ **자동 폴백**: 우선순위 기반 백엔드 선택
- ✅ **메타데이터 동기화**: DB에 경로 정보 일관성 유지

#### 2.7.3 Azure Blob Storage 구성 (프로덕션)

**컨테이너 구조:**
```
Azure Storage Account (blobstoragephs1)
├── wkms-raw/                    # 원본 파일
│   └── {container_id}/raw/{file_physical_name}
├── wkms-intermediate/           # 중간 산출물
│   └── {container_id}/pages/{file_id}/page_{num}.json
└── wkms-derived/                # 최종 산출물
    └── {container_id}/chunks/{file_id}/chunk_{id}.json
```

**주요 기능:**
- **SAS 토큰 생성**: 시간 제한 읽기 전용 URL 제공
- **자동 컨테이너 생성**: 존재하지 않을 경우 자동 생성
- **메타데이터 태깅**: Blob 속성으로 파일 정보 저장
- **다운로드 모드**:
  - `redirect`: 302 리다이렉트 (클라이언트 직접 다운로드, CORS 필요)
  - `proxy`: 서버 프록시 (CORS 불필요, 대역폭 소모)

**환경 설정:**
```bash
# .env 파일
STORAGE_BACKEND=azure_blob
AZURE_BLOB_ACCOUNT_NAME=blobstoragephs1
AZURE_BLOB_ACCOUNT_KEY=***
AZURE_BLOB_CONTAINER_RAW=wkms-raw
AZURE_BLOB_CONTAINER_INTERMEDIATE=wkms-intermediate
AZURE_BLOB_CONTAINER_DERIVED=wkms-derived
AZURE_BLOB_SAS_EXPIRY_SECONDS=3600
AZURE_BLOB_ENABLE_AUTO_CONTAINER=true
AZURE_BLOB_DOWNLOAD_MODE=proxy
```

#### 2.7.4 AWS S3 구성 (대안)

**버킷 + Prefix 구조:**
```
S3 Bucket (ABEKM-file-bucket-20250910)
├── {container_id}/raw/{file_physical_name}           # 원본
├── {container_id}/intermediate/pages/{file_id}/...   # 중간
└── {container_id}/derived/chunks/{file_id}/...       # 최종
```

**주요 기능:**
- **Presigned URL**: 시간 제한 다운로드 링크 생성
- **버전 관리**: S3 버저닝으로 파일 이력 추적
- **라이프사이클 정책**: 오래된 파일 자동 아카이브 (Glacier)
- **리전 복제**: 다중 리전 백업 지원

**환경 설정:**
```bash
# .env 파일
STORAGE_BACKEND=s3
AWS_S3_BUCKET=ABEKM-file-bucket-20250910
AWS_REGION=ap-northeast-2
AWS_ACCESS_KEY_ID=***
AWS_SECRET_ACCESS_KEY=***
S3_PRESIGN_EXPIRY_SECONDS=3600
```

#### 2.7.5 Local File System 구성 (개발)

**디렉토리 구조:**
```
uploads/
└── {container_id}/
    ├── {file_physical_name}           # 원본
    ├── pages/{file_id}/...            # 중간
    └── chunks/{file_id}/...           # 최종
```

**환경 설정:**
```bash
# .env 파일
STORAGE_BACKEND=local
UPLOAD_DIR=uploads
```

#### 2.7.6 스토리지 전환 가이드

**1단계: 백업 생성**
```bash
cp .env .env.backup_$(date +%Y%m%d)
```

**2단계: .env 수정**
```bash
# Azure → AWS S3
sed -i 's/^STORAGE_BACKEND=azure_blob/STORAGE_BACKEND=s3/' .env

# AWS S3 → Local

sed -i 's/^STORAGE_BACKEND=s3/STORAGE_BACKEND=local/' .env
```

**3단계: 서비스 재시작**
```bash
# Docker 환경
docker-compose restart backend

# 일반 환경

systemctl restart abekm-backend
```

**4단계: 검증**
```bash
# 헬스체크
curl http://localhost:8000/health | jq '.storage'

# 로그 확인

tail -f logs/app.log | grep -i "storage\|s3\|blob"
```

#### 2.7.7 하이브리드 구성 (고급)

**용도별 스토리지 분리 가능:**
- 원본 파일: Azure Blob (장기 보관)
- 중간 산출물: Local (임시 처리)
- 최종 벡터: PostgreSQL (고속 검색)

**구현 예시:**
```python
class HybridStorageService:
    def __init__(self):
        self.raw_storage = AzureBlobService()      # 원본
        self.temp_storage = LocalFileService()      # 임시
        self.vector_storage = PostgreSQLService()   # 벡터
```

### 2.2 핵심 아키텍처 원칙

| 원칙           | 설명              | 구현 방식                   |
| ------------ | --------------- | ----------------------- |
| **마이크로서비스**  | 기능별 독립적 확장      | Docker 컨테이너 기반 배포       |
| **비동기 처리**   | 대용량 작업 백그라운드 처리 | Celery + Redis 큐        |
| **멀티 프로바이더** | AI 서비스 유연성      | 환경변수 기반 동적 전환           |
| **캐시 우선**    | 성능 최적화          | Redis 다단계 캐싱            |
| **보안 강화**    | 계층적 접근 제어       | JWT + RBAC + 컨테이너 스코프   |
| **관측 가능성**   | 실시간 모니터링        | 구조화 로깅 + Prometheus 메트릭 |

### 2.3 데이터 흐름 개요

**문서 업로드 → 검색 → 질의응답 전체 플로우:**

1. **문서 업로드 단계**
   - 사용자 → 파일 업로드 → 형식 검증 → 스토리지 저장
   - 메타데이터 추출 → 텍스트 추출 (OCR/파싱)
   - 적응형 청킹 → 임베딩 생성 → pgvector 저장
   - 권한 설정 (컨테이너/사용자 매핑)
2. **검색 단계**
   - 사용자 질의 → 전처리 (키워드 추출, 의도 분류)
   - 병렬 검색: 벡터 검색 + 전문 검색
   - 하이브리드 스코어링 → 권한 필터링
   - 결과 반환 (문서 스니펫 + 메타데이터)
3. **질의응답 단계**
   - 사용자 질문 → RAG 파이프라인 실행
   - 컨텍스트 구성 (검색 결과 압축)
   - LLM 호출 (Bedrock/Azure/OpenAI)
   - 스트리밍 응답 + 출처 링크 제공

### 2.4 실제 구현된 API 엔드포인트 구조

**v1 API 통합 라우터** (리팩토링 완료):

| API 그룹     | 엔드포인트                           | 주요 기능                 | 태그              |
| ---------- | ------------------------------- | --------------------- | --------------- |
| **인증/사용자** | `/api/v1/auth/*`                | 로그인, 로그아웃, 토큰 갱신, /me | 🔐 Auth         |
|            | `/api/v1/users/*`               | 사용자 CRUD 관리           | 👥 Users        |
|            | `/api/v1/sap/*`                 | SAP HR 정보 연동          | 🏢 SAP          |
| **핵심 기능**  | `/api/v1/chat/*`                | AI 채팅 및 RAG 질의응답      | 💬 Chat         |
|            | `/api/v1/search/*`              | 하이브리드 검색              | 🔍 Search       |
|            | `/api/v1/search/multimodal`     | 멀티모달 검색 (텍스트+이미지)     | 🔍 Multimodal   |
|            | `/api/v1/presentation/*`        | PPT 자동 생성             | 📊 Presentation |
| **문서 관리**  | `/api/v1/documents/*`           | 문서 CRUD 및 업로드         | 📄 Documents    |
|            | `/api/files/*`                  | 파일 다운로드, 뷰어, 변환       | 📁 Files        |
| **권한 관리**  | `/api/v1/permissions/*`         | 권한 체크 및 부여            | 🔐 Permissions  |
|            | `/api/v1/permission-requests/*` | 권한 요청 워크플로우           | 📋 Requests     |
| **컨테이너**   | `/api/v1/containers/*`          | 컨테이너 관리               | 🗂️ Containers  |

**특수 엔드포인트:**
- `/health` - 헬스체크 및 현재 AI 설정 정보
- `/` - API 루트 정보 및 기능 목록

### 2.5 서비스 레이어 아키텍처 상세

**실제 구현된 서비스 구조** (백엔드 소스 기준):

```
app/services/
├── document/                    # 📄 문서 처리 서비스 (핵심)
│   ├── extraction/             # 텍스트 추출
│   │   ├── text_extractor_service.py
│   │   ├── office_converter_service.py (LibreOffice)
│   │   ├── hwp_converter_service.py (한글 전용)
│   │   └── azure_document_intelligence_service.py
│   ├── processing/             # 문서 전처리
│   │   ├── document_preprocessing_service.py
│   │   ├── document_processor_service.py
│   │   └── bibliography_service.py (학술 논문)
│   ├── storage/                # 저장 서비스
│   │   ├── file_storage_service.py
│   │   ├── vector_storage_service.py
│   │   ├── vector_embedding_service.py
│   │   └── search_index_store.py
│   ├── search/                 # 검색 서비스
│   │   └── multimodal_search_service.py
│   ├── vision/                 # 이미지 처리
│   │   └── image_embedding_service.py (CLIP)
│   ├── pipeline/               # 통합 파이프라인
│   │   ├── integrated_document_pipeline_service.py
│   │   └── integrated_content_service.py
│   └── chunking/               # 텍스트 청킹
│
├── chat/                        # 💬 채팅 및 RAG 서비스
│   ├── rag_search_service.py
│   ├── rag_response_service.py
│   ├── conversation_context_service.py
│   └── query_classification_service.py
│
├── multi_agent/                 # 🤖 멀티 에이전트
│   └── integrated_service.py
│
├── presentation/                # 📊 프레젠테이션 생성
│   ├── quick_ppt_generator_service.py
│   ├── templated_ppt_generator_service.py
│   ├── enhanced_ppt_generator_service.py
│   └── quick_html_presentation_service.py
│
├── search/                      # 🔍 검색 엔진
│   ├── search_service.py
│   └── search_service_v2.py
│
└── auth/                        # 🔐 인증 및 권한
    ├── auth_service.py
    ├── async_user_service.py
    ├── permission_service.py
    ├── permission_request_service.py
    ├── container_service.py
    └── notification_service.py
```

**서비스 레이어 설계 원칙:**
- **단일 책임**: 각 서비스는 명확한 책임 영역 보유
- **비동기 우선**: AsyncIO 기반 고성능 처리
- **의존성 주입**: FastAPI Depends를 통한 서비스 주입
- **계층 분리**: API → Service → Repository 패턴

---

## 3. 주요 서브시스템 설계

### 3.1 문서 수집 및 벡터화

**목적:** 다양한 형식의 문서를 수집하고, 검색 가능한 형태로 벡터화하여 저장합니다.

**핵심 기능:**
- **다양한 문서 형식 지원**: MS Office(DOC/XLS/PPT), PDF, 한글(HWP/HWPX), 이미지(OCR)
- **적응형 청킹 전략**: 파일 크기에 따라 최적 청킹 크기 자동 조정 (1000~5000 토큰)
- **멀티모달 임베딩**: 텍스트(1536d) + 이미지/텍스트 CLIP(512d)
- **중복 제거**: SHA-256 해시 기반 중복 문서 감지
- **대용량 처리**: 최대 100MB 파일, 20MB 이상 백그라운드 처리

**처리 파이프라인:**

| 단계        | 설명               | 기술 스택                             |
| --------- | ---------------- | --------------------------------- |
| 1. 업로드    | 파일 수신 및 검증       | FastAPI, Multipart Upload         |
| 2. 저장     | S3/Local 스토리지 저장 | boto3, 표준 키 스킴                    |
| 3. 텍스트 추출 | 문서 파싱 및 OCR      | LibreOffice, Textract, pdfplumber |
| 4. 청킹     | 적응형 텍스트 분할       | tiktoken 토큰화                      |
| 5. 임베딩    | 벡터 생성            | OpenAI/Bedrock/Azure              |
| 6. 인덱싱    | 벡터 DB 저장         | pgvector, PostgreSQL FTS          |
| 7. 메타데이터  | 권한/컨테이너 연계       | SQLAlchemy ORM                    |

**주요 설계 원칙:**
- **스트리밍 처리**: 메모리 효율을 위한 청크 단위 처리
- **동시성 제어**: 세마포어로 최대 8개 파일 동시 처리
- **오류 복구**: 실패 청크 자동 재시도 (최대 3회)
- **품질 관리**: 토큰 수/벡터 차원 표준화 검증

**성능 지표:**
- 일반 파일(<20MB): 평균 처리 시간 < 2분
- 대용량 파일(20~100MB): 평균 처리 시간 < 8분
- 임베딩 생성 속도: 배치 처리 시 초당 ~10개 청크

> 📄 **상세 설계**: [02.문서등록시스템](./02.document_ingestion_vectorstore.md) 참조

---

### 3.2 검색 및 질의응답 (RAG)

**목적:** 사용자 질의에 대해 관련 문서를 검색하고, AI 기반 답변을 생성합니다.

**핵심 기능:**
- **하이브리드 검색**: 벡터 유사도(의미) + 전문 검색(키워드) 결합
- **멀티모달 검색**: 텍스트/이미지/CLIP 크로스 모달 검색 지원
- **다국어 NLP 지원**: 한국어/영어 자연어 처리 파이프라인
- **RAG 파이프라인**: 검색 → 컨텍스트 구성 → LLM 생성 → 출처 제공
- **세션 관리**: Redis 기반 대화 이력 유지 (최근 3~5턴)
- **스트리밍 응답**: SSE를 통한 실시간 토큰 단위 응답

**자연어 처리 (NLP) 파이프라인:**

시스템은 **한국어와 영어**를 모두 지원하는 다국어 NLP 처리 체계를 구축하고 있습니다.

| 언어      | NLP 라이브러리 | 버전     | 주요 기능                 | 구현 위치                    |
| ------- | --------- | ------ | --------------------- | ------------------------ |
| **한국어** | kiwipiepy | 0.18.3 | 형태소 분석, 품사 태깅, 키워드 추출 | `korean_nlp_service.py`  |
| **영어**  | NLTK      | 3.8.1  | 토큰화, 불용어 제거, POS 태깅   | `english_nlp_service.py` |

**한국어 NLP 처리** (`kiwipiepy` 기반):
- **형태소 분석**: 고급 한국어 형태소 분석 (명사, 동사, 형용사 추출)
- **키워드 추출**: 명사(NNG, NNP) + 동사(VV) + 형용사(VA) 필터링
- **사용자 사전**: 도메인 특화 용어 (회사명, 고유명사) 지원
- **언어 감지**: 한국어 텍스트 자동 감지 및 분기 처리
- **임베딩 통합**: Azure OpenAI text-embedding-3-small과 연동

**영어 NLP 처리** (`NLTK` 기반):
- **토큰화**: 단어 단위 분리 (word_tokenize)
- **불용어 제거**: 영어 불용어 사전 기반 필터링 (stopwords)
- **품사 태깅**: POS 태깅으로 명사/동사/형용사 추출 (averaged_perceptron_tagger)
- **언어 감지**: 영어 텍스트 자동 감지
- **경량 처리**: 빠른 처리 속도 (한국어 대비 10배 이상 빠름)

**NLP 파이프라인 통합:**
```
사용자 쿼리 입력
    ↓
언어 자동 감지 (한국어 vs 영어)
    ↓
┌─────────────┬─────────────┐
│  한국어 경로    │   영어 경로    │
│  kiwipiepy   │    NLTK     │
│  형태소 분석    │  토큰화/POS  │
│  키워드 추출    │  키워드 추출   │
└─────────────┴─────────────┘
    ↓
임베딩 생성 (OpenAI/Bedrock)
    ↓
벡터 검색 + 키워드 검색 (하이브리드)
```

**NLP 관련 패키지** (`requirements.txt` 참조):
- `kiwipiepy>=0.18.3`: 한국어 형태소 분석기
- `nltk==3.8.1`: 영어 자연어 처리 라이브러리
- `konlpy==0.6.0`: 한국어 처리 보조 도구
- `kss==6.0.3`: 한국어 문장 분리기 (Korean Sentence Splitter)
- `JPype1==1.4.1`: konlpy JVM 연동

**검색 모드:**

| 모드        | 설명                     | 주요 사용 사례    | API 엔드포인트                   |
| --------- | ---------------------- | ----------- | --------------------------- |
| **키워드**   | 전문 검색 (PostgreSQL FTS) | 정확한 용어 매칭   | `/api/v1/search`            |
| **벡터**    | 코사인 유사도 검색             | 의미 기반 탐색    | `/api/v1/search`            |
| **하이브리드** | 벡터 + 키워드 점수 결합         | 일반 검색 (기본값) | `/api/v1/search`            |
| **멀티모달**  | 이미지/텍스트 크로스 검색         | 시각 자료 포함 문서 | `/api/v1/search/multimodal` |
| **CLIP**  | 이미지-텍스트 유사도            | 클립보드 이미지 검색 | `/api/v1/search/clip`       |

**멀티모달 검색 상세** (실제 구현):

**구현 서비스:**
- `MultimodalSearchService`: 멀티모달 통합 검색 로직
- `ImageEmbeddingService`: CLIP 기반 이미지 임베딩 (512차원)
- 별도 API 라우터: `multimodal_search.py`

**지원 기능:**
- 텍스트 쿼리로 이미지 검색 (Cross-modal)
- 이미지 업로드로 유사 이미지/문서 검색
- 클립보드 이미지 직접 검색
- 텍스트 + 이미지 하이브리드 검색

**기술 스택:**
- CLIP 모델: Azure OpenAI Multimodal Embedding (우선) → 로컬 CLIP 폴백
- 임베딩 차원: 512차원 (텍스트 1536/1024차원과 별도 저장)
- 저장소: `doc_extracted_object` 테이블에 이미지 임베딩 저장
| **하이브리드** | 벡터 + 키워드 점수 결합         | 일반 검색 (기본값) |
| **멀티모달**  | 이미지/텍스트 크로스 검색         | 시각 자료 포함 문서 |
| **CLIP**  | 이미지-텍스트 유사도            | 클립보드 이미지 검색 |

**RAG 처리 흐름:**

1. **질의 전처리**
   - 한국어 키워드 추출 (kiwipiepy)
   - 의도 분류 (검색/질의/요약)
   - 고유명사/회사명 인식
2. **후보 검색**
   - 하이브리드 검색 실행
   - 권한 필터링 (RBAC)
   - 상위 K개 문서 선택 (기본 20개)
3. **컨텍스트 구성**
   - 관련 문서 압축
   - 토큰 제한 내 최적화 (최대 8000 토큰)
   - 출처 메타데이터 포함
4. **답변 생성**
   - LLM 호출 (Bedrock/Azure/OpenAI)
   - 스트리밍 응답
   - 출처 링크 첨부

**성능 최적화:**
- **캐싱**: 최근 쿼리 임베딩 Redis 저장 (TTL 1시간)
- **리랭킹**: 검색 결과 재정렬로 정확도 향상
- **병렬 처리**: 벡터/키워드 검색 동시 실행

> 📄 **상세 설계**: [03.검색서비스](./03.search_and_qa_service.md) 참조

---

### 3.3 AI 지식 생성 (멀티 에이전트)

**목적:** RAG 기반 대화형 AI를 통해 요약, 분석, 프레젠테이션 자동 생성을 지원합니다.

**핵심 기능:**
- **멀티 에이전트 협업**: 분석 → 요약 → 발표자료 생성 체인
- **자동 PPT 생성**: 대화 기반 프레젠테이션 자동 생성
- **스트리밍 대화**: 실시간 토큰 단위 응답 전송
- **세션 기반 컨텍스트**: 대화 이력 유지 및 연속성 보장

**멀티 에이전트 역할:**

| 에이전트                     | 역할               | 출력물           |
| ------------------------ | ---------------- | ------------- |
| **Analyzer**             | 문서 분석 및 핵심 정보 추출 | 주요 개념, 키워드    |
| **Insight Extractor**    | 인사이트 도출          | 트렌드, 관계성      |
| **Summarizer**           | 요약 생성            | 핵심 요약문        |
| **Presentation Builder** | PPT 구조 생성        | 아웃라인, 슬라이드 구성 |
| **Finalizer**            | 최종 검토 및 보완       | 완성된 출력물       |

**PPT 자동 생성 워크플로우:**

1. **Outline 생성**: 사용자 요청 분석 → 슬라이드 구조 제안
2. **사용자 편집**: 아웃라인 수정 (선택 사항)
3. **슬라이드 생성**: 각 슬라이드 본문 작성
4. **템플릿 적용**: 디자인 템플릿 적용 (선택 사항)
5. **파일 저장**: PPTX 파일 생성 및 다운로드 제공

**지원 모드:**
- **Quick 모드**: 원클릭 빠른 생성 (템플릿 미적용)
- **Templated 모드**: 고품질 템플릿 기반 생성

**품질/안정성 메커니즘:**
- **Failover**: 1차 Bedrock 실패 시 OpenAI/Azure 순차 전환
- **Circuit Breaker**: 오류율 임계 초과 시 공급자 격리
- **토큰 가드**: 프롬프트/출력 길이 사전 제한
- **출처 관리**: 모든 답변에 문서 출처 포함

---

### 3.4 파일 뷰어 및 변환 (LibreOffice)

**목적:** 다양한 문서를 웹 브라우저에서 직접 열람할 수 있도록 PDF로 변환 및 뷰어 제공

**핵심 기능:**
- **실시간 문서 변환**: Office/HWP → PDF 헤드리스 변환
- **웹 뷰어 통합**: 브라우저 내장 PDF 뷰어 활용
- **권한 기반 접근**: 사용자 권한 검증 후 파일 서빙
- **캐싱 전략**: SHA-256 기반 중복 변환 방지

**지원 파일 형식:**

| 범주         | 형식                              | 변환 방식                  |
| ---------- | ------------------------------- | ---------------------- |
| **Office** | DOC, DOCX, XLS, XLSX, PPT, PPTX | LibreOffice → PDF      |
| **한글**     | HWP, HWPX                       | HWP → DOCX → PDF (2단계) |
| **PDF**    | PDF                             | 직접 서빙 (변환 불필요)         |
| **이미지**    | PNG, JPG, TIFF                  | OCR → PDF (선택적)        |

**변환 엔진 상세:**
- **LibreOffice 7.x**: 헤드리스 모드 서버 실행
- **한국어 폰트**: Nanum 폰트 자동 설치
- **변환 품질**: 600DPI 이미지 해상도, 벡터 그래픽 보존
- **타임아웃 관리**: 60초 변환 제한, 초과 시 에러 처리

**성능 최적화:**
- **캐싱**: 변환된 PDF를 로컬/S3에 캐시
- **비동기 처리**: 대용량 파일 백그라운드 변환
- **폰트 프리로딩**: 시스템 시작 시 한국어 폰트 미리 로드

**API 엔드포인트:**

| 엔드포인트                                   | 기능               | 인증 방식      |
| --------------------------------------- | ---------------- | ---------- |
| `/api/v1/files/{file_id}/viewer`        | 직접 PDF 뷰어        | JWT Bearer |
| `/api/v1/files/office-to-pdf/{file_id}` | Office→PDF 변환 뷰어 | Multi-auth |
| `/api/v1/files/{file_id}/convert`       | 범용 변환 API        | JWT Bearer |
| `/api/v1/files/{file_id}/download`      | 원본 파일 다운로드       | JWT Bearer |

**보안:**
- **토큰 인증**: JWT/쿠키/헤더 다중 인증 지원
- **권한 검증**: 컨테이너 기반 접근 제어
- **감사 로그**: 모든 문서 열람 이력 기록

---

### 3.5 컨테이너 및 권한 관리

**목적:** 조직 구조에 기반한 지식 컨테이너를 관리하고, 계층적 접근 권한을 제어합니다.

**핵심 기능:**
- **SAP 연동**: RFC 기반 조직도 실시간 동기화
- **계층적 권한**: 부모 컨테이너 권한 자동 상속
- **역할 기반 접근**: RBAC (역할 + 컨테이너 스코프)
- **권한 요청 워크플로우**: 사용자 요청 → 관리자 승인 프로세스

**컨테이너 구조 예시:**

```
기업 조직 (Root)
├── 경영지원본부
│   ├── 인사팀 (Container)
│   └── 재무팀 (Container)
├── 영업본부
│   ├── 국내영업팀
│   └── 해외영업팀
└── R&D센터
    ├── AI연구팀
    └── 제품개발팀
```

**권한 레벨:**

| 역할          | 권한 범위    | 주요 기능              |
| ----------- | -------- | ------------------ |
| **시스템 관리자** | 전체 시스템   | 모든 컨테이너 관리, 시스템 설정 |
| **지식 관리자**  | 담당 컨테이너  | 문서 품질 관리, 사용자 지원   |
| **부서 관리자**  | 소속 부서    | 부서 문서 관리, 권한 승인    |
| **일반 사용자**  | 할당된 컨테이너 | 문서 조회, 검색, 다운로드    |

**권한 처리 흐름:**

1. **권한 확인**: 사용자 요청 → 컨테이너 권한 조회 → 캐시 확인
2. **상속 처리**: 부모 컨테이너 권한 자동 상속
3. **필터링**: 검색/조회 시 권한 컨테이너만 결과 반환
4. **감사**: 모든 권한 변경 이력 기록

**성능 고려:**
- **권한 경로 캐시**: Redis에 사용자별 접근 가능 컨테이너 목록 캐시
- **변경 이벤트**: 권한 변경 시 관련 캐시 무효화
- **배치 조회**: 다중 컨테이너 권한 한 번에 조회

> 📄 **상세 설계**: [04.지식컨테이너관리](./04.knowledge_container_management.md) 참조

---

## 4. 관리자 기능 설계

### 4.1 관리자 유형 분류

| 관리자 유형         | 대상           | 주요 책임             | 접근 권한             |
| -------------- | ------------ | ----------------- | ----------------- |
| **🔧 시스템 관리자** | IT 부서, 인프라 팀 | 시스템 안정성, 성능, 유지보수 | 전체 시스템 설정, DB, 서버 |
| **📚 지식 관리자**  | 부서 지식 담당자    | 지식 품질, 콘텐츠 큐레이션   | 담당 컨테이너, 사용자 지원   |

### 4.2 시스템 관리자 전용 기능

| 기능 영역         | 주요 기능          | 설명                             |
| ------------- | -------------- | ------------------------------ |
| **시스템 모니터링**  | 실시간 성능 대시보드    | CPU/메모리/디스크 사용률, API 성능, DB 상태 |
| **데이터베이스 관리** | PostgreSQL 최적화 | 쿼리 성능, 인덱스 관리, 백업/복원           |
| **AI 서비스 관리** | 멀티 프로바이더 제어    | 모델 전환, 성능 비교, 비용 모니터링          |
| **벡터 스토어 관리** | 차원 표준화 관리      | 차원 호환성, 품질 모니터링                |
| **보안 및 감사**   | 접근 로그 분석       | 사용자 활동, 권한 변경 추적, 보안 스캔        |

### 4.3 지식 관리자 전용 기능

| 기능 영역        | 주요 기능      | 설명                            |
| ------------ | ---------- | ----------------------------- |
| **문서 품질 관리** | 품질 점수 대시보드 | 문서별 품질 지표, 중복 탐지, 벡터화 품질      |
| **컨테이너 관리**  | 지식 구조 운영   | 컨테이너 생성, 권한 매트릭스, 계층 구조 시각화   |
| **지식 활용 분석** | 활용도 통계     | 문서 조회수, 검색 트렌드, 부서별 활용 패턴     |
| **사용자 지원**   | 질문/피드백 관리  | FAQ 자동 생성, 교육 컨텐츠, QA 정확도 평가  |
| **검색 품질 관리** | 검색 정확도 개선  | 결과 품질 모니터링, 동의어 사전, 실패 케이스 분석 |

### 4.4 권한 매트릭스

| 기능 영역     | 시스템 관리자 | 지식 관리자    | 일반 사용자 |
| --------- | ------- | --------- | ------ |
| 시스템 모니터링  | ✅ 전체    | ❌         | ❌      |
| 데이터베이스 관리 | ✅ 전체    | ❌         | ❌      |
| AI 서비스 설정 | ✅ 전체    | 📊 조회만    | ❌      |
| 보안 설정     | ✅ 전체    | ❌         | ❌      |
| 지식 컨테이너   | ✅ 전체    | ✅ 담당 컨테이너 | 📖 조회만 |
| 문서 품질 관리  | 📊 조회만  | ✅ 담당 영역   | ❌      |
| 사용자 지원    | 📊 조회만  | ✅ 전체      | ❌      |
| 검색 품질     | 📊 조회만  | ✅ 담당 영역   | ❌      |

### 4.5 관리자 API 엔드포인트 요약

**시스템 관리자 API:**
- `/api/admin/system/monitoring/*` - 시스템 모니터링
- `/api/admin/system/database/*` - DB 관리
- `/api/admin/system/security/*` - 보안 감사
- `/api/admin/ai-services/*` - AI 서비스 관리

**지식 관리자 API:**
- `/api/knowledge-admin/quality/*` - 문서 품질
- `/api/knowledge-admin/containers/*` - 컨테이너 관리
- `/api/knowledge-admin/analytics/*` - 활용도 분석
- `/api/knowledge-admin/user-support/*` - 사용자 지원

---

## 5. 기술 스택 및 플랫폼

### 5.1 기술 스택 요약

#### 5.1.1 백엔드 기술

| 범주                  | 기술/라이브러리                 | 용도                | 비고             |
| ------------------- | ------------------------ | ----------------- | -------------- |
| **Web Framework**   | FastAPI                  | 비동기 REST API      | Pydantic 기반 검증 |
| **Data Access**     | SQLAlchemy (Async)       | ORM/세션 관리         | 연결 풀 최적화       |
| **Database**        | PostgreSQL 15 + pgvector | 문서/벡터 저장          | 1024차원 표준화     |
| **Cache/Session**   | Redis                    | 세션/임베딩 캐시         | TTL 기반 자동 정리   |
| **Document Viewer** | LibreOffice Headless     | Office/HWP→PDF    | 헤드리스 모드        |
| **NLP (한국어)**       | kiwipiepy 0.18.3         | 한국어 형태소 분석/키워드 추출 | 명사/동사/형용사 추출   |
| **NLP (영어)**        | NLTK 3.8.1               | 영어 토큰화/키워드 추출     | 불용어 제거, POS 태깅 |
| **Embedding**       | OpenAI/Bedrock/Azure     | 임베딩 생성            | 멀티 프로바이더       |
| **Multi-Agent**     | LangGraph 스타일            | 에이전트 오케스트레이션      | 커스텀 워크플로우      |
| **Auth**            | PyJWT                    | JWT 발급/검증         | 권한 스코프 포함      |
| **Background**      | Celery (선택)              | 비동기 작업            | 대용량 파일 처리      |
| **Monitoring**      | Prometheus Exporter      | 메트릭 수집            | 커스텀 지표         |

#### 5.1.2 프론트엔드 기술

| 범주                | 기술/라이브러리            | 용도       | 비고          |
| ----------------- | ------------------- | -------- | ----------- |
| **Framework**     | React + TypeScript  | SPA 구성   | SSE 스트리밍 처리 |
| **Styling**       | TailwindCSS         | UI 스타일   | 유틸리티 퍼스트    |
| **State**         | React Query/Context | 서버 상태/세션 | 채팅 세션 캐싱    |
| **Streaming**     | EventSource         | SSE 수신   | 토큰 단위 처리    |
| **Visualization** | Recharts (선택)       | 메트릭 시각화  | 관리자 대시보드    |

#### 5.1.3 AI 및 검색

| 범주                | 구성요소                        | 기능           | 비고          |
| ----------------- | --------------------------- | ------------ | ----------- |
| **RAG Retrieval** | Hybrid (벡터+키워드)             | 후보 집합 생성     | 가중치 조정 가능   |
| **Re-Ranking**    | Rule + Similarity           | 컨텍스트 최적화     | 토큰 제한 고려    |
| **Generation**    | Multi LLM Provider          | 답변 생성        | Failover 지원 |
| **Multi-Agent**   | Analyzer/Summarizer/Builder | 단계별 처리       | 이벤트 스트림     |
| **PPT 생성**        | Presentation Tool           | Outline→슬라이드 | 사용자 편집 지원   |

#### 5.1.4 운영 및 플랫폼

| 범주            | 도구               | 목적        | 비고         |
| ------------- | ---------------- | --------- | ---------- |
| **Container** | Docker/Compose   | 로컬/배포 패키징 | 환경 분리      |
| **Logging**   | 구조화 로그 (JSON)    | 추적/감사     | 컨텍스트 필드 포함 |
| **Alerting**  | Webhook/Slack    | 임계 경보     | 지표 기반      |
| **Security**  | RBAC + Audit Log | 권한/추적     | 컨테이너 스코프   |

#### 5.1.5 성능 튜닝 및 운영 설정

**데이터베이스 연결 풀 최적화** (실제 운영 설정):

| 설정 항목             | 기본값   | 운영 설정값   | 설명                 |
| ----------------- | ----- | -------- | ------------------ |
| **pool_size**     | 20    | **40**   | 기본 연결 풀 크기 (2배 증가) |
| **max_overflow**  | 30    | **60**   | 추가 연결 허용 (2배 증가)   |
| **pool_timeout**  | 30초   | **60초**  | 연결 대기 시간 (2배 증가)   |
| **pool_recycle**  | 300초  | 300초     | 연결 재활용 주기          |
| **pool_pre_ping** | False | **True** | 연결 유효성 사전 체크       |

**성능 튜닝 근거:**
- 대용량 파일 처리 시 동시 DB 연결 증가
- 멀티모달 파이프라인 병렬 처리 지원
- 높은 동시 사용자 트래픽 대응
- 연결 타임아웃 오류 최소화

**로깅 최적화:**
- SQLAlchemy 엔진 로그: WARNING 레벨로 제한
- 구조화된 JSON 로그 형식 지원
- 별도 SQL 쿼리 로그 파일 분리 (선택적)
- Rotating 파일 핸들러 (최대 파일 크기 제한)

**Redis 캐싱 전략:**
- 세션 데이터: TTL 1시간
- 임베딩 캐시: TTL 30분
- 검색 결과: TTL 15분
- 권한 캐시: 권한 변경 시 즉시 무효화

### 5.2 배포 및 운영 아키텍처

#### 5.2.1 컨테이너 기반 배포

**ABEKM은 Docker 컨테이너 기반 마이크로서비스 아키텍처를 채택**하여 개발 환경과 프로덕션 환경의 일관성을 보장합니다.

**주요 컨테이너 구성:**
- **backend**: FastAPI 애플리케이션 (LibreOffice, Alembic 포함)
- **postgres**: PostgreSQL 15 + pgvector 확장
- **redis**: 캐시 및 세션 관리
- **frontend**: React 애플리케이션
- **pgadmin** (선택): DB 관리 도구

#### 5.2.2 자동화된 데이터베이스 초기화

**2025.09.05 구현 완료:**
- ✅ 스마트 초기화: 기존 데이터 존재 시 건너뛰기
- ✅ 환경변수 기반: Docker/Kubernetes 환경 모두 지원
- ✅ Alembic 통합: 데이터베이스 스키마 자동 생성
- ✅ 의존성 관리: 헬스체크 기반 순차 시작
- ✅ 오류 복구: 초기화 실패 시 자동 재시도

**시작 프로세스:**
1. PostgreSQL + pgvector 컨테이너 시작
2. 자동 헬스체크 및 연결 대기
3. Alembic 마이그레이션 자동 실행
4. 조직구조 데이터 자동 생성
5. 사용자 계정 및 권한 자동 설정
6. FastAPI 서버 시작

#### 5.2.3 환경별 배포 지원

| 환경                | API URL                       | 배포 방식             | 초기화 방식         |
| ----------------- | ----------------------------- | ----------------- | -------------- |
| **로컬 개발**         | `http://localhost:8000`       | Docker Compose    | 자동 초기화         |
| **Kubernetes 내부** | `http://wkms-backend:8000`    | Service Discovery | Init Container |
| **프로덕션**          | `https://api.your-domain.com` | Ingress + TLS     | Job-based 초기화  |
| **EKS/AKS/GKE**   | LoadBalancer                  | 클라우드 네이티브         | Operator 기반    |

#### 5.2.4 클라우드 네이티브 특징

**완전 지원 기능:**
- ✅ **서비스 디스커버리**: DNS 기반 서비스 간 통신
- ✅ **자동 확장**: HPA(Horizontal Pod Autoscaler) 지원
- ✅ **영구 스토리지**: PVC 기반 데이터 지속성
- ✅ **보안**: RBAC, Network Policy, Secret 관리
- ✅ **모니터링**: Prometheus/Grafana 통합
- ✅ **자동 초기화**: Job/Init Container 패턴 지원

#### 5.2.5 모니터링 및 운영

**서비스 메트릭:**
- API 성능: 응답시간, 처리량, 오류율
- 데이터베이스: 쿼리 성능, 연결 수, 인덱스 효율성
- 벡터 검색: 검색 속도, 정확도, 인덱스 상태
- 리소스 사용률: CPU, 메모리, 디스크, 네트워크

**로그 관리:**
- 구조화된 로깅: JSON 형태 로그 출력
- 중앙화된 수집: ELK Stack 또는 CloudWatch
- 실시간 분석: 오류 패턴 및 성능 이슈 감지

**알림 체계:**
- Prometheus 기반 메트릭 수집 및 알림 규칙
- 다채널 알림: 이메일, Slack, 문자 메시지
- 에스컬레이션: 심각도에 따른 알림 확대

---

## 6. 핵심 품질 지표(KPI)

### 6.1 핵심 KPI 목록

| 영역      | KPI          | 정의                  | 목표값           | 수집 경로      |
| ------- | ------------ | ------------------- | ------------- | ---------- |
| **검색**  | 검색 응답시간 p95  | 질의→최초 결과 반환         | < 1.5초        | Prometheus |
| **검색**  | Recall@20    | 관련 문서 포함 비율         | ≥ 0.85        | 샘플 평가      |
| **RAG** | 컨텍스트 활용율     | 사용된 컨텍스트/후보 토큰      | ≥ 0.75        | 로그 파서      |
| **RAG** | 답변 신뢰도 점수    | 내부 룰/LLM 평가 결합      | ≥ 0.8         | 후처리 모듈     |
| **AI**  | 모델 Failover율 | 총 호출 대비 Failover 발생 | < 3%          | 호출 래퍼      |
| **AI**  | 토큰 비용 비중     | 모델별 비용 점유율          | 상위 1모델 60% 이하 | 비용 집계      |
| **파일**  | 대용량 처리 성공률   | >20MB 작업 성공/총 작업    | ≥ 0.98        | 태스크 로그     |
| **파일**  | 평균 처리 시간     | 업로드→인덱싱 완료          | < 8분 (>20MB)  | 태스크 메트릭    |
| **권한**  | 권한 적용 실패율    | 권한 체크 오류 비율         | 0%            | 접근 미들웨어    |
| **보안**  | 비정상 접근 탐지    | Rule 기반 이상 이벤트      | 실시간 알림        | 감사 로그      |
| **세션**  | SSE 끊김률      | 중도 종료 세션/전체         | < 5%          | 프론트 이벤트    |

### 6.2 모니터링 수집 구조

**데이터 흐름:**
```
로그 수집 → 파서(컨텍스트 필드 추가) → 메트릭 변환 → Prometheus → 경보 룰 → Slack/Webhook
```

### 6.3 품질 개선 루프

1. 지표 수집
2. 임계 초과 감지
3. 원인 분석 (로그/트레이스)
4. 설정/모델/인덱스 조정
5. 재측정
6. 변경 히스토리 저장

### 6.4 데이터 보존 정책

- **애플리케이션 로그**: 30일(핫) + 180일(아카이브)
- **검색/질의 로그 요약**: 영구(집계 형태)
- **원문 파일**: 정책/보안 규칙에 따라 별도 보존

---

## 7. 프로젝트 문서 구조

### 7.1 문서 구조 개요

```
01.docs/
├── 01.system_overview_design.md        # 📖 본 문서 (전체 시스템 개요)
│   ├── 프로젝트 개요 및 아키텍처
│   ├── 주요 서브시스템 설계
│   ├── 관리자 기능 설계
│   └── 기술 스택 및 플랫폼
│
├── 02.document_ingestion_vectorstore.md # 📋 문서등록 및 벡터스토어
│   ├── 대용량 파일 처리 시스템
│   ├── 한국어 문서 전처리 파이프라인
│   ├── 지식관리자 문서 품질 관리 기능
│   └── 학술논문 문서처리 파이프라인(통합) §16
│
├── 03.search_and_qa_service.md         # 🔍 검색 및 질의응답 서비스
│   ├── 하이브리드 검색 엔진
│   ├── 멀티 LLM RAG 파이프라인
│   └── 지식관리자 검색 품질 관리 기능
│
└── 04.knowledge_container_management.md # 🏢 지식 컨테이너 관리
    ├── SAP 조직도 연동 시스템
    ├── 계층적 권한 관리
    ├── 시스템관리자 컨테이너 시스템 관리
    └── 지식관리자 컨테이너 운영 기능
```

### 7.2 관리자 기능 문서 분산 전략

각 서브시스템 문서에는 해당 영역의 관리자 기능이 포함됩니다:

- **📋 문서등록**: 지식관리자(품질 관리), 시스템관리자(성능 모니터링)
- **🔍 검색/질의응답**: 지식관리자(검색 품질), 시스템관리자(AI 성능)
- **🏢 지식 컨테이너**: 지식관리자(컨테이너 운영), 시스템관리자(SAP 연동)

### 7.3 통합 관리자 대시보드

모든 관리자 기능은 역할별 통합 대시보드에서 접근 가능:
- `/admin/dashboard/system-admin/` - 시스템 관리자 전용
- `/admin/dashboard/knowledge-admin/` - 지식 관리자 전용

---

## 8. 개정 이력

| 버전      | 일자             | 변경 범위      | 주요 내용                  |
| ------- | -------------- | ---------- | ---------------------- |
| 1.0     | 2025-08-10     | 초기 AI 확장   | AI 지식생성 섹션 최초 통합       |
| 1.1     | 2025-08-17     | 로드맵 제거     | 마이그레이션/Phase/로드맵 삭제    |
| 1.2     | 2025-08-18     | 구조 재편      | 현재 구현 중심 재구성, KPI 추가   |
| 1.3     | 2025-08-18     | API 요약 개편  | 관리자 API 코드블록 → 표 변환    |
| 1.4     | 2025-09-05     | 배포 자동화 완성  | 완전 자동화된 배포 아키텍처 구현     |
| **2.0** | **2025-10-27** | **문서 재구성** | **코드 제거, 표/서술 중심 재정리** |

---

> 💡 **참고**: 이 문서는 ABEKM 전체 시스템의 개요를 제공합니다. 각 서브시스템의 구체적인 구현 사항은 해당 번호의 상세 문서에서 확인하실 수 있습니다.

---

*📅 최종 업데이트: 2025년 10월 27일*  
*📋 문서 버전: v2.0 (개요 문서 재구성)*  
*🔧 작성자: ABEKM 개발팀*
