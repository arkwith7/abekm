# 특허 문서 섹션 감지 품질 지표 (Patent Section Detection Quality Metrics)

**작성일:** 2025-12-24  
**목적:** 특허 문서 파이프라인의 섹션 감지 정확도 향상 및 국가별 차이 대응

---

## 1. 문제점 분석

### 1.1 현재 상황 (2025-12-24 테스트 결과)

**테스트 문서:** `1020230076057A.pdf` (한국 특허 공개공보)

**예상 섹션 (10개):**
- 발명의 명칭
- 기술분야
- 발명의 배경 (배경기술)
- 선행기술문헌
- 해결하려는 과제
- 과제의 해결 수단
- 발명의 효과
- 도면의 간단한 설명
- 발명을 실시하기 위한 구체적인 내용
- 청구범위 (청구항)

**실제 감지 결과:**
```
- 청구항: 2회 (중복)
- 과제의 해결 수단: 1회 ✅
- 발명의 효과: 1회 ✅
- 도면의 간단한 설명: 1회 ✅
- 발명을 실시하기 위한 구체적인 내용: 1회 ✅
- 도면: 6회 (반복)
```

**섹션 커버리지:** 4/10 = **40%** ❌

### 1.2 근본 원인

#### (1) 띄어쓰기 변형 미처리
```python
# 패턴: r"^\s*\[?\s*기술\s*분야\s*\]?"
# 실제 PDF: "기 술 분 야" (각 글자 사이 공백)
# 실제 PDF: "배 경 기 술" (각 글자 사이 공백)
```

한국 특허청 공보는 **각 글자 사이에 공백**을 넣는 경우가 많음:
- 정상: `기술분야`, `배경기술`
- 실제: `기 술 분 야`, `배 경 기 술`

#### (2) 청구항 중복 감지
- "청구범위" 섹션 헤더와 "청구항 1" 시작 부분을 각각 별도 섹션으로 인식
- 청구항 개별 파싱 로직이 실패 (`[PATENT-CLAIMS] 청구항 번호를 찾을 수 없음`)

#### (3) 도면 반복 감지
- 여러 페이지에 걸친 도면을 각각 별도 섹션으로 인식

---

## 2. 품질 지표 정의

### 2.1 핵심 지표 (KPI)

| 지표명 | 정의 | 목표 | 현재 |
|--------|------|------|------|
| **섹션 커버리지 (Section Coverage)** | 감지된 표준 섹션 수 / 전체 표준 섹션 수 | ≥ 90% | 40% |
| **청구항 파싱 성공률 (Claim Parsing Rate)** | 개별 항 분리 성공 / 전체 청구항 수 | ≥ 95% | 0% |
| **섹션 중복도 (Section Duplication)** | 중복 감지된 섹션 수 | = 0 | 8회 |
| **섹션 누락률 (Section Missing Rate)** | 누락된 필수 섹션 수 / 필수 섹션 수 | ≤ 10% | 60% |

### 2.2 보조 지표

- **섹션 순서 정확도:** 한국 특허청 표준 순서와의 일치도
- **섹션 경계 정확도:** 시작/종료 위치의 정확성
- **다국어 지원률:** 미국/유럽/일본/중국 특허 감지 성공률

---

## 3. 국가별 특허 문서 구조 차이

### 3.1 한국 (KIPO - 한국특허청)

**표준 순서:**
```
1. 발명의 명칭
2. 기술분야
3. 발명의 배경 (또는 "배경기술")
4. 선행기술문헌
5. 해결하려는 과제 (또는 "발명이 해결하고자 하는 과제")
6. 과제의 해결 수단
7. 발명의 효과
8. 도면의 간단한 설명
9. 발명을 실시하기 위한 구체적인 내용 (또는 "발명의 상세한 설명")
10. 청구범위 (청구항)
```

**특이사항:**
- ✅ 각 섹션 헤더가 대괄호 `[  ]` 또는 없이 표기
- ✅ **띄어쓰기 변형 다양:** `기술분야` vs `기 술 분 야`
- ✅ 번호 표기: `[0001]`, `[0003]` 등 문단 번호 사용
- ✅ 청구항 번호: `청구항 1`, `청구항 2` (독립항/종속항 구분)

### 3.2 미국 (USPTO - 미국특허청)

**표준 순서:**
```
1. Title of Invention
2. Abstract
3. Background of the Invention
   - Field of the Invention
   - Description of Related Art
4. Summary of the Invention
5. Brief Description of the Drawings
6. Detailed Description of the Preferred Embodiments
7. Claims
```

**특이사항:**
- 영문 표기, 섹션명 표준화
- Claims는 보통 문서 맨 끝
- 번호 체계: `[0001]`, `[0002]` 사용
- Dependent Claims는 "wherein", "according to claim" 키워드 사용

### 3.3 유럽 (EPO - 유럽특허청)

**표준 순서:**
```
1. Title
2. Technical Field
3. Background Art (Prior Art)
4. Disclosure of Invention
   - Technical Problem
   - Technical Solution
   - Advantageous Effects
5. Brief Description of Drawings
6. Description of Embodiments
7. Claims
```

**특이사항:**
- 다국어 지원 (영어, 독일어, 프랑스어)
- 구조가 매우 엄격하게 표준화
- Claims는 독립항(Independent Claims)과 종속항(Dependent Claims) 명확히 구분

### 3.4 일본 (JPO - 일본특허청)

**표준 순서:**
```
1. 発明の名称 (발명의 명칭)
2. 技術分野 (기술분야)
3. 背景技術 (배경기술)
4. 発明が解決しようとする課題 (해결하려는 과제)
5. 課題を解決するための手段 (과제 해결 수단)
6. 発明の効果 (발명의 효과)
7. 図面の簡単な説明 (도면 설명)
8. 発明を実施するための形態 (실시 형태)
9. 実施例 (실시예)
10. 産業上の利用可能性 (산업상 이용 가능성)
11. 符号の説明 (부호 설명)
12. 特許請求の範囲 (청구범위)
```

**특이사항:**
- 한자 + 히라가나 혼용
- 번호 체계: `【0001】`, `【0002】`
- 청구항 번호: `【請求項1】`, `【請求項2】`
- 한국과 구조 유사 (일본→한국 영향)

### 3.5 중국 (CNIPA - 중국국가지식산권국)

**표준 순서:**
```
1. 发明名称 (발명명칭)
2. 技术领域 (기술영역)
3. 背景技术 (배경기술)
4. 发明内容 (발명내용)
   - 要解决的技术问题 (해결할 기술 문제)
   - 技术方案 (기술 방안)
   - 有益效果 (유익한 효과)
5. 附图说明 (첨부도 설명)
6. 具体实施方式 (구체적 실시방식)
7. 权利要求书 (권리요구서 = 청구범위)
```

**특이사항:**
- 간체자 사용
- 번호 체계: `[0001]`, `[0002]`
- 섹션 순서가 한국/일본과 약간 다름
- Claims는 별도 문서 (权利要求书)

---

## 4. 개선 방안

### 4.1 단기 개선 (High Priority)

#### (1) 띄어쓰기 유연 패턴 추가
```python
# 현재
r"^\s*\[?\s*기술\s*분야\s*\]?"

# 개선
r"^\s*\[?\s*기\s*술\s*분\s*야\s*\]?"  # 각 글자 사이 \s* 추가
```

**구현 위치:** `patent_section_detector.py` Line 46-155

#### (2) 청구항 중복 제거 로직
- "청구범위" 헤더 감지 시 이후 "청구항 1" 시작까지를 하나의 섹션으로 처리
- `_parse_claims()` 메서드 강화

#### (3) 도면 섹션 통합
- 여러 페이지에 걸친 도면을 하나의 섹션으로 통합
- "도 1", "도 2", "도 3" 등을 subsection으로 처리

### 4.2 중기 개선 (Medium Priority)

#### (1) 품질 검증 파이프라인
```python
class PatentQualityValidator:
    """특허 문서 품질 검증"""
    
    def validate_section_coverage(
        self, 
        detected_sections: List[PatentSection],
        country: str = "KR"
    ) -> Dict:
        """
        섹션 커버리지 계산
        
        Returns:
            {
                "coverage_rate": 0.8,  # 80%
                "missing_sections": ["기술분야", "배경기술"],
                "duplicated_sections": ["청구항"],
                "quality_score": 75.0  # 0-100
            }
        """
```

#### (2) 섹션 경계 보정
- LLM 기반 섹션 경계 검증 (Claude/GPT)
- 잘못된 경계 자동 수정

#### (3) 국가별 패턴 분리
```python
class KoreanPatentDetector(PatentSectionDetector):
    """한국 특허 전용 감지기"""
    pass

class USPatentDetector(PatentSectionDetector):
    """미국 특허 전용 감지기"""
    pass
```

### 4.3 장기 개선 (Low Priority)

#### (1) ML 기반 섹션 감지
- 특허 문서 대량 학습 데이터셋 구축
- BERT/RoBERTa 기반 섹션 분류 모델
- 정규식 패턴과 ML 앙상블

#### (2) 다국어 지원 확대
- 일본 특허: JPO 패턴 추가
- 중국 특허: CNIPA 패턴 추가
- 유럽 특허: EPO 다국어 패턴 추가

#### (3) 실시간 품질 모니터링
- 프로덕션 환경에서 섹션 감지 품질 지표 수집
- Grafana/Prometheus 대시보드
- 품질 저하 시 알림

---

## 5. 테스트 체크리스트

### 5.1 필수 테스트 케이스

**한국 특허:**
- [ ] 띄어쓰기 있는 섹션 헤더 (`기 술 분 야`)
- [ ] 띄어쓰기 없는 섹션 헤더 (`기술분야`)
- [ ] 청구항 10개 이상 (독립항 1개, 종속항 9개)
- [ ] 도면 5개 이상
- [ ] 선행기술문헌 없는 경우

**미국 특허:**
- [ ] Abstract 존재
- [ ] Claims 20개 이상
- [ ] Multiple Dependent Claims
- [ ] Drawings with Figure Legends

**품질 지표 검증:**
- [ ] 섹션 커버리지 ≥ 90%
- [ ] 청구항 파싱 성공률 ≥ 95%
- [ ] 섹션 중복도 = 0
- [ ] 섹션 누락률 ≤ 10%

### 5.2 테스트 데이터셋

| 국가 | 문서 수 | 파일명 예시 | 특징 |
|------|---------|-------------|------|
| 한국 | 10 | `1020230076057A.pdf` | 공개공보, 띄어쓰기 변형 |
| 미국 | 10 | `US20230123456A1.pdf` | 영문, Claims 맨 뒤 |
| 유럽 | 5 | `EP1234567A1.pdf` | 다국어, 구조 엄격 |
| 일본 | 5 | `JP2023123456A.pdf` | 한자+가나, 번호 체계 다름 |
| 중국 | 5 | `CN112345678A.pdf` | 간체자, 순서 다름 |

---

## 6. 구현 우선순위

### Phase 1: 긴급 수정 (1일)
- [x] 문제 진단 및 품질 지표 정의
- [ ] 띄어쓰기 유연 패턴 추가
- [ ] 청구항 중복 제거
- [ ] 테스트 케이스 1개 통과 (한국 특허)

### Phase 2: 품질 향상 (3일)
- [ ] 품질 검증 파이프라인 구축
- [ ] 섹션 경계 보정 로직
- [ ] 테스트 케이스 5개 통과 (한국 특허)

### Phase 3: 다국어 지원 (1주)
- [ ] 미국 특허 패턴 추가
- [ ] 국가 자동 감지 로직
- [ ] 테스트 케이스 10개 통과 (한국+미국)

---

## 7. 관련 문서

- [12.agent_design_for_patent_analysis.md](./12.agent_design_for_patent_analysis.md) - 특허 도메인 종합 설계
- Section 9: 특허 문서 구조화 처리 파이프라인
- `backend/app/services/document/extraction/patent_section_detector.py`
- `backend/app/services/document/pipelines/patent_pipeline.py`

---

**작성자:** GitHub Copilot (Claude Sonnet 4.5)  
**검토자:** TBD  
**승인 상태:** Draft
