# 10.4 Directory Governance (에이전트 단위 응집 구조)

> 본 문서는 멀티에이전트 확장을 위한 코드 디렉토리 운영 원칙과 목표 구조(Feature Pack)를 정의합니다.

---

## 1. 문제 요약

- 에이전트 구현이 `backend/app/agents/` 아래에 혼재
- `backend/app/tools/`는 기능별 분리는 되어 있으나 “어떤 에이전트의 toolset인지”가 1:1로 드러나지 않음
- `backend/app/services/presentation/`는 규모가 크고 Presentation과 결합이 강하지만, 에이전트 경계가 문서/코드에 명확히 드러나지 않음

---

## 2. 목표 구조: Feature Pack = Agent Unit

에이전트는 하나의 디렉토리 안에 prompt/state/graph/toolkit/테스트가 함께 있어야 합니다.

권장 구조(제안):

```
backend/app/agents/
  core/                     # 공용 프레임워크
  features/
    search_rag/
      prompt.md
      state.py
      graph.py
      toolkit.py
      tests/

    prior_art/
      prompt.md
      state.py
      graph.py
      toolkit.py
      tests/

    presentation/
      prompt.md
      state.py
      graph.py
      toolkit.py
      tests/

    text_to_sql/
      prompt.md
      state.py
      graph.py
      toolkit.py
      sql/                   # guards/allowlist
      tests/

    deep_research/
      prompt.md
      state.py
      graph.py
      toolkit.py
      tests/

  legacy/                   # 기존 경로 호환(점진 제거)
```

---

## 3. Tools / Services 경계

- `tools/`는 공용 기능 구현(재사용 가능한 단일 기능) 중심
- 각 에이전트의 “주요 tool 조합”은 `agents/features/<agent>/toolkit.py`로 제공
- `services/presentation/`은 한 번에 이동하지 않고
  - 에이전트 진입점은 toolkit/tool로 집중
  - 서비스 내부는 파사드 경계로 정리

---

## 4. 마이그레이션 원칙

- 한 번에 대이동 금지: 호환 래퍼(legacy)로 점진 전환
- import 경로 변경은 문서/테스트와 함께 수행
- Supervisor는 AgentCatalog로만 worker discovery

---

## 5. 완료 기준(Phase 2)

- 최소 1개 에이전트(SearchRAG 또는 PriorArt 또는 Presentation)가 feature-pack 형태로 이행
- unit/functional 테스트 게이트 통과
- 10/11/21 문서의 디렉토리/진입점/권장 import 경로가 최신 상태
