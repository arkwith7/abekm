# 10.4 Directory Governance (에이전트 단위 응집 구조)

> 본 문서는 멀티에이전트 확장을 위한 코드 디렉토리 운영 원칙과 목표 구조(Feature Pack)를 정의합니다.

---

## 1. 문제 요약

- 에이전트 구현이 `backend/app/agents/` 아래에 혼재
- `backend/app/services/presentation/`는 규모가 크고 Presentation과 결합이 강하지만, 에이전트 경계가 문서/코드에 명확히 드러나지 않음

현재 상태(2026-01-03 기준):
- 과거의 중앙 집중 도구 디렉토리였던 `backend/app/tools/`는 제거되었고, 도구는 feature-pack 소유권 기준으로 이관되었습니다.
- 과거의 중앙 프롬프트 디렉토리였던 `backend/prompts/`는 제거되었고, 프롬프트는 feature-pack 내부 `prompts/`로 이관되었습니다.

---

## 2. 목표 구조: Feature Pack = Agent Unit

에이전트는 하나의 디렉토리 안에 prompt/state/graph/toolkit/테스트가 함께 있어야 합니다.

권장 구조(현재 기준, 요약):

```
backend/app/agents/
  core/                     # 공용 프레임워크
  features/
    search_rag/
      graph.py
      worker.py              # AgentCatalog discovery 대상
      prompt.md
      prompts/               # 에이전트 로컬 프롬프트
      tools/                 # search_rag 소유 도구

    presentation/
      graph.py
      worker.py              # AgentCatalog discovery 대상
      prompt.md
      prompts/
      tools/
      services/              # presentation feature-pack 내부 서비스

    patent/
      core/
      clients/
      tools/
      prior_art_agent/
        worker.py            # PriorArtAgent worker (Supervisor 라우팅)
        graph.py
        prompts/
        tools/

    deep_research/
      README.md

  legacy/                   # 기존 경로 호환(점진 제거)
```

---

## 3. Tools / Services 경계

- 공용 계약 타입은 `backend/app/core/contracts.py`를 단일 소스로 사용
- 도구 구현은 “소유 에이전트(feature-pack) 내부”에 두고, 필요 시 다른 feature-pack에서 import하여 재사용
- Presentation 관련 서비스는 `backend/app/agents/features/presentation/services/`로 feature-pack 내부화되어 경계를 명확히 유지

---

## 4. 마이그레이션 원칙

- 한 번에 대이동 금지: 호환 래퍼(legacy)로 점진 전환
- import 경로 변경은 문서/테스트와 함께 수행
- Supervisor는 AgentCatalog로만 worker discovery

---

## 5. 완료 기준(Phase 2)

- ✅ SearchRAG/Presentation/PriorArt가 feature-pack worker 엔트리포인트로 제공됨(`*/worker.py` + `get_worker_specs`)
- ✅ AgentCatalog가 `app.agents.features.<feature>.worker`를 스캔하여 워커를 discover 함
- ✅ 테스트 게이트 스크립트(`shell-script/test-backend-*.sh`)로 unit/functional/integration 실행 가능
