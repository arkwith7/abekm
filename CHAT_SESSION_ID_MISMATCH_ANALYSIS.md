# ì±„íŒ… ì„¸ì…˜ ID ë¶ˆì¼ì¹˜ ë¬¸ì œ ë¶„ì„

## ğŸ” ë°œê²¬ëœ ë¬¸ì œ

### 1. ë°ì´í„° ë¶ˆì¼ì¹˜

#### tb_chat_sessions (5ê°œ ì„¸ì…˜)
```
chat_1762491307850_6b0vzt66l - í† í”½ëª¨ë¸ë§ì´ë€ (1ê°œ ë©”ì‹œì§€ ì„ ì–¸)
chat_1762489901728_vo422kwt4 - íŠ¹í—ˆ ë¶„ì„... (2ê°œ ë©”ì‹œì§€ ì„ ì–¸)
chat_1762484043000_hpkvfjsl4 - Ambidextrous... (1ê°œ ë©”ì‹œì§€ ì„ ì–¸)
chat_1762402149525_fhiygilkn - ì²¨ë¶€ì˜ ë…¼ë¬¸... (1ê°œ ë©”ì‹œì§€ ì„ ì–¸)
chat_1762322972575_stm4lp5mk - Roadmapping... (6ê°œ ë©”ì‹œì§€ ì„ ì–¸)
```

#### tb_chat_history (47ê°œ ë©”ì‹œì§€, 43ê°œ ì„¸ì…˜)
```
search_20251107_140432 - Roadmap (1ê°œ ë©”ì‹œì§€)
search_20251107_140418 - Roadmap (2ê°œ ë©”ì‹œì§€)
search_20251107_135508 - í† í”½ëª¨ë¸ (1ê°œ ë©”ì‹œì§€)
search_20251107_135502 - í† í”½ëª¨ë¸ (1ê°œ ë©”ì‹œì§€)
search_20251107_133143 - (1ê°œ ë©”ì‹œì§€)
... ë“± 43ê°œ ì„¸ì…˜
```

**ì„¸ì…˜ ID ë¶ˆì¼ì¹˜**: `chat_*` vs `search_*`

### 2. ì‹œìŠ¤í…œ ë¶„ë¦¬

#### ì±„íŒ… ì‹œìŠ¤í…œ (chat_* ì„¸ì…˜)
- **ê²½ë¡œ**: ê²€ìƒ‰ â†’ "AI ì±„íŒ…ìœ¼ë¡œ ì´ë™" â†’ ChatPage
- **ì €ì¥ ìœ„ì¹˜**: 
  - âœ… Redis (ì„ì‹œ, TTL ìˆìŒ)
  - âœ… tb_chat_sessions (ë©”íƒ€ë°ì´í„°)
  - âŒ tb_chat_history (ìˆ˜ì • ì „ ëˆ„ë½, ìˆ˜ì • í›„ ì €ì¥ë¨)
- **ì„¸ì…˜ ìƒì„±**: `chat_{timestamp}_{random}`

#### ê²€ìƒ‰ ì‹œìŠ¤í…œ (search_* ì„¸ì…˜)
- **ê²½ë¡œ**: ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ì§ì ‘ "ë¹ ë¥¸ ë‹µë³€"
- **ì €ì¥ ìœ„ì¹˜**:
  - âŒ Redis (ì‚¬ìš© ì•ˆ í•¨)
  - âŒ tb_chat_sessions (ì €ì¥ ì•ˆ ë¨)
  - âœ… tb_chat_history (ì§ì ‘ ì €ì¥)
- **ì„¸ì…˜ ìƒì„±**: `search_{YYYYMMDD}_{HHMMSS}`

### 3. Redis ìƒíƒœ
```bash
$ docker exec -it abkms-redis redis-cli KEYS "chat:*"
(empty array)
```
- ëª¨ë“  ë©”ì‹œì§€ TTL ë§Œë£Œ
- ì±„íŒ… ì„¸ì…˜ ë°ì´í„° ì—†ìŒ

## ğŸ“Š ë°ì´í„° íë¦„ ë¹„êµ

### ì±„íŒ… ì‹œìŠ¤í…œ (ìˆ˜ì • ì „)
```
ì‚¬ìš©ì â†’ ChatPage â†’ sendStreamingMessage
  â†“
Redis ë©”ì‹œì§€ ì €ì¥ (chat_*)
  â†“
save_chat_session()
  â”œâ”€ tb_chat_sessions âœ… (ë©”íƒ€ë°ì´í„°)
  â””â”€ tb_chat_history âŒ (ëˆ„ë½!)
  â†“
Redis TTL ë§Œë£Œ
  â†“
ì„¸ì…˜ ë¡œë“œ â†’ ë©”ì‹œì§€ ì—†ìŒ â†’ ë¹ˆ í™”ë©´
```

### ì±„íŒ… ì‹œìŠ¤í…œ (ìˆ˜ì • í›„)
```
ì‚¬ìš©ì â†’ ChatPage â†’ sendStreamingMessage
  â†“
Redis ë©”ì‹œì§€ ì €ì¥ (chat_*)
  â†“
save_chat_session()
  â”œâ”€ tb_chat_sessions âœ… (ë©”íƒ€ë°ì´í„°)
  â””â”€ tb_chat_history âœ… (ë©”ì‹œì§€ ì €ì¥!)
  â†“
Redis TTL ë§Œë£Œ (ë¬´ê´€)
  â†“
ì„¸ì…˜ ë¡œë“œ â†’ PostgreSQL ì¡°íšŒ â†’ ë©”ì‹œì§€ ìˆìŒ âœ…
```

### ê²€ìƒ‰ ì‹œìŠ¤í…œ (ë³„ë„ ë™ì‘)
```
ì‚¬ìš©ì â†’ SearchPage â†’ ë¹ ë¥¸ ë‹µë³€
  â†“
ì§ì ‘ tb_chat_history ì €ì¥ (search_*)
  â†“
tb_chat_sessionsì™€ ë¬´ê´€
  â†“
ëŒ€ì‹œë³´ë“œì— í‘œì‹œ ì•ˆ ë¨
```

## ğŸ”§ í…ŒìŠ¤íŠ¸ ë°©ë²•

### ìˆ˜ì • ì‚¬í•­ ê²€ì¦

1. **ìƒˆ ì±„íŒ… ì„¸ì…˜ ìƒì„±**
```bash
# 1. í”„ë¡ íŠ¸ì—”ë“œì—ì„œ:
# - ê²€ìƒ‰ í˜ì´ì§€ì—ì„œ ë¬¸ì„œ ì„ íƒ
# - "AI ì±„íŒ…ìœ¼ë¡œ ì´ë™" í´ë¦­
# - ë©”ì‹œì§€ ì „ì†¡

# 2. ì„¸ì…˜ ID í™•ì¸ (ì˜ˆ: chat_1762500000000_abc123)
```

2. **PostgreSQL í™•ì¸**
```sql
-- ì„¸ì…˜ ë©”íƒ€ë°ì´í„°
SELECT * FROM tb_chat_sessions 
WHERE session_id = 'chat_ìƒˆì„¸ì…˜ID';

-- ì‹¤ì œ ë©”ì‹œì§€ (ìˆ˜ì • í›„ ì €ì¥ë˜ì–´ì•¼ í•¨!)
SELECT * FROM tb_chat_history 
WHERE session_id = 'chat_ìƒˆì„¸ì…˜ID';
```

3. **ì„¸ì…˜ ë¡œë“œ í…ŒìŠ¤íŠ¸**
```bash
# ëŒ€ì‹œë³´ë“œ â†’ "ìµœê·¼ AI ëŒ€í™”" â†’ ìƒˆ ì„¸ì…˜ í´ë¦­
# â†’ ë©”ì‹œì§€ê°€ í‘œì‹œë˜ì–´ì•¼ í•¨!
```

### ê¸°ëŒ€ ê²°ê³¼

#### ìˆ˜ì • ì „ (ê¸°ì¡´ ì„¸ì…˜)
```sql
SELECT s.session_id, s.message_count, COUNT(h.chat_id) as actual
FROM tb_chat_sessions s 
LEFT JOIN tb_chat_history h ON s.session_id = h.session_id
WHERE s.session_id = 'chat_1762322972575_stm4lp5mk'
GROUP BY s.session_id, s.message_count;

-- ê²°ê³¼:
session_id: chat_1762322972575_stm4lp5mk
message_count: 6
actual: 0  â† ë¶ˆì¼ì¹˜!
```

#### ìˆ˜ì • í›„ (ìƒˆ ì„¸ì…˜)
```sql
SELECT s.session_id, s.message_count, COUNT(h.chat_id) as actual
FROM tb_chat_sessions s 
LEFT JOIN tb_chat_history h ON s.session_id = h.session_id
WHERE s.session_id = 'chat_ìƒˆì„¸ì…˜ID'
GROUP BY s.session_id, s.message_count;

-- ê¸°ëŒ€ ê²°ê³¼:
session_id: chat_ìƒˆì„¸ì…˜ID
message_count: 2
actual: 2  â† ì¼ì¹˜! âœ…
```

## ğŸ¯ ê²°ë¡ 

### ë¬¸ì œ ìš”ì•½
1. **ê¸°ì¡´ ì±„íŒ… ì„¸ì…˜** (`chat_*`): ë©”ì‹œì§€ê°€ PostgreSQLì— ì €ì¥ ì•ˆ ë¨ (ìˆ˜ì • ì™„ë£Œ)
2. **ê²€ìƒ‰ ì„¸ì…˜** (`search_*`): ë³„ë„ ì‹œìŠ¤í…œìœ¼ë¡œ ë™ì‘, ëŒ€ì‹œë³´ë“œ ì—°ë™ ì•ˆ ë¨
3. **Redis TTL ë§Œë£Œ**: ëª¨ë“  ì„ì‹œ ë©”ì‹œì§€ ì‚­ì œë¨

### í•´ê²° ìƒíƒœ
- âœ… **ìˆ˜ì • ì™„ë£Œ**: ì´ì œë¶€í„° ìƒì„±ë˜ëŠ” ì±„íŒ… ì„¸ì…˜ì€ PostgreSQLì— ì˜êµ¬ ì €ì¥
- âŒ **ë³µêµ¬ ë¶ˆê°€**: ê¸°ì¡´ ì„¸ì…˜ (TTL ë§Œë£Œ) ë°ì´í„° ì†ì‹¤
- âš ï¸ **ì£¼ì˜**: ê²€ìƒ‰ ì‹œìŠ¤í…œê³¼ ì±„íŒ… ì‹œìŠ¤í…œì€ ë³„ë„ë¡œ ë™ì‘

### ë‹¤ìŒ ë‹¨ê³„
1. ìƒˆ ì±„íŒ… ì„¸ì…˜ ìƒì„± í…ŒìŠ¤íŠ¸
2. PostgreSQL ì €ì¥ í™•ì¸
3. ì„¸ì…˜ ë¡œë“œ í…ŒìŠ¤íŠ¸
4. (ì„ íƒ) ê²€ìƒ‰ ì‹œìŠ¤í…œê³¼ ì±„íŒ… ì‹œìŠ¤í…œ í†µí•© ê²€í† 

---
**ë¶„ì„ì¼**: 2025-11-07 14:40
**ìƒíƒœ**: ë¶„ì„ ì™„ë£Œ, ìˆ˜ì • ì ìš©ë¨
**í…ŒìŠ¤íŠ¸**: ìƒˆ ì„¸ì…˜ ìƒì„± í•„ìš”
