# ABEKM Backend - 환경 변수 템플릿
# 파일명: .env.example
# 용도: 개발자용 환경 변수 설정 예시 및 문서화

# ================================================================
# 🔧 사용 방법
# ================================================================
# 1. 이 파일을 복사하여 .env.development 또는 .env.production 생성
#    cp .env.example .env.development
#
# 2. 각 환경에 맞게 값을 수정
#    - 개발: .env.development (기본값 사용 가능)
#    - 운영: .env.production (모든 보안 관련 값 변경 필수)
#
# 3. Docker Compose 실행 시 환경 파일 지정
#    docker compose --env-file .env.development up
#
# ================================================================

# ================================================================
# 1. 데이터베이스 설정 (PostgreSQL)
# ================================================================
# 데이터베이스 연결 URL (우선순위 높음)
DATABASE_URL=postgresql+asyncpg://wkms:wkms123@postgres:5432/wkms

# 개별 데이터베이스 설정 (DATABASE_URL이 없을 때 사용)
POSTGRES_DB=wkms
POSTGRES_USER=wkms
POSTGRES_PASSWORD=wkms123
DB_HOST=postgres
DB_PORT=5432
DB_NAME=wkms
DB_USER=wkms
DB_PASSWORD=wkms123

# 커넥션 풀 설정 (고급)
DB_POOL_SIZE=40              # 커넥션 풀 크기
DB_MAX_OVERFLOW=60           # 풀 초과 허용 개수
DB_POOL_TIMEOUT=60           # 커넥션 대기 타임아웃 (초)
DB_POOL_RECYCLE=300          # 커넥션 재사용 주기 (초)
DB_POOL_PRE_PING=true        # 커넥션 사전 확인

# ================================================================
# 2. Redis 설정 (캐시 및 Celery 브로커)
# ================================================================
REDIS_URL=redis://redis:6379/0
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0

# ================================================================
# 3. JWT 및 보안 설정
# ================================================================
# ⚠️  운영 환경에서는 반드시 변경 필요 (최소 32자 이상 랜덤 문자열)
SECRET_KEY=your-super-secret-key-change-this-in-production
JWT_SECRET_KEY=your-jwt-secret-key-change-this-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30    # Access Token 만료 시간 (분)
REFRESH_TOKEN_EXPIRE_MINUTES=10080 # Refresh Token 만료 시간 (분, 7일)

# ================================================================
# 4. CORS 설정
# ================================================================
# JSON 배열 형식으로 작성 (띄어쓰기 없이)
CORS_ORIGINS=["http://localhost:3000","http://127.0.0.1:3000"]

# ================================================================
# 5. 환경 설정
# ================================================================
ENVIRONMENT=development          # development | production | staging
DEBUG=true                       # true | false
LOG_LEVEL=INFO                   # DEBUG | INFO | WARNING | ERROR | CRITICAL

# ================================================================
# 6. 파일 저장소 설정
# ================================================================
STORAGE_BACKEND=local            # local | s3 | azure_blob
FILE_UPLOAD_PATH=uploads
LOCAL_UPLOAD_DIR=/app/uploads
MAX_FILE_SIZE=104857600          # 100MB (바이트)

# ================================================================
# 7. AWS 설정 (S3 사용 시 필수)
# ================================================================
AWS_REGION=ap-northeast-2
# AWS_ACCESS_KEY_ID=your-access-key-id
# AWS_SECRET_ACCESS_KEY=your-secret-access-key
# AWS_S3_BUCKET=your-bucket-name

# ================================================================
# 8. Azure OpenAI 설정 (AI 기능 사용 시 필수)
# ================================================================
# Azure OpenAI 엔드포인트 및 API 키
# AZURE_OPENAI_ENDPOINT=https://your-resource-name.openai.azure.com/
# AZURE_OPENAI_API_KEY=your-azure-openai-api-key
AZURE_OPENAI_API_VERSION=2024-02-15-preview

# Azure OpenAI 배포 이름 (deployment name)
# AZURE_OPENAI_LLM_DEPLOYMENT=gpt-4o
# AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-3-small
# AZURE_OPENAI_MULTIMODAL_DEPLOYMENT=gpt-4o

# Vision 캡셔닝 활성화
AZURE_OPENAI_ENABLE_VISION_CAPTIONING=true

# ================================================================
# 9. Azure Document Intelligence 설정 (문서 처리)
# ================================================================
# Azure Document Intelligence API 설정
# AZURE_DOCUMENT_INTELLIGENCE_ENDPOINT=https://your-di-resource.cognitiveservices.azure.com/
# AZURE_DOCUMENT_INTELLIGENCE_API_KEY=your-di-api-key
AZURE_DOCUMENT_INTELLIGENCE_API_VERSION=2024-11-30
AZURE_DOCUMENT_INTELLIGENCE_DEFAULT_MODEL=prebuilt-read
AZURE_DOCUMENT_INTELLIGENCE_LAYOUT_MODEL=prebuilt-layout
AZURE_DOCUMENT_INTELLIGENCE_MAX_PAGES=150
AZURE_DOCUMENT_INTELLIGENCE_TIMEOUT_SECONDS=300

# 문서 처리 제공자 선택
DOCUMENT_PROCESSING_PROVIDER=azure_di  # azure_di | upstage | aws_textract
USE_AZURE_DOCUMENT_INTELLIGENCE_PDF=true

# Azure DI 성능 설정
DI_PARALLEL_ENABLED=false        # 페이지 그룹 병렬 처리 활성화
DI_PAGE_GROUP_SIZE=3             # 페이지 그룹 크기
DI_MAX_CONCURRENCY=3             # 동시 실행 그룹 수
DI_CACHE_ENABLED=false           # 임시 캐시 사용
DI_TWO_COLUMN_REORDER_ENABLED=true # 2열 레이아웃 재구성

# ================================================================
# 10. Azure Blob Storage 설정 (선택사항)
# ================================================================
# AZURE_BLOB_ACCOUNT_NAME=your-storage-account
# AZURE_BLOB_ACCOUNT_KEY=your-storage-account-key
# AZURE_BLOB_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=...
AZURE_BLOB_CONTAINER_RAW=wkms-raw
AZURE_BLOB_CONTAINER_INTERMEDIATE=wkms-intermediate
AZURE_BLOB_CONTAINER_DERIVED=wkms-derived
AZURE_BLOB_ENABLE_AUTO_CONTAINER=true
AZURE_BLOB_DOWNLOAD_MODE=proxy   # proxy | redirect

# ================================================================
# 11. Upstage Document Parse 설정 (Azure DI 대안)
# ================================================================
# UPSTAGE_API_KEY=your-upstage-api-key
UPSTAGE_API_ENDPOINT=https://api.upstage.ai/v1/document-digitization
UPSTAGE_MAX_PAGES=150
UPSTAGE_TIMEOUT_SECONDS=300
UPSTAGE_MODEL=document-parse
UPSTAGE_MERGE_MULTIPAGE_TABLES=true

# ================================================================
# 12. AWS Bedrock 설정 (LLM 대안)
# ================================================================
BEDROCK_LLM_MODEL_ID=anthropic.claude-3-haiku-20240307-v1:0
BEDROCK_TEXT_MODEL_ID=anthropic.claude-3-haiku-20240307-v1:0
BEDROCK_EMBEDDING_MODEL_ID=amazon.titan-embed-text-v2:0
BEDROCK_EMBEDDING_DIMENSION=1024
BEDROCK_MULTIMODAL_LLM_MODEL_ID=anthropic.claude-3-sonnet-20240229-v1:0
BEDROCK_MULTIMODAL_EMBEDDING_MODEL_ID=cohere.embed-v4:0

# ================================================================
# 13. OpenAI 설정 (선택사항)
# ================================================================
# OPENAI_API_KEY=your-openai-api-key
# OPENAI_LLM_MODEL=gpt-4o
OPENAI_EMBEDDING_MODEL=text-embedding-ada-002

# ================================================================
# 14. LLM 제공자 설정
# ================================================================
DEFAULT_LLM_PROVIDER=bedrock     # bedrock | azure_openai | openai
LLM_PROVIDERS=["bedrock","azure_openai","openai"]

# ================================================================
# 15. 벡터 검색 설정
# ================================================================
VECTOR_DIMENSION=1536
SIMILARITY_THRESHOLD=0.7
KOREAN_EMBEDDING_MODEL=jhgan/ko-sroberta-multitask

# ================================================================
# 16. RAG 검색 설정
# ================================================================
RAG_SIMILARITY_THRESHOLD=0.3
RAG_MAX_CHUNKS=30
RAG_USE_RERANKING=true
RAG_RERANKING_PROVIDER=azure_openai  # azure_openai | bedrock

# RAG 리랭킹 Azure OpenAI 설정 (선택사항)
# RAG_RERANKING_ENDPOINT=https://your-resource.openai.azure.com/
# RAG_RERANKING_API_KEY=your-api-key
# RAG_RERANKING_DEPLOYMENT=gpt-4o
# RAG_RERANKING_API_VERSION=2024-02-15-preview
RAG_RERANKING_TEMPERATURE=0.3
RAG_RERANKING_MAX_TOKENS=500

# ================================================================
# 17. 문서 처리 설정
# ================================================================
CHUNK_SIZE=1000                  # 청크 크기 (토큰)
CHUNK_OVERLAP=200                # 청크 오버랩 (토큰)
KOREAN_TOKENIZER_MODEL=cl100k_base
MAX_TOKENS=4096
TEMPERATURE=0.7
TOP_P=0.9

# ================================================================
# 18. 외부 검색 설정 (Web Search)
# ================================================================
WEB_SEARCH_ENABLED=true
WEB_SEARCH_PROVIDER=mock         # mock | serpapi | tavily | bing
# SERPAPI_API_KEY=your-serpapi-key
# TAVILY_API_KEY=your-tavily-key
# BING_SEARCH_API_KEY=your-bing-key
WEB_SEARCH_MAX_RESULTS=6
WEB_SEARCH_TIMEOUT_SECONDS=8
WEB_SEARCH_DUAL_LANGUAGE=true

# ================================================================
# 19. 특허 검색 설정 (Enterprise Intelligence)
# ================================================================
PATENT_SEARCH_ENABLED=true
# KIPRIS_API_KEY=your-kipris-api-key
KIPRIS_API_ENDPOINT=http://plus.kipris.or.kr/openapi/rest
SERPAPI_GOOGLE_PATENTS_ENABLED=true
USPTO_API_ENDPOINT=https://api.patentsview.org/patents
PATENT_SEARCH_MAX_RESULTS=20

# ================================================================
# 20. Office Generator Service 설정
# ================================================================
OFFICE_GENERATOR_URL=http://office-generator-service:3001
OFFICE_GENERATOR_TIMEOUT=60
PRESENTATION_OUTPUT_DIR=data/presentations

# ================================================================
# 21. 로깅 설정
# ================================================================
LOG_LEVEL=INFO                   # DEBUG | INFO | WARNING | ERROR
LOG_FORMAT=json                  # json | plain
LOG_DIR=logs
LOG_FILE_NAME=backend.log
SQL_QUERY_LOG_ENABLED=true
SQL_QUERY_LOG_FILE_NAME=sql.log
SQL_QUERY_LOG_LEVEL=INFO
SQLALCHEMY_ECHO=false
SQL_LOG_SLOW_THRESHOLD_MS=300    # 느린 쿼리 기준 (밀리초)
SQL_LOG_SAMPLE_RATE=0.0          # 0.0 ~ 1.0

# ================================================================
# 22. 음성 변환 설정 (선택사항)
# ================================================================
ENABLE_AUDIO_TRANSCRIPTION=false
AWS_TRANSCRIBE_LANGUAGE_CODE=ko-KR

# ================================================================
# 23. 하이브리드 검색 가중치
# ================================================================
HYBRID_SEARCH_WEIGHTS={"semantic":0.7,"keyword":0.3}

# ================================================================
# 📝 추가 참고 사항
# ================================================================
#
# 1. 필수 설정 항목 (AI 기능 사용 시)
#    - Azure OpenAI 사용: AZURE_OPENAI_ENDPOINT, AZURE_OPENAI_API_KEY
#    - AWS Bedrock 사용: AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY
#    - 문서 처리: AZURE_DOCUMENT_INTELLIGENCE_* 또는 UPSTAGE_API_KEY
#
# 2. 환경별 권장 설정
#    개발: DEBUG=true, LOG_LEVEL=INFO, ACCESS_TOKEN_EXPIRE_MINUTES=480
#    운영: DEBUG=false, LOG_LEVEL=WARNING, ACCESS_TOKEN_EXPIRE_MINUTES=30
#
# 3. 보안 강화
#    - SECRET_KEY, JWT_SECRET_KEY: 32자 이상 랜덤 문자열
#    - POSTGRES_PASSWORD: 강력한 비밀번호
#    - API 키: 환경 변수 또는 Secrets Manager 사용
#
# 4. 성능 최적화
#    - DB_POOL_SIZE: 동시 연결 수에 맞게 조정
#    - DI_PARALLEL_ENABLED: 대용량 문서 처리 시 활성화
#    - CHUNK_SIZE: 모델 최대 토큰에 맞게 조정
#
# ================================================================
