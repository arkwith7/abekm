# ì²­í‚¹ ê²°ê³¼ ë¶„ì„ ë„êµ¬

DBì— ì €ì¥ëœ ë¬¸ì„œì˜ ì²­í‚¹ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ê³  í’ˆì§ˆì„ í‰ê°€í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.

## ê¸°ëŠ¥

- âœ… ì²­í¬ í¬ê¸° ë¶„í¬ ë¶„ì„
- âœ… í† í° ìˆ˜ ì¶”ì • ë° í†µê³„
- âœ… ë©”íƒ€ë°ì´í„° ì»¤ë²„ë¦¬ì§€ í™•ì¸
- âœ… í’ˆì§ˆ ì ìˆ˜ ìë™ ì‚°ì¶œ (0-100ì )
- âœ… JSON/CSV í¬ë§·ìœ¼ë¡œ ê²°ê³¼ ì €ì¥
- âœ… ê°œë³„ ì²­í¬ ë‚´ìš© í™•ì¸

## ì‚¬ìš©ë²•

### 1. ê¸°ë³¸ ì‚¬ìš© (ìµœê·¼ 10ê°œ íŒŒì¼)

```bash
cd /home/admin/Dev/abekm/backend
python tests/analyze_chunking_results.py
```

### 2. ìµœê·¼ Nê°œ íŒŒì¼ ë¶„ì„

```bash
# ìµœê·¼ 5ê°œ íŒŒì¼ ë¶„ì„
python tests/analyze_chunking_results.py --recent 5

# ìµœê·¼ 20ê°œ íŒŒì¼ ë¶„ì„
python tests/analyze_chunking_results.py --recent 20
```

### 3. íŠ¹ì • íŒŒì¼ ìƒì„¸ ë¶„ì„

```bash
# íŒŒì¼ IDë¡œ ë¶„ì„ (ì²­í¬ ë‚´ìš© í¬í•¨)
python tests/analyze_chunking_results.py --file-id 123 --show-chunks

# íŒŒì¼ IDë¡œ ë¶„ì„ (ìš”ì•½ë§Œ)
python tests/analyze_chunking_results.py --file-id 123
```

### 4. íŠ¹ì • ì»¨í…Œì´ë„ˆì˜ ëª¨ë“  íŒŒì¼ ë¶„ì„

```bash
# ì»¨í…Œì´ë„ˆì˜ ëª¨ë“  íŒŒì¼ ë¶„ì„
python tests/analyze_chunking_results.py --container-id abc123

# ê²°ê³¼ë¥¼ CSVë¡œ ì €ì¥
python tests/analyze_chunking_results.py --container-id abc123 --export-csv
```

### 5. ê²°ê³¼ ì €ì¥

```bash
# JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥
python tests/analyze_chunking_results.py --recent 10 --export-json

# CSV í˜•ì‹ìœ¼ë¡œ ì €ì¥ (ì—‘ì…€ì—ì„œ ì—´ê¸° ì¢‹ìŒ)
python tests/analyze_chunking_results.py --recent 10 --export-csv

# ë‘˜ ë‹¤ ì €ì¥
python tests/analyze_chunking_results.py --recent 10 --export-json --export-csv
```

## ì¶œë ¥ ì˜ˆì‹œ

```
================================================================================
ğŸ“„ íŒŒì¼: ë©€í‹°ëª¨ë‹¬_RAG_ì‹œìŠ¤í…œ_ì„¤ê³„ì„œ.pdf
   ID: 123 | í¬ê¸°: 2,456,789 bytes
   ì—…ë¡œë“œ: 2025-11-18T10:30:45.123456
================================================================================

ğŸ“Š ì²­í‚¹ ê²°ê³¼ ìš”ì•½
   ì´ ì²­í¬ ìˆ˜: 42
   ì´ ë¬¸ì ìˆ˜: 125,432
   ì¶”ì • í† í°: 35,838
   í˜ì´ì§€ ë²”ìœ„: 15í˜ì´ì§€

ğŸ“ ì²­í¬ í¬ê¸° í†µê³„ (ë¬¸ì ìˆ˜)
   ìµœì†Œ: 456 | ìµœëŒ€: 5,234
   í‰ê· : 2,986 | ì¤‘ì•™ê°’: 2,845
   í‘œì¤€í¸ì°¨: 892

ğŸ¯ ì¶”ì • í† í° í†µê³„
   ìµœì†Œ: 130 | ìµœëŒ€: 1,495
   í‰ê· : 853 | ì¤‘ì•™ê°’: 813
   í‘œì¤€í¸ì°¨: 255

ğŸ“¦ í¬ê¸° ë¶„í¬
   ë§¤ìš° ì‘ìŒ (<200í† í°)        1 (  2.4%) â–ˆ
   ì‘ìŒ (200-500)              3 (  7.1%) â–ˆâ–ˆâ–ˆ
   ì¤‘ê°„ (500-2000)            28 ( 66.7%) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
   í¼ (2000-4000)              8 ( 19.0%) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
   ë§¤ìš° í¼ (4000+)             2 (  4.8%) â–ˆâ–ˆ

ğŸ·ï¸  ì²­í¬ íƒ€ì… ë¶„í¬
   content         35 ( 83.3%)
   section_header   5 ( 11.9%)
   title            2 (  4.8%)

ğŸ“ ë©”íƒ€ë°ì´í„° ì»¤ë²„ë¦¬ì§€
   í‚¤ì›Œë“œ: 38/42 (90.5%)
   ì—”í‹°í‹°: 32/42 (76.2%)

â­ í’ˆì§ˆ í‰ê°€
   ì ìˆ˜: 85/100
   ë“±ê¸‰: ì–‘í˜¸ (B)
   ê°œì„  ì‚¬í•­:
      - ê·¹ë‹¨ì  í¬ê¸° ì²­í¬ ë‹¤ìˆ˜ (7.2%)
```

## í’ˆì§ˆ í‰ê°€ ê¸°ì¤€

### ì ìˆ˜ êµ¬ì„± (100ì  ë§Œì )

1. **í¬ê¸° ê· í˜•ì„± (30ì )**
   - ì²­í¬ ê°„ í¬ê¸° í¸ì°¨ê°€ ì‘ì„ìˆ˜ë¡ ë†’ì€ ì ìˆ˜
   - ë³€ë™ê³„ìˆ˜(CV) 0.3 ë¯¸ë§Œ: 30ì 
   - CV 0.3-0.5: 20ì 
   - CV 0.5 ì´ìƒ: 10ì 

2. **ì ì ˆí•œ í¬ê¸° ë¹„ìœ¨ (30ì )**
   - ì¤‘ê°„/í¼ í¬ê¸° ì²­í¬ ë¹„ìœ¨
   - 80% ì´ìƒ: 30ì 
   - 60-80%: 20ì 
   - 60% ë¯¸ë§Œ: 10ì 

3. **ë©”íƒ€ë°ì´í„° í’ë¶€ë„ (25ì )**
   - í‚¤ì›Œë“œ/ì—”í‹°í‹° ì»¤ë²„ë¦¬ì§€
   - 70% ì´ìƒ: 25ì 
   - 40-70%: 15ì 
   - 40% ë¯¸ë§Œ: 5ì 

4. **ê·¹ë‹¨ì  í¬ê¸° ë¹„ìœ¨ (15ì )**
   - ë§¤ìš° ì‘ìŒ/ë§¤ìš° í¼ ì²­í¬ ë¹„ìœ¨
   - 10% ë¯¸ë§Œ: 15ì 
   - 10-20%: 10ì 
   - 20% ì´ìƒ: 5ì 

### ë“±ê¸‰ ì²´ê³„

- **A (90-100ì )**: ìš°ìˆ˜ - ìµœì í™”ëœ ì²­í‚¹
- **B (80-89ì )**: ì–‘í˜¸ - ì‹¤ìš©ì ì¸ ìˆ˜ì¤€
- **C (70-79ì )**: ë³´í†µ - ê¸°ë³¸ì ì¸ í’ˆì§ˆ
- **D (60-69ì )**: ë¯¸í¡ - ê°œì„  ê¶Œì¥
- **F (0-59ì )**: ê°œì„  í•„ìš” - ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”

## ì €ì¥ ìœ„ì¹˜

- JSON/CSV íŒŒì¼: `/home/admin/Dev/abekm/backend/tests/chunking_analysis/`

## í™œìš© ì‚¬ë¡€

### 1. ì²­í‚¹ ì „ëµ ë¹„êµ

```bash
# ì„¤ì • ë³€ê²½ ì „ ë¶„ì„
python tests/analyze_chunking_results.py --recent 20 --export-csv

# ì„¤ì • ë³€ê²½ (ì˜ˆ: target_tokens_per_chunk ì¡°ì •)
# ë¬¸ì„œ ì¬ì—…ë¡œë“œ

# ì„¤ì • ë³€ê²½ í›„ ë¶„ì„
python tests/analyze_chunking_results.py --recent 20 --export-csv

# ë‘ CSV íŒŒì¼ ë¹„êµ
```

### 2. ë¬¸ì œ ì²­í¬ ì‹ë³„

```bash
# í’ˆì§ˆ ì ìˆ˜ê°€ ë‚®ì€ íŒŒì¼ ì°¾ê¸°
python tests/analyze_chunking_results.py --recent 50 --export-csv

# CSV íŒŒì¼ì—ì„œ quality_score < 70ì¸ íŒŒì¼ í™•ì¸
# í•´ë‹¹ íŒŒì¼ë“¤ì„ --file-idë¡œ ìƒì„¸ ë¶„ì„
python tests/analyze_chunking_results.py --file-id 123 --show-chunks
```

### 3. ì»¨í…Œì´ë„ˆë³„ í’ˆì§ˆ ëª¨ë‹ˆí„°ë§

```bash
# íŠ¹ì • í”„ë¡œì íŠ¸/ë¶€ì„œì˜ ë¬¸ì„œ í’ˆì§ˆ í™•ì¸
python tests/analyze_chunking_results.py --container-id project_a --export-json

# ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì™€ ë¹„êµ
python tests/analyze_chunking_results.py --container-id project_b --export-json
```

## ì£¼ì˜ì‚¬í•­

1. **í† í° ì¶”ì • ì •í™•ë„**
   - í•œêµ­ì–´/ì˜ì–´ í˜¼í•© í…ìŠ¤íŠ¸ ê¸°ì¤€ 3.5ì â‰ˆ 1í† í°
   - ì‹¤ì œ í† í°ì€ tiktokenìœ¼ë¡œ ê³„ì‚°ëœ ê°’ê³¼ ì•½ê°„ ì°¨ì´ ìˆì„ ìˆ˜ ìˆìŒ

2. **DB ì ‘ê·¼ ê¶Œí•œ**
   - `.env` íŒŒì¼ì˜ `DATABASE_URL` ì„¤ì • í•„ìš”
   - ì½ê¸° ì „ìš© ì‘ì—…ì´ë¯€ë¡œ ë°ì´í„° ë³€ê²½ ì—†ìŒ

3. **ëŒ€ëŸ‰ ë¶„ì„ ì‹œ**
   - íŒŒì¼ ìˆ˜ê°€ ë§ìœ¼ë©´ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŒ
   - `--recent` ê°’ì„ ì ì ˆíˆ ì¡°ì •

## ë””ë²„ê·¸ ë¡œê·¸ì™€ í•¨ê»˜ ì‚¬ìš©

```bash
# 1. ì²­í‚¹ ë””ë²„ê·¸ ë¡œê·¸ í™œì„±í™” (.env)
echo "CHUNKING_DEBUG=true" >> .env

# 2. ë°±ì—”ë“œ ì¬ì‹œì‘
pkill -f uvicorn
uvicorn app.main:app --reload &

# 3. ë¬¸ì„œ ì—…ë¡œë“œ

# 4. ì‹¤ì‹œê°„ ì²­í‚¹ ê³¼ì • í™•ì¸
cat /home/admin/Dev/abekm/backend/logs/chunking/chunking_*.txt

# 5. DB ì €ì¥ëœ ìµœì¢… ê²°ê³¼ ë¶„ì„
python tests/analyze_chunking_results.py --recent 1 --show-chunks

# 6. ë‘ ê²°ê³¼ ë¹„êµí•˜ì—¬ íŒŒì´í”„ë¼ì¸ ê²€ì¦
```

ì´ë ‡ê²Œ í•˜ë©´ ì²­í‚¹ ì•Œê³ ë¦¬ì¦˜ì˜ ë™ì‘ ê³¼ì •(ë¡œê·¸)ê³¼ ìµœì¢… ê²°ê³¼(DB)ë¥¼ ëª¨ë‘ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
