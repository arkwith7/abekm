# AKS 전용 설정
apiVersion: v1
kind: ConfigMap
metadata:
  name: wkms-config-aks
  namespace: wkms
data:
  # AKS 최적화 설정
  DATABASE_URL: "postgresql+asyncpg://wkms:wkms123@wkms-postgres:5432/wkms"
  REDIS_URL: "redis://wkms-redis:6379"
  CORS_ORIGINS: '["https://your-domain.com","https://api.your-domain.com"]'
  ENVIRONMENT: "production"
  JWT_SECRET_KEY: "CHANGE_ME_SUPER_SECURE_JWT_SECRET_KEY" 
  SECRET_KEY: "CHANGE_ME_VERY_SECURE_SECRET_KEY"
  LLM_PROVIDERS: '["azure_openai", "bedrock", "openai"]'
  DEFAULT_LLM_PROVIDER: "azure_openai"  # Azure에서는 Azure OpenAI 우선
  DEFAULT_EMBEDDING_PROVIDER: "azure_openai"
  BEDROCK_LLM_MODEL_ID: "anthropic.claude-3-haiku-20240307-v1:0"
  BEDROCK_EMBEDDING_MODEL_ID: "amazon.titan-embed-text-v2:0"
  # Azure 특화 설정
  AZURE_REGION: "East US"  # 필요시 변경
  # 프론트엔드용 설정
  REACT_APP_API_URL: "https://api.your-domain.com"
  REACT_APP_ENV: "production"
  REACT_APP_BACKEND_SERVICE_NAME: "wkms-backend"
  REACT_APP_BACKEND_PORT: "8000"
---
# AKS 전용 스토리지 클래스 (managed-csi 사용)
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: wkms-managed-csi
provisioner: disk.csi.azure.com
parameters:
  storageaccounttype: Premium_LRS
  kind: Managed
reclaimPolicy: Retain
volumeBindingMode: WaitForFirstConsumer
allowVolumeExpansion: true
---
# AKS Application Gateway Ingress (선택사항)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: wkms-ingress-agic
  namespace: wkms
  annotations:
    kubernetes.io/ingress.class: azure/application-gateway
    appgw.ingress.kubernetes.io/ssl-redirect: "true"
    appgw.ingress.kubernetes.io/backend-protocol: "http"
    appgw.ingress.kubernetes.io/request-timeout: "30"
spec:
  ingressClassName: azure-application-gateway
  tls:
  - hosts:
    - your-domain.com
    - api.your-domain.com
    secretName: wkms-tls
  rules:
  - host: your-domain.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: wkms-frontend
            port:
              number: 80
  - host: api.your-domain.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: wkms-backend
            port:
              number: 8000