# π“¤ λ°±μ—”λ“ API λ¬Έμ„μ²λ¦¬ νμ΄ν”„λΌμΈ ν…μ¤νΈ λ…ΈνΈλ¶ μ—…λ°μ΄νΈ μ™„λ£

## π― μ—…λ°μ΄νΈ κ°μ”

`/home/admin/wkms-aws/jupyter_notebook/opensource_pipeline_test.ipynb` νμΌμ„ **λ°±μ—”λ“ API `/api/v1/documents/upload` μ—”λ“ν¬μΈνΈμ μ „μ²΄ λ¬Έμ„μ²λ¦¬ νμ΄ν”„λΌμΈ**κ³Ό μ™„μ „ν μ—°λ™λλ„λ΅ μ—…λ°μ΄νΈν–μµλ‹λ‹¤.

## π”„ λ°±μ—”λ“ API λ¬Έμ„μ²λ¦¬ νμ΄ν”„λΌμΈ μ „μ²΄ κµ¬μ΅°

### `/api/v1/documents/upload` μ—”λ“ν¬μΈνΈ μ²λ¦¬ κ³Όμ •:
```
1. π” μ»¨ν…μ΄λ„ κ¶ν• κ²€μ¦ β† permission_service.check_upload_permission()
2. π“‹ νμΌ μ ν¨μ„± κ²€μ‚¬ (ν•μ‹, ν¬κΈ°) β† documents.py _validate_upload_file()
3. π’Ύ μ„λ²„ νμΌ μ‹μ¤ν…μ— μ €μ¥ β† document_service.create_document_from_upload()
4. π“ λ°μ΄ν„°λ² μ΄μ¤μ— λ©”νƒ€λ°μ΄ν„° μ €μ¥ β† tb_file_bss_info, tb_file_dtl_info
5. π― RAGμ© λ²΅ν„° μ €μ¥ νμ΄ν”„λΌμΈ β† IntegratedDocumentPipelineService
   - ν…μ¤νΈ μ¶”μ¶ λ° OCR μ²λ¦¬
   - ν•κµ­μ–΄ NLP λ¶„μ„ (kiwipiepy)
   - μ„λ² λ”© μƒμ„± (AWS Bedrock Titan V2)
   - λ²΅ν„° μ €μ¥ (PostgreSQL + pgvector)
```

## π“‹ μ—…λ°μ΄νΈλ λ…ΈνΈλ¶ κµ¬μ΅° (18κ° μ…€)

### 1. **π”„ κ°μ” μ—…λ°μ΄νΈ** (Markdown)
- λ°±μ—”λ“ APIμ™€ μ—°λ™λλ” μ „μ²΄ λ¬Έμ„μ²λ¦¬ νμ΄ν”„λΌμΈ μ„¤λ…
- κ° κµ¬μ„±μ”μ†λ³„ λ‹¨μ„ ν…μ¤νΈ κ°λ… μ†κ°
- Production vs Fallback λ¨λ“ μ§€μ›

### 2. **ν™κ²½ μ„¤μ •** (Python) - κΈ°μ΅΄ μ μ§€
- κΈ°λ³Έ OCR λΌμ΄λΈλ¬λ¦¬ μλ™ μ„¤μΉ
- kiwipiepy, scikit-learn, nltk λ“± μ„¤μ •

### 3. **π― λ°±μ—”λ“ ν†µν•© ν™κ²½** (Python) - κΈ°μ΅΄ μ μ§€
- backend/.env μ„¤μ • μλ™ λ΅λ“
- AWS Bedrock, Korean NLP, PostgreSQL μ„λΉ„μ¤ μ„ν¬νΈ

### 4. **π“‹ NEW: λ°±μ—”λ“ νμΌ κ²€μ¦ μ‹μ¤ν… ν…μ¤νΈ** (Python)
```python
# /api/v1/documents/uploadμ _validate_upload_file() λ΅μ§ ν…μ¤νΈ
- νμΌ ν™•μ¥μ κ²€μ¦ (PDF, DOCX, PPTX, XLSX, TXT, HWP)
- νμΌ ν¬κΈ° μ ν• (50MB)
- λ³΄μ• νμΌλ… κ²€μ¦ (μ„ν—ν• ν¨ν„΄ ν•„ν„°λ§)
- MIME νƒ€μ… κ²€μ¦
```

### 5. **OCR λ° ν…μ¤νΈ μ¶”μ¶** (Python) - κΈ°μ΅΄ μ μ§€
- EasyOCR ν•κµ­μ–΄/μμ–΄ μ§€μ›
- μ¤μΊ” λ¬Έμ„ κ°μ§€ λ΅μ§
- 2λ‹¨ λ μ΄μ•„μ›ƒ λ³µμ›

### 6. **ν…μ¤νΈ μ •κ·ν™” λ° μ „μ²λ¦¬** (Python) - κΈ°μ΅΄ μ μ§€
- λ…Έμ΄μ¦ μ κ±° λ° μ •κ·ν™”
- ν•κµ­μ–΄ ν‚¤μ›λ“ μ¶”μ¶ (kiwipiepy)
- μλ―Έμ  μ²­ν‚Ή

### 7. **π“ NEW: λ°μ΄ν„°λ² μ΄μ¤ λ©”νƒ€λ°μ΄ν„° μ €μ¥ ν…μ¤νΈ** (Python)
```python
# document_service.create_document_from_upload() λ΅μ§ ν…μ¤νΈ
- tb_file_bss_info λ©”νƒ€λ°μ΄ν„° μƒμ„± λ° κ²€μ¦
- tb_file_dtl_info μƒμ„Έ μ •λ³΄ μƒμ„±
- μ¤ν‚¤λ§ νΈν™μ„± κ²€μ¦
- νμΌ ν•΄μ‹ λ° μ¤‘λ³µ κ²€μ‚¬
```

### 8. **π― λ°±μ—”λ“ ν†µν•© κ²€μƒ‰ μ‹μ¤ν…** (Python) - κΈ°μ΅΄ μ μ§€
- ProductionIndex (AWS Bedrock + pgvector)
- MiniIndex (TF-IDF ν΄λ°±)

### 9. **π” NEW: λ°±μ—”λ“ κ¶ν• κ²€μ¦ μ‹μ¤ν… ν…μ¤νΈ** (Python)
```python
# permission_service.check_upload_permission() λ΅μ§ ν…μ¤νΈ
- μ»¨ν…μ΄λ„λ³„ μ—…λ΅λ“ κ¶ν• κ²€μ¦
- μ‚¬μ©μ κ¶ν• λ λ²¨ ν™•μΈ (ADMIN, UPLOADER, VIEWER)
- κ¶ν• μƒμ† λ° κ³„μΈµ κµ¬μ΅°
- μ™€μΌλ“μΉ΄λ“ ν¨ν„΄ κ¶ν• μ²λ¦¬
```

### 10. **π”„ NEW: μ „μ²΄ λ°±μ—”λ“ API μ—…λ΅λ“ νμ΄ν”„λΌμΈ ν†µν•© ν…μ¤νΈ** (Python)
```python
# BackendUploadPipelineSimulator ν΄λμ¤
- 5λ‹¨κ³„ νμ΄ν”„λΌμΈ μ™„μ „ μ‹λ®¬λ μ΄μ…
- κ° λ‹¨κ³„λ³„ μ²λ¦¬ μ‹κ°„ μΈ΅μ •
- μ¤λ¥ μ²λ¦¬ λ° λ΅κΉ…
- DocumentUploadResponse ν•νƒ μ‘λ‹µ μƒμ„±
```

### 11. **π― λ°±μ—”λ“ ν†µν•© νμ΄ν”„λΌμΈ μ‹¤ν–‰** (Python) - κΈ°μ΅΄ μ μ§€
- Production vs TF-IDF μλ™ μ„ νƒ
- ν•κµ­μ–΄ NLP λ°±μ—”λ“ μ„λΉ„μ¤ ν™μ©
- PostgreSQL μ €μ¥ λ° λ²΅ν„° κ²€μƒ‰

### 12. **π― κ·κ²© μ¤€μλ„ κ²€μ¦ λ° ν™•μ¥ λ΅λ“λ§µ** (Python) - κΈ°μ΅΄ μ μ§€
- λ¬Έμ„ κ·κ²© λ€λΉ„ μ™„μ„±λ„ ν‰κ°€
- vs_multimodal_contents_index ν™•μ¥ κ³„ν
- ν”„λ΅λ•μ… λ°°ν¬ μ²΄ν¬λ¦¬μ¤νΈ

## π§ μƒλ΅ μ¶”κ°€λ λ‹¨μ„ ν…μ¤νΈ κΈ°λ¥

### 1. **νμΌ κ²€μ¦ μ‹μ¤ν… ν…μ¤νΈ**
```python
def validate_file_for_upload(file_path: str) -> Dict[str, Any]:
    # λ°±μ—”λ“ APIμ™€ λ™μΌν• κ²€μ¦ λ΅μ§
    # - νμΌ ν™•μ¥μ, ν¬κΈ°, λ³΄μ• κ²€μ¦
    # - MIME νƒ€μ… μ¶”μ •
    # - μ¤λ¥ λ° κ²½κ³  λ©”μ‹μ§€ μƒμ„±
```

### 2. **λ©”νƒ€λ°μ΄ν„° μƒμ„± ν…μ¤νΈ**
```python
def generate_file_metadata(file_path: str, container_id: str, user_emp_no: str):
    # tb_file_bss_info, tb_file_dtl_info λ©”νƒ€λ°μ΄ν„° μƒμ„±
    # νμΌ ν•΄μ‹ κ³„μ‚° (μ¤‘λ³µ κ²€μ‚¬μ©)
    # λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ νΈν™μ„± κ²€μ¦
```

### 3. **κ¶ν• κ²€μ¦ μ‹μ¤ν… ν…μ¤νΈ**
```python
def simulate_permission_check(user_emp_no: str, container_id: str):
    # μ»¨ν…μ΄λ„λ³„ κ¶ν• ν™•μΈ
    # μ™€μΌλ“μΉ΄λ“ ν¨ν„΄ λ§¤μΉ­
    # κ¶ν• λ λ²¨ κ²€μ¦ (ADMIN, UPLOADER, VIEWER)
```

### 4. **μ „μ²΄ νμ΄ν”„λΌμΈ ν†µν•© ν…μ¤νΈ**
```python
class BackendUploadPipelineSimulator:
    # 5λ‹¨κ³„ νμ΄ν”„λΌμΈ μ™„μ „ μ‹λ®¬λ μ΄μ…
    # κ° λ‹¨κ³„λ³„ μ„±λ¥ μΈ΅μ •
    # μ¤λ¥ μ²λ¦¬ λ° ν†µκ³„ μμ§‘
```

## π― ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

### λ‹¨κ³„λ³„ λ…λ¦½ ν…μ¤νΈ
1. **νμΌ κ²€μ¦**: λ‹¤μ–‘ν• νμΌ ν•μ‹κ³Ό ν¬κΈ°λ΅ κ²€μ¦ λ΅μ§ ν…μ¤νΈ
2. **λ©”νƒ€λ°μ΄ν„° μƒμ„±**: λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ νΈν™μ„± ν™•μΈ
3. **κ¶ν• κ²€μ¦**: μ‚¬μ©μλ³„ μ»¨ν…μ΄λ„ κ¶ν• μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ
4. **RAG νμ΄ν”„λΌμΈ**: OCR β†’ NLP β†’ μ„λ² λ”© β†’ λ²΅ν„° μ €μ¥ κ²€μ¦

### ν†µν•© νμ΄ν”„λΌμΈ ν…μ¤νΈ
- **μ„±κ³µ μ‹λ‚λ¦¬μ¤**: λ¨λ“  λ‹¨κ³„ ν†µκ³Ό
- **μ‹¤ν¨ μ‹λ‚λ¦¬μ¤**: κ° λ‹¨κ³„λ³„ μ‹¤ν¨ μ²λ¦¬
- **μ„±λ¥ μΈ΅μ •**: μ²λ¦¬ μ‹κ°„ λ° λ¦¬μ†μ¤ μ‚¬μ©λ‰
- **ν’μ§ ν‰κ°€**: ν…μ¤νΈ μ¶”μ¶ ν’μ§, λ²΅ν„° μƒμ„± μ„±κ³µλ¥ 

## π“ κΈ°λ€ ν¨κ³Ό

### 1. **κ°λ° ν¨μ¨μ„± ν–¥μƒ**
- λ°±μ—”λ“ API κ° κµ¬μ„±μ”μ†λ¥Ό λ…λ¦½μ μΌλ΅ ν…μ¤νΈ
- λ¬Έμ  λ°μƒμ‹ νΉμ • λ‹¨κ³„ μ‹λ³„ λ° λ””λ²„κΉ… κ°€λ¥
- μƒλ΅μ΄ κΈ°λ¥ μ¶”κ°€μ‹ μν–¥λ„ λ¶„μ„ μ©μ΄

### 2. **ν’μ§ λ³΄μ¦**
- μ‹¤μ  ν”„λ΅λ•μ… ν™κ²½κ³Ό λ™μΌν• λ΅μ§μΌλ΅ ν…μ¤νΈ
- νμΌ ν•μ‹λ³„, κ¶ν•λ³„, μ‚¬μ©μλ³„ λ‹¤μ–‘ν• μ‹λ‚λ¦¬μ¤ κ²€μ¦
- μ„±λ¥ λ³‘λ© μ§€μ  μ‚¬μ „ μ‹λ³„

### 3. **λ¬Έμ„ν™” λ° κµμ΅**
- λ°±μ—”λ“ API λ™μ‘ μ›λ¦¬ μ΄ν•΄
- μƒλ΅μ΄ κ°λ°μ μ¨λ³΄λ”© μλ£
- μ‹μ¤ν… μ•„ν‚¤ν…μ² μ‹κ°ν™”

## π€ μ‚¬μ© λ°©λ²•

### 1. **μ „μ²΄ νμ΄ν”„λΌμΈ ν…μ¤νΈ**
```bash
# λ…ΈνΈλ¶μ λ¨λ“  μ…€μ„ μμ°¨ μ‹¤ν–‰
1. κ°μ” ν™•μΈ (Markdown)
2. ν™κ²½ μ„¤μ • μ‹¤ν–‰
3. λ°±μ—”λ“ μ—°λ™ ν™•μΈ
4. κ° λ‹¨κ³„λ³„ λ‹¨μ„ ν…μ¤νΈ μ‹¤ν–‰
5. ν†µν•© νμ΄ν”„λΌμΈ ν…μ¤νΈ μ‹¤ν–‰
```

### 2. **νΉμ • κµ¬μ„±μ”μ†λ§ ν…μ¤νΈ**
```bash
# ν•„μ”ν• μ…€λ§ μ„ νƒ μ‹¤ν–‰
- νμΌ κ²€μ¦λ§: 4λ² μ…€
- λ©”νƒ€λ°μ΄ν„°λ§: 7λ² μ…€  
- κ¶ν• κ²€μ¦λ§: 9λ² μ…€
- μ „μ²΄ ν†µν•©: 10λ² μ…€
```

### 3. **ν”„λ΅λ•μ… λ°°ν¬ μ „ κ²€μ¦**
```bash
# μ‹¤μ  μ„λ²„ ν™κ²½μ—μ„ νμ΄ν”„λΌμΈ κ²€μ¦
1. λ°±μ—”λ“ μ„λΉ„μ¤ μ—°κ²° ν™•μΈ
2. λ‹¤μ–‘ν• νμΌ ν•μ‹μΌλ΅ ν…μ¤νΈ
3. κ¶ν• μ‹λ‚λ¦¬μ¤λ³„ κ²€μ¦
4. μ„±λ¥ λ²¤μΉλ§ν¬ μν–‰
```

## π‰ κ²°λ΅ 

β… **μ™„λ£**: λ°±μ—”λ“ API `/api/v1/documents/upload` μ—”λ“ν¬μΈνΈμ μ „μ²΄ κµ¬μ„±μ”μ†λ¥Ό κ°λ³„μ μΌλ΅ ν…μ¤νΈν•  μ μλ” ν¬κ΄„μ μΈ λ…ΈνΈλ¶

β… **λ‹¨μ„ ν…μ¤νΈ**: νμΌ κ²€μ¦, λ©”νƒ€λ°μ΄ν„° μƒμ„±, κ¶ν• ν™•μΈ, RAG νμ΄ν”„λΌμΈ κ°κ°μ„ λ…λ¦½μ μΌλ΅ ν…μ¤νΈ

β… **ν†µν•© ν…μ¤νΈ**: μ „μ²΄ μ—…λ΅λ“ νμ΄ν”„λΌμΈμ„ μ™„μ „ν μ‹λ®¬λ μ΄μ…ν•κ³  μ„±λ¥ μΈ΅μ •

β… **ν”„λ΅λ•μ… μ¤€λΉ„**: μ‹¤μ  λ°±μ—”λ“ μ„λΉ„μ¤μ™€ λ™μΌν• λ΅μ§μΌλ΅ κ²€μ¦ν•μ—¬ λ°°ν¬ μ „ μ‹ λΆ°μ„± ν™•λ³΄

μ΄μ  λ°±μ—”λ“ κ°λ°μλ“¤μ΄ APIμ κ° κµ¬μ„±μ”μ†λ¥Ό μ²΄κ³„μ μΌλ΅ ν…μ¤νΈν•κ³  λ””λ²„κΉ…ν•  μ μλ” μ™„μ „ν• λ„κµ¬λ¥Ό μ κ³µν•©λ‹λ‹¤!
